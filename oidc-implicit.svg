<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1497px" preserveAspectRatio="none" style="width:1470px;height:1497px;background:#FFFFFF;" version="1.1" viewBox="0 0 1470 1497" width="1470px" zoomAndPan="magnify"><defs/><g><rect fill="#DDDDDD" height="1485.8487" style="stroke:#181818;stroke-width:0.5;" width="862.5" x="345.5" y="6"/><rect fill="none" height="120.5301" style="stroke:#000000;stroke-width:1.5;" width="1061" x="282.5" y="385.902"/><rect fill="none" height="67.412" style="stroke:#000000;stroke-width:1.5;" width="1157" x="186.5" y="524.4321"/><rect fill="none" height="429.4644" style="stroke:#000000;stroke-width:1.5;" width="1376" x="71" y="609.8441"/><rect fill="none" height="65.412" style="stroke:#000000;stroke-width:1.5;" width="537" x="17.5" y="1230.8888"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="141" x2="141" y1="108.1358" y2="1387.7129"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="431" x2="431" y1="108.1358" y2="1387.7129"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="608.5" x2="608.5" y1="108.1358" y2="1387.7129"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1111" x2="1111" y1="108.1358" y2="1387.7129"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1327.5" x2="1327.5" y1="108.1358" y2="1387.7129"/><rect fill="#E2E2F0" height="71.2038" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108" x="87" y="35.9321"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="97" y="57.898">Relying Party</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="94" y="76.9659">(OAuth Client)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="109" y="96.0339">https://rp</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="163" x="349.5" y="55"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="149" x="356.5" y="76.9659">User Agent / Frontend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="375.5" y="96.0339">for Relying Party</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="590" y="84.9659">User</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="166" x="522.5" y="104.0339">(OAuth Resource Owner)</text><ellipse cx="608.5" cy="18.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M608.5,26.5 L608.5,53.5 M595.5,34.5 L621.5,34.5 M608.5,53.5 L595.5,68.5 M608.5,53.5 L621.5,68.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="186" x="1018" y="55"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="172" x="1025" y="76.9659">User Agent / Frontend for</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="1055" y="96.0339">OpenID Provider</text><rect fill="#E2E2F0" height="71.2038" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="207" x="1224" y="35.9321"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="1271.5" y="57.898">OpenID Provider</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="193" x="1231" y="76.9659">(OAuth Authorization Server)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="1294.5" y="96.0339">https://op</text><rect fill="#E2E2F0" height="71.2038" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108" x="87" y="1387.7129"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="97" y="1409.6788">Relying Party</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="94" y="1428.7467">(OAuth Client)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="109" y="1447.8146">https://rp</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="163" x="349.5" y="1387.7129"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="149" x="356.5" y="1409.6788">User Agent / Frontend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="375.5" y="1428.7467">for Relying Party</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="590" y="1462.6788">User</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="166" x="522.5" y="1481.7467">(OAuth Resource Owner)</text><ellipse cx="608.5" cy="1396.2129" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M608.5,1404.2129 L608.5,1431.2129 M595.5,1412.2129 L621.5,1412.2129 M608.5,1431.2129 L595.5,1446.2129 M608.5,1431.2129 L621.5,1446.2129 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="186" x="1018" y="1387.7129"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="172" x="1025" y="1409.6788">User Agent / Frontend for</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="1055" y="1428.7467">OpenID Provider</text><rect fill="#E2E2F0" height="71.2038" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="207" x="1224" y="1387.7129"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="1271.5" y="1409.6788">OpenID Provider</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="193" x="1231" y="1428.7467">(OAuth Authorization Server)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="1294.5" y="1447.8146">https://op</text><polygon fill="#181818" points="442,135.8419,432,139.8419,442,143.8419,438,139.8419" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="436" x2="607.5" y1="139.8419" y2="139.8419"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="448" y="134.0328">Request to login</text><polygon fill="#181818" points="152,135.8419,142,139.8419,152,143.8419,148,139.8419" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="146" x2="430" y1="139.8419" y2="139.8419"/><polygon fill="#181818" points="419,334.196,429,338.196,419,342.196,423,338.196" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="141" x2="425" y1="338.196" y2="338.196"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="148" y="332.387">(HTTPS 302)</text><polygon fill="#181818" points="1099,334.196,1109,338.196,1099,342.196,1103,338.196" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="431" x2="1105" y1="338.196" y2="338.196"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="159" x="438" y="190.7389">Authentication Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184" x="600" y="190.7389">(OAuth Authorization Request)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="357" x="438" y="208.4449">Redirection to GET https://rp/auth (authorization_endpoint)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="331" x="444" y="226.1509">?response_type= id_token / id_token token (REQUIRED)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249" x="444" y="243.8569">&amp;client_id=CID-XXXX (REQUIRED, opaque)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="530" x="444" y="261.5629">&amp;redirect_uri=https%3A%2F%2Fclient%2Ecallback (always REQUIRED in OpenID Connect)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="299" x="444" y="279.2689">&amp;scope=openid+profile+email+phone (OPTIONAL)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="260" x="444" y="296.975">&amp;state=AS-XXXX (RECOMMENDED, opaque)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="365" x="444" y="314.681">&amp;nonce=AN-XXXX (REQUIRED, protect against replay attacks)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10" x="444" y="332.387">…</text><polygon fill="#181818" points="1315.5,334.196,1325.5,338.196,1315.5,342.196,1319.5,338.196" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1111" x2="1321.5" y1="338.196" y2="338.196"/><polygon fill="#FEFFDD" points="1211.5,351.196,1443.5,351.196,1453.5,363.196,1443.5,376.196,1211.5,376.196,1201.5,363.196,1211.5,351.196" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="228" x="1213.5" y="369.093">Check redirect_uri allowed for client_id</text><path d="M282.5,385.902 L349.5,385.902 L349.5,395.608 L339.5,405.608 L282.5,405.608 L282.5,385.902 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="120.5301" style="stroke:#000000;stroke-width:1.5;" width="1061" x="282.5" y="385.902"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="22" x="297.5" y="400.799">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="369" x="364.5" y="399.6609">[User does not already have a session (or 'prompt' includes 'login')]</text><polygon fill="#181818" points="619.5,457.0201,609.5,461.0201,619.5,465.0201,615.5,461.0201" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1099,457.0201,1109,461.0201,1099,465.0201,1103,461.0201" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="613.5" x2="1105" y1="461.0201" y2="461.0201"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="625.5" y="455.2111">User authentication</text><polygon fill="#181818" points="1122,457.0201,1112,461.0201,1122,465.0201,1118,461.0201" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1315.5,457.0201,1325.5,461.0201,1315.5,465.0201,1319.5,461.0201" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1116" x2="1321.5" y1="461.0201" y2="461.0201"/><path d="M303.5,420.608 L303.5,500.608 L603.5,500.608 L603.5,430.608 L593.5,420.608 L303.5,420.608 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M593.5,420.608 L593.5,430.608 L603.5,430.608 L593.5,420.608 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="309.5" y="439.505">Authorization Server</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223" x="309.5" y="457.2111">may use any authentication methods</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="279" x="309.5" y="474.9171">(password, WebAuthn, mobile application, etc.)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="309.5" y="492.6231">for authenticating the user</text><path d="M186.5,524.4321 L253.5,524.4321 L253.5,534.1381 L243.5,544.1381 L186.5,544.1381 L186.5,524.4321 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="67.412" style="stroke:#000000;stroke-width:1.5;" width="1157" x="186.5" y="524.4321"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="22" x="201.5" y="539.3291">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="451" x="268.5" y="538.191">[User consent may be skipped if already given unless 'prompt' includes 'consent')]</text><polygon fill="#181818" points="619.5,573.8441,609.5,577.8441,619.5,581.8441,615.5,577.8441" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1099,573.8441,1109,577.8441,1099,581.8441,1103,577.8441" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="613.5" x2="1105" y1="577.8441" y2="577.8441"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="625.5" y="572.0351">Consent</text><path d="M207.5,559.1381 L207.5,586.1381 L603.5,586.1381 L603.5,569.1381 L593.5,559.1381 L207.5,559.1381 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M593.5,559.1381 L593.5,569.1381 L603.5,569.1381 L593.5,559.1381 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="375" x="213.5" y="578.0351">"Do you want to login on ClientFoo? Information requested: …"</text><polygon fill="#181818" points="1122,573.8441,1112,577.8441,1122,581.8441,1118,577.8441" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1315.5,573.8441,1325.5,577.8441,1315.5,581.8441,1319.5,577.8441" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1116" x2="1321.5" y1="577.8441" y2="577.8441"/><path d="M71,609.8441 L134,609.8441 L134,619.5501 L124,629.5501 L71,629.5501 L71,609.8441 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="429.4644" style="stroke:#000000;stroke-width:1.5;" width="1376" x="71" y="609.8441"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="86" y="624.7411">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="133" x="149" y="623.603">[response_mode=query]</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="71" x2="1447" y1="983.2584" y2="983.2584"/><polygon fill="#181818" points="1122,960.2584,1112,964.2584,1122,968.2584,1118,964.2584" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1116" x2="1326.5" y1="964.2584" y2="964.2584"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="1128" y="958.4494">(HTTPS 302)</text><polygon fill="#181818" points="442,960.2584,432,964.2584,442,968.2584,438,964.2584" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="436" x2="1110" y1="964.2584" y2="964.2584"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="167" x="448" y="657.4472">Authentication Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193" x="618" y="657.4472">(OAuth Authorization Response)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="302" x="448" y="675.1532">Redirection to GET https://rp/callback (redirect_uri)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="304" x="454" y="692.8592">?access_token=AT-XXXX (if token in response_type)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="285" x="454" y="710.5652">&amp;token_type=bearer (if token in response_type)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210" x="454" y="728.2712">&amp;id_token="eyJ…" (REQUIRED, JWT)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="460" y="745.9772">"iss": "https://op",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="405" x="460" y="763.6833">"sub": "SUB-XXXX", (private for the client_id if subject_type=pairwise)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="460" y="781.3893">"aud": "CID-XXXX",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="460" y="799.0953">"exp": …, "iat": …, "auth_time": …,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="411" x="460" y="816.8013">"nonce": "AN-XXXX", (from request, protection against replay attacks)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="309" x="460" y="834.5073">"acr": "…", (OPTIONAL, authentication context class),</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="386" x="460" y="852.2133">"amr": […], (OPTIONAL, list of user authentication methods used),</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="644" x="460" y="869.9194">"azp": "CID-XXXX",n    "sid": "SID-XXX", (OPTIONAL, different for different RPs, for Front/Back-Channel Logout)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="597" x="460" y="887.6254">"at_hash": "…" (included when response_type="id_token token", half of the hash of the access_token)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214" x="454" y="905.3314">&amp;scope=scope1 scope2 (OPTIONAL)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="454" y="923.0374">&amp;state=AS-XXXX (if given)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="454" y="940.7434">&amp;expires_in=3600 (OPTIONAL)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="454" y="958.4494">&amp;iss=https://op (extension)</text><polygon fill="#181818" points="152,960.2584,142,964.2584,152,968.2584,148,964.2584" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="146" x2="430" y1="964.2584" y2="964.2584"/><rect fill="none" height="44.0501" style="stroke:#000000;stroke-width:1.5;" width="1340" x="89" y="990.2584"/><path d="M89,990.2584 L153,990.2584 L153,999.2584 L143,1009.2584 L89,1009.2584 L89,990.2584 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="102" y="1006.1555">ref</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="120" x="699" y="1026.0865">other reponse modes</text><polygon fill="#FEFFDD" points="20,1058.3086,262,1058.3086,272,1088.3086,262,1119.3086,20,1119.3086,10,1088.3086,20,1058.3086" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="22" y="1076.2056">Check validity of state</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="238" x="22" y="1093.9116">and its association with the user session</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="22" y="1111.6176">(protection against CSRF)</text><polygon fill="#FEFFDD" points="40.5,1129.4266,241.5,1129.4266,251.5,1150.4266,241.5,1172.4266,40.5,1172.4266,30.5,1150.4266,40.5,1129.4266" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="42.5" y="1147.3236">Check "iss" field (if given),</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="42.5" y="1165.0297">protection against mixup attacks</text><rect fill="none" height="44.0501" style="stroke:#000000;stroke-width:1.5;" width="421.5" x="89" y="1177.8387"/><path d="M89,1177.8387 L153,1177.8387 L153,1186.8387 L143,1196.8387 L89,1196.8387 L89,1177.8387 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="102" y="1193.7357">ref</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="93" x="253.25" y="1213.6667">Process id_token</text><path d="M17.5,1230.8888 L84.5,1230.8888 L84.5,1240.5948 L74.5,1250.5948 L17.5,1250.5948 L17.5,1230.8888 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="65.412" style="stroke:#000000;stroke-width:1.5;" width="537" x="17.5" y="1230.8888"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="22" x="32.5" y="1245.7858">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="188" x="99.5" y="1244.6477">[response_type="id_token token"]</text><polygon fill="#FEFFDD" points="48.5,1265.5948,523.5,1265.5948,533.5,1277.5948,523.5,1290.5948,48.5,1290.5948,38.5,1277.5948,48.5,1265.5948" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="471" x="50.5" y="1283.4918">Check code against at_hash (protect against access_token substitution attacks)</text><polygon fill="#FEFFDD" points="88.25,1315.3008,483.25,1315.3008,493.25,1327.3008,483.25,1340.3008,88.25,1340.3008,78.25,1327.3008,88.25,1315.3008" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="215" y="1333.1978">Create user session, etc.</text><polygon fill="#181818" points="419,1365.7129,429,1369.7129,419,1373.7129,423,1369.7129" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="141" x2="425" y1="1369.7129" y2="1369.7129"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="266" x="148" y="1363.9039">Restore application state (eg. target_link_uri)</text><polygon fill="#181818" points="596.5,1365.7129,606.5,1369.7129,596.5,1373.7129,600.5,1369.7129" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="431" x2="602.5" y1="1369.7129" y2="1369.7129"/><!--MD5=[7b150c9d92480771a6de8f0e95a33e7e]
@startuml

!pragma teoz true

participant "Relying Party\n(OAuth Client)\nhttps://rp" as client
box
    participant "User Agent / Frontend\nfor Relying Party" as uac
    actor "User\n(OAuth Resource Owner)" as user
    participant "User Agent / Frontend for\nOpenID Provider" as uaas
end box
participant "OpenID Provider\n(OAuth Authorization Server)\nhttps://op" as as


user -> uac: Request to login
& uac -> client

|||


client -> uac : (HTTPS 302)
& uac -> uaas: **Authentication Request** (OAuth Authorization Request)\nRedirection to GET https://rp/auth (authorization_endpoint)\n  ?response_type= id_token / id_token token (REQUIRED)\n  &client_id=CID-XXXX (REQUIRED, opaque)\n  &redirect_uri=https%3A%2F%2Fclient%2Ecallback (always REQUIRED in OpenID Connect)\n  &scope=openid+profile+email+phone (OPTIONAL)\n  &state=AS-XXXX (RECOMMENDED, opaque)\n  &nonce=AN-XXXX (REQUIRED, protect against replay attacks)\n  …
& uaas -> as

hnote over as: Check redirect_uri allowed for client_id

opt User does not already have a session (or 'prompt' includes 'login')
  user <-> uaas : User authentication
  & uaas <-> as
  & note left of user: Authorization Server\nmay use any authentication methods\n(password, WebAuthn, mobile application, etc.)\nfor authenticating the user
end

opt User consent may be skipped if already given unless 'prompt' includes 'consent')
  user <-> uaas : Consent
  rnote left: "Do you want to login on ClientFoo? Information requested: …"
  & uaas <-> as
end

alt response_mode=query

as - -> uaas: (HTTPS 302)
& uaas - -> uac: **Authentication Response** (OAuth Authorization Response)\nRedirection to GET https://rp/callback (redirect_uri)\n  ?access_token=AT-XXXX (if token in response_type)\n  &token_type=bearer (if token in response_type)\n  &id_token="eyJ…" (REQUIRED, JWT)\n    "iss": "https://op",\n    "sub": "SUB-XXXX", (private for the client_id if subject_type=pairwise)\n    "aud": "CID-XXXX",\n    "exp": …, "iat": …, "auth_time": …,\n    "nonce": "AN-XXXX", (from request, protection against replay attacks)\n    "acr": "…", (OPTIONAL, authentication context class),\n    "amr": […], (OPTIONAL, list of user authentication methods used),\n    "azp": "CID-XXXX",n    "sid": "SID-XXX", (OPTIONAL, different for different RPs, for Front/Back-Channel Logout)\n    "at_hash": "…" (included when response_type="id_token token", half of the hash of the access_token)\n  &scope=scope1 scope2 (OPTIONAL)\n  &state=AS-XXXX (if given)\n  &expires_in=3600 (OPTIONAL)\n  &iss=https://op (extension)
& uac - -> client

else 

ref over client, as: other reponse modes

end

hnote over client: Check validity of state\nand its association with the user session\n(protection against CSRF)
hnote over client: Check "iss" field (if given),\nprotection against mixup attacks

ref over client, uac: Process id_token

opt response_type="id_token token"
hnote over client, uac: Check code against at_hash (protect against access_token substitution attacks)
end

hnote over client, uac: Create user session, etc.

client -> uac: Restore application state (eg. target_link_uri)
& uac -> user

@enduml

PlantUML version 1.2022.13(Sat Nov 19 14:22:17 CET 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: fr
Country: FR
--></g></svg>