<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="3506px" preserveAspectRatio="none" style="width:1711px;height:3506px;background:#FFFFFF;" version="1.1" viewBox="0 0 1711 3506" width="1711px" zoomAndPan="magnify"><defs/><g><rect fill="#DDDDDD" height="3494.1609" style="stroke:#181818;stroke-width:0.5;" width="742.5" x="470" y="6"/><rect fill="none" height="100.8241" style="stroke:#000000;stroke-width:1.5;" width="302" x="114.5" y="176.8419"/><rect fill="none" height="120.5301" style="stroke:#000000;stroke-width:1.5;" width="941" x="407" y="790.0223"/><rect fill="none" height="67.412" style="stroke:#000000;stroke-width:1.5;" width="1037" x="311" y="928.5524"/><rect fill="none" height="703.5599" style="stroke:#000000;stroke-width:1.5;" width="1098.5" x="249.5" y="1013.9645"/><rect fill="none" height="83.118" style="stroke:#000000;stroke-width:1.5;" width="277" x="131" y="1735.5243"/><rect fill="none" height="186.5301" style="stroke:#000000;stroke-width:1.5;" width="388" x="1150.5" y="2213.2326"/><rect fill="none" height="67.412" style="stroke:#000000;stroke-width:1.5;" width="325" x="1169.5" y="2318.3507"/><rect fill="none" height="65.412" style="stroke:#000000;stroke-width:1.5;" width="694" x="181.5" y="2750.765"/><rect fill="none" height="399.3179" style="stroke:#000000;stroke-width:1.5;" width="1390" x="8" y="2834.177"/><rect fill="none" height="315.9059" style="stroke:#000000;stroke-width:1.5;" width="1341.5" x="31.5" y="2903.589"/><rect fill="none" height="93.118" style="stroke:#000000;stroke-width:1.5;" width="1098.5" x="249.5" y="2937.2951"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="265.5" x2="265.5" y1="108.1358" y2="3396.025"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="555.5" x2="555.5" y1="108.1358" y2="3396.025"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="733" x2="733" y1="108.1358" y2="3396.025"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1115.5" x2="1115.5" y1="108.1358" y2="3396.025"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1332" x2="1332" y1="108.1358" y2="3396.025"/><rect fill="#E2E2F0" height="71.2038" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108" x="211.5" y="35.9321"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="221.5" y="57.898">Relying Party</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="218.5" y="76.9659">(OAuth Client)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="233.5" y="96.0339">https://rp</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="163" x="474" y="55"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="149" x="481" y="76.9659">User Agent / Frontend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="500" y="96.0339">for Relying Party</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="714.5" y="84.9659">User</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="166" x="647" y="104.0339">(OAuth Resource Owner)</text><ellipse cx="733" cy="18.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M733,26.5 L733,53.5 M720,34.5 L746,34.5 M733,53.5 L720,68.5 M733,53.5 L746,68.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="186" x="1022.5" y="55"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="172" x="1029.5" y="76.9659">User Agent / Frontend for</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="1059.5" y="96.0339">OpenID Provider</text><rect fill="#E2E2F0" height="71.2038" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="207" x="1228.5" y="35.9321"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="1276" y="57.898">OpenID Provider</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="193" x="1235.5" y="76.9659">(OAuth Authorization Server)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="1299" y="96.0339">https://op</text><rect fill="#E2E2F0" height="71.2038" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108" x="211.5" y="3396.025"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="221.5" y="3417.991">Relying Party</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="218.5" y="3437.0589">(OAuth Client)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="233.5" y="3456.1268">https://rp</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="163" x="474" y="3396.025"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="149" x="481" y="3417.991">User Agent / Frontend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="500" y="3437.0589">for Relying Party</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="714.5" y="3470.991">User</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="166" x="647" y="3490.0589">(OAuth Resource Owner)</text><ellipse cx="733" cy="3404.525" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M733,3412.525 L733,3439.525 M720,3420.525 L746,3420.525 M733,3439.525 L720,3454.525 M733,3439.525 L746,3454.525 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="186" x="1022.5" y="3396.025"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="172" x="1029.5" y="3417.991">User Agent / Frontend for</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="1059.5" y="3437.0589">OpenID Provider</text><rect fill="#E2E2F0" height="71.2038" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="207" x="1228.5" y="3396.025"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="1276" y="3417.991">OpenID Provider</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="193" x="1235.5" y="3437.0589">(OAuth Authorization Server)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="1299" y="3456.1268">https://op</text><polygon fill="#181818" points="566.5,135.8419,556.5,139.8419,566.5,143.8419,562.5,139.8419" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="560.5" x2="732" y1="139.8419" y2="139.8419"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="572.5" y="134.0328">Request to login</text><polygon fill="#181818" points="276.5,135.8419,266.5,139.8419,276.5,143.8419,272.5,139.8419" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="270.5" x2="554.5" y1="139.8419" y2="139.8419"/><path d="M114.5,176.8419 L181.5,176.8419 L181.5,186.5479 L171.5,196.5479 L114.5,196.5479 L114.5,176.8419 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="100.8241" style="stroke:#000000;stroke-width:1.5;" width="302" x="114.5" y="176.8419"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="22" x="129.5" y="191.7389">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="64" x="196.5" y="190.6008">[PKCE used]</text><polygon fill="#FEFFDD" points="145.5,211.5479,385.5,211.5479,395.5,241.5479,385.5,272.5479,145.5,272.5479,135.5,241.5479,145.5,211.5479" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="147.5" y="229.4449">Generate random code_verifier</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="147.5" y="247.1509">and derive code_challenge=</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="230" x="153.5" y="264.8569">code_challenge_method(code_verifier)</text><polygon fill="#181818" points="543.5,683.1983,553.5,687.1983,543.5,691.1983,547.5,687.1983" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="265.5" x2="549.5" y1="687.1983" y2="687.1983"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="272.5" y="681.3893">(HTTPS 302)</text><polygon fill="#181818" points="1103.5,683.1983,1113.5,687.1983,1103.5,691.1983,1107.5,687.1983" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="555.5" x2="1109.5" y1="687.1983" y2="687.1983"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="159" x="562.5" y="309.5629">Authentication Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184" x="724.5" y="309.5629">(OAuth Authorization Request)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="533" x="562.5" y="327.2689">Redirection to GET (query) or POST (urlencoded) https://rp/auth (authorization_endpoint)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="204" x="568.5" y="344.975">?response_type=code (REQUIRED)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249" x="568.5" y="362.681">&amp;client_id=CID-XXXX (REQUIRED, opaque)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="530" x="568.5" y="380.387">&amp;redirect_uri=https%3A%2F%2Fclient%2Ecallback (always REQUIRED in OpenID Connect)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="299" x="568.5" y="398.093">&amp;scope=openid+profile+email+phone (OPTIONAL)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="260" x="568.5" y="415.799">&amp;state=AS-XXXX (RECOMMENDED, opaque)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108" x="568.5" y="433.505">&amp;nonce=AN-XXXX</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="340" x="574.5" y="451.2111">(OPTIONAL using this flow but REQUIRED for other flows,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="306" x="574.5" y="468.9171">included in ID token, protect against replay attacks)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="6" x="562.5" y="486.6231">  </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="275" x="568.5" y="504.3291">&amp;code_challenge_method=S256 (if PKCE used)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="241" x="568.5" y="522.0351">&amp;code_challenge=CCCCCC (if PKCE used)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="6" x="562.5" y="539.7411">  </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="326" x="568.5" y="557.4472">&amp;response_mode=query (or fragment, form_post, etc.)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="447" x="568.5" y="575.1532">&amp;claims={"userinfo":{…}, "id_token": {…}} (OPTIONAL, list of required claims)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="297" x="568.5" y="592.8592">&amp;display=page / popup / touch / wap (OPTIONAL)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="395" x="568.5" y="610.5652">&amp;prompt=login (OPTIONAL, and/or none/consent/select_account)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="318" x="568.5" y="628.2712">&amp;max_age=320 (OPTIONAL, max. authentication age)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="314" x="568.5" y="645.9772">&amp;id_token_hint=eyJ… (OPTIONAL, previous ID token)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="292" x="568.5" y="663.6833">&amp;login_hint=janedoe@example.com (OPTIONAL)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="402" x="568.5" y="681.3893">&amp;acr_values=… (OPTIONAL, requested authentication context class)</text><path d="M1120.5,296.6659 L1120.5,359.6659 L1387.5,359.6659 L1387.5,306.6659 L1377.5,296.6659 L1120.5,296.6659 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1377.5,296.6659 L1377.5,306.6659 L1387.5,306.6659 L1377.5,296.6659 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205" x="1126.5" y="315.5629">The request may as well be passed</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="1126.5" y="333.2689">as a JWT (request=…)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="246" x="1126.5" y="350.975">or as a reference to a JWT (request_uri=…)</text><polygon fill="#181818" points="1320,683.1983,1330,687.1983,1320,691.1983,1324,687.1983" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1115.5" x2="1326" y1="687.1983" y2="687.1983"/><polygon fill="#FEFFDD" points="1216,727.7573,1448,727.7573,1458,739.7573,1448,752.7573,1216,752.7573,1206,739.7573,1216,727.7573" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="228" x="1218" y="745.6543">Check redirect_uri allowed for client_id</text><path d="M419.5,700.1983 L419.5,780.1983 L691.5,780.1983 L691.5,710.1983 L681.5,700.1983 L419.5,700.1983 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M681.5,700.1983 L681.5,710.1983 L691.5,710.1983 L681.5,700.1983 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236" x="425.5" y="719.0953">For native apps, the redirect_uri may be</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="425.5" y="736.8013">a claimed URI (https://…),</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207" x="425.5" y="754.5073">a private URI (com.example.foo:…),</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="251" x="425.5" y="772.2133">or a localhost URI (http://localhost:XXX/…)</text><path d="M407,790.0223 L474,790.0223 L474,799.7284 L464,809.7284 L407,809.7284 L407,790.0223 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="120.5301" style="stroke:#000000;stroke-width:1.5;" width="941" x="407" y="790.0223"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="22" x="422" y="804.9194">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="369" x="489" y="803.7813">[User does not already have a session (or 'prompt' includes 'login')]</text><polygon fill="#181818" points="744,861.1404,734,865.1404,744,869.1404,740,865.1404" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1103.5,861.1404,1113.5,865.1404,1103.5,869.1404,1107.5,865.1404" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="738" x2="1109.5" y1="865.1404" y2="865.1404"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="750" y="859.3314">User authentication</text><polygon fill="#181818" points="1126.5,861.1404,1116.5,865.1404,1126.5,869.1404,1122.5,865.1404" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1320,861.1404,1330,865.1404,1320,869.1404,1324,865.1404" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1120.5" x2="1326" y1="865.1404" y2="865.1404"/><path d="M428,824.7284 L428,904.7284 L728,904.7284 L728,834.7284 L718,824.7284 L428,824.7284 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M718,824.7284 L718,834.7284 L728,834.7284 L718,824.7284 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="434" y="843.6254">Authorization Server</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223" x="434" y="861.3314">may use any authentication methods</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="279" x="434" y="879.0374">(password, WebAuthn, mobile application, etc.)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="434" y="896.7434">for authenticating the user</text><path d="M311,928.5524 L378,928.5524 L378,938.2584 L368,948.2584 L311,948.2584 L311,928.5524 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="67.412" style="stroke:#000000;stroke-width:1.5;" width="1037" x="311" y="928.5524"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="22" x="326" y="943.4494">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="451" x="393" y="942.3113">[User consent may be skipped if already given unless 'prompt' includes 'consent')]</text><polygon fill="#181818" points="744,977.9645,734,981.9645,744,985.9645,740,981.9645" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1103.5,977.9645,1113.5,981.9645,1103.5,985.9645,1107.5,981.9645" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="738" x2="1109.5" y1="981.9645" y2="981.9645"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="750" y="976.1555">Consent</text><path d="M332,963.2584 L332,990.2584 L728,990.2584 L728,973.2584 L718,963.2584 L332,963.2584 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M718,963.2584 L718,973.2584 L728,973.2584 L718,963.2584 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="375" x="338" y="982.1555">"Do you want to login on ClientFoo? Information requested: …"</text><polygon fill="#181818" points="1126.5,977.9645,1116.5,981.9645,1126.5,985.9645,1122.5,981.9645" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1320,977.9645,1330,981.9645,1320,985.9645,1324,981.9645" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1120.5" x2="1326" y1="981.9645" y2="981.9645"/><path d="M249.5,1013.9645 L312.5,1013.9645 L312.5,1023.6705 L302.5,1033.6705 L249.5,1033.6705 L249.5,1013.9645 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="703.5599" style="stroke:#000000;stroke-width:1.5;" width="1098.5" x="249.5" y="1013.9645"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="264.5" y="1028.8615">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="133" x="327.5" y="1027.7234">[response_mode=query]</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="249.5" x2="1348" y1="1157.2006" y2="1157.2006"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="154" x="254.5" y="1170.9595">[response_mode=fragment]</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="249.5" x2="1348" y1="1292.7125" y2="1292.7125"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="157" x="254.5" y="1306.4714">[response_mode=form_post]</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="249.5" x2="1348" y1="1428.2245" y2="1428.2245"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="250" x="254.5" y="1441.9834">[response_mode=query.jwt (JARM extension)]</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="249.5" x2="1348" y1="1528.3244" y2="1528.3244"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="271" x="254.5" y="1542.0834">[response_mode=fragment.jwt (JARM extension)]</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="249.5" x2="1348" y1="1628.4244" y2="1628.4244"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="274" x="254.5" y="1642.1833">[response_mode=form_post.jwt (JARM extension)]</text><polygon fill="#181818" points="1126.5,1134.2006,1116.5,1138.2006,1126.5,1142.2006,1122.5,1138.2006" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1120.5" x2="1331" y1="1138.2006" y2="1138.2006"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="1132.5" y="1132.3916">(HTTPS 302)</text><polygon fill="#181818" points="566.5,1134.2006,556.5,1138.2006,566.5,1142.2006,562.5,1138.2006" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="560.5" x2="1114.5" y1="1138.2006" y2="1138.2006"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="167" x="572.5" y="1061.5675">Authentication Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193" x="742.5" y="1061.5675">(OAuth Authorization Response)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="302" x="572.5" y="1079.2735">Redirection to GET https://rp/callback (redirect_uri)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217" x="578.5" y="1096.9795">?code=AC-XXXX (opaque, single-use)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="578.5" y="1114.6855">&amp;state=AS-XXXX (if given)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="578.5" y="1132.3916">&amp;iss=https://op (extension)</text><polygon fill="#181818" points="276.5,1134.2006,266.5,1138.2006,276.5,1142.2006,272.5,1138.2006" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="270.5" x2="554.5" y1="1138.2006" y2="1138.2006"/><polygon fill="#181818" points="1126.5,1269.7125,1116.5,1273.7125,1126.5,1277.7125,1122.5,1273.7125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1120.5" x2="1331" y1="1273.7125" y2="1273.7125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="1132.5" y="1267.9035">(HTTPS 302)</text><polygon fill="#181818" points="566.5,1269.7125,556.5,1273.7125,566.5,1277.7125,562.5,1273.7125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="560.5" x2="1114.5" y1="1273.7125" y2="1273.7125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="167" x="572.5" y="1197.0795">Authentication Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193" x="742.5" y="1197.0795">(OAuth Authorization Response)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="302" x="572.5" y="1214.7855">Redirection to GET https://rp/callback (redirect_uri)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="219" x="578.5" y="1232.4915">#code=AC-XXXX (opaque, single-use)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="578.5" y="1250.1975">&amp;state=AS-XXXX (if given)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="578.5" y="1267.9035">&amp;iss=https://op (extension)</text><polygon fill="#181818" points="276.5,1269.7125,266.5,1273.7125,276.5,1277.7125,272.5,1273.7125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="270.5" x2="554.5" y1="1273.7125" y2="1273.7125"/><polygon fill="#181818" points="1126.5,1405.2245,1116.5,1409.2245,1126.5,1413.2245,1122.5,1409.2245" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1120.5" x2="1331" y1="1409.2245" y2="1409.2245"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="1132.5" y="1403.4155">(HTTPS with HTML form)</text><polygon fill="#181818" points="566.5,1405.2245,556.5,1409.2245,566.5,1413.2245,562.5,1409.2245" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="560.5" x2="1114.5" y1="1409.2245" y2="1409.2245"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="167" x="572.5" y="1332.5914">Authentication Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193" x="742.5" y="1332.5914">(OAuth Authorization Response)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="254" x="572.5" y="1350.2974">HTTP POST https://rp/callback, urlencoded</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="572.5" y="1368.0035">code=AC-XXXX (opaque, single-use)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="572.5" y="1385.7095">&amp;state=AS-XXXX (if given)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="572.5" y="1403.4155">&amp;iss=https://op (extension)</text><polygon fill="#181818" points="276.5,1405.2245,266.5,1409.2245,276.5,1413.2245,272.5,1409.2245" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="270.5" x2="554.5" y1="1409.2245" y2="1409.2245"/><polygon fill="#181818" points="1126.5,1505.3244,1116.5,1509.3244,1126.5,1513.3244,1122.5,1509.3244" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1120.5" x2="1331" y1="1509.3244" y2="1509.3244"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="1132.5" y="1503.5154">(HTTPS 302)</text><polygon fill="#181818" points="566.5,1505.3244,556.5,1509.3244,566.5,1513.3244,562.5,1509.3244" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="560.5" x2="1114.5" y1="1509.3244" y2="1509.3244"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="167" x="572.5" y="1468.1034">Authentication Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193" x="742.5" y="1468.1034">(OAuth Authorization Response)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="302" x="572.5" y="1485.8094">Redirection to GET https://rp/callback (redirect_uri)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="578.5" y="1503.5154">?response=eyJ… (JWT)</text><polygon fill="#181818" points="276.5,1505.3244,266.5,1509.3244,276.5,1513.3244,272.5,1509.3244" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="270.5" x2="554.5" y1="1509.3244" y2="1509.3244"/><polygon fill="#181818" points="1126.5,1605.4244,1116.5,1609.4244,1126.5,1613.4244,1122.5,1609.4244" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1120.5" x2="1331" y1="1609.4244" y2="1609.4244"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="1132.5" y="1603.6154">(HTTPS 302)</text><polygon fill="#181818" points="566.5,1605.4244,556.5,1609.4244,566.5,1613.4244,562.5,1609.4244" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="560.5" x2="1114.5" y1="1609.4244" y2="1609.4244"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="167" x="572.5" y="1568.2033">Authentication Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193" x="742.5" y="1568.2033">(OAuth Authorization Response)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="302" x="572.5" y="1585.9094">Redirection to GET https://rp/callback (redirect_uri)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="578.5" y="1603.6154">#response=eyJ… (JWT)</text><polygon fill="#181818" points="276.5,1605.4244,266.5,1609.4244,276.5,1613.4244,272.5,1609.4244" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="270.5" x2="554.5" y1="1609.4244" y2="1609.4244"/><polygon fill="#181818" points="1126.5,1705.5243,1116.5,1709.5243,1126.5,1713.5243,1122.5,1709.5243" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1120.5" x2="1331" y1="1709.5243" y2="1709.5243"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="1132.5" y="1703.7153">(HTTPS with HTML form)</text><polygon fill="#181818" points="566.5,1705.5243,556.5,1709.5243,566.5,1713.5243,562.5,1709.5243" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="560.5" x2="1114.5" y1="1709.5243" y2="1709.5243"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="167" x="572.5" y="1668.3033">Authentication Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193" x="742.5" y="1668.3033">(OAuth Authorization Response)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="385" x="572.5" y="1686.0093">Redirection to POST https://rp/callback (redirect_uri), urlencoded</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="572.5" y="1703.7153">response=eyJ… (JWT)</text><polygon fill="#181818" points="276.5,1705.5243,266.5,1709.5243,276.5,1713.5243,272.5,1709.5243" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="270.5" x2="554.5" y1="1709.5243" y2="1709.5243"/><path d="M131,1735.5243 L198,1735.5243 L198,1745.2303 L188,1755.2303 L131,1755.2303 L131,1735.5243 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="83.118" style="stroke:#000000;stroke-width:1.5;" width="277" x="131" y="1735.5243"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="22" x="146" y="1750.4213">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="179" x="213" y="1749.2832">[A JARM (JWT) request was used]</text><polygon fill="#FEFFDD" points="162,1770.2303,369,1770.2303,379,1791.2303,369,1813.2303,162,1813.2303,152,1791.2303,162,1770.2303" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="164" y="1788.1273">Check validity of JARM</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203" x="164" y="1805.8334">(signature/MAC, aud, exp, iss, etc.)</text><polygon fill="#FEFFDD" points="144.5,1837.6424,386.5,1837.6424,396.5,1867.6424,386.5,1898.6424,144.5,1898.6424,134.5,1867.6424,144.5,1837.6424" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="146.5" y="1855.5394">Check validity of state</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="238" x="146.5" y="1873.2454">and its association with the user session</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="146.5" y="1890.9514">(protection against CSRF)</text><polygon fill="#FEFFDD" points="165,1908.7604,366,1908.7604,376,1929.7604,366,1951.7604,165,1951.7604,155,1929.7604,165,1908.7604" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="167" y="1926.6574">Check "iss" field (if given),</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="167" y="1944.3634">protection against mixup attacks</text><polygon fill="#181818" points="1320,2108.1146,1330,2112.1146,1320,2116.1146,1324,2112.1146" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="265.5" x2="1326" y1="2112.1146" y2="2112.1146"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="272.5" y="2000.0695">Token Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="373.5" y="2000.0695">(OAuth Access Token Request)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="359" x="272.5" y="2017.7755">HTTPS POST https://op/token (token_endpoint), urlencoded</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="693" x="272.5" y="2035.4815">Authorization: Basic … (client_id + client_secret) (or other authentication method, see token_endpoint_auth_method)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189" x="272.5" y="2053.1875">grant_type=authorization_code</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="278.5" y="2070.8935">&amp;code=AC-XXXX</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="488" x="278.5" y="2088.5995">&amp;redirect_uri=https%3A%2F%2Fclient%2Fcallback (REQUIRED, same as in request)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="442" x="278.5" y="2106.3056">&amp;code_verifier=CV-XXXXV (if and only if code_challenge was used i.e. PKCE)</text><path d="M1337,1987.1724 L1337,2032.1724 L1704,2032.1724 L1704,1997.1724 L1694,1987.1724 L1337,1987.1724 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1694,1987.1724 L1694,1997.1724 L1704,1997.1724 L1694,1987.1724 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="326" x="1343" y="2006.0695">If support for browser-based / single-page applications</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="346" x="1343" y="2023.7755">is needed the token endpoint need a suitable CORS policy.</text><polygon fill="#FEFFDD" points="1245.5,2125.1146,1418.5,2125.1146,1428.5,2146.1146,1418.5,2168.1146,1245.5,2168.1146,1235.5,2146.1146,1245.5,2125.1146" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169" x="1247.5" y="2143.0116">Check (client authentication,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="1247.5" y="2160.7176">redirect_uri, code, etc)</text><polygon fill="#FEFFDD" points="1241.5,2178.5266,1422.5,2178.5266,1432.5,2190.5266,1422.5,2203.5266,1241.5,2203.5266,1231.5,2190.5266,1241.5,2178.5266" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="1243.5" y="2196.4236">Check code issued to client_id</text><path d="M1150.5,2213.2326 L1217.5,2213.2326 L1217.5,2222.9386 L1207.5,2232.9386 L1150.5,2232.9386 L1150.5,2213.2326 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="186.5301" style="stroke:#000000;stroke-width:1.5;" width="388" x="1150.5" y="2213.2326"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="22" x="1165.5" y="2228.1296">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="290" x="1232.5" y="2226.9915">[code_challenge was sent in authentication request]</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1150.5" x2="1538.5" y1="2307.3507" y2="2307.3507"/><polygon fill="#FEFFDD" points="1207,2247.9386,1457,2247.9386,1467,2268.9386,1457,2290.9386,1207,2290.9386,1197,2268.9386,1207,2247.9386" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="1209" y="2265.8356">Check code_verifier=</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="246" x="1209" y="2283.5417">code_challenge_method(code_challenge)</text><path d="M1169.5,2318.3507 L1252.5,2318.3507 L1252.5,2328.0567 L1242.5,2338.0567 L1169.5,2338.0567 L1169.5,2318.3507 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="67.412" style="stroke:#000000;stroke-width:1.5;" width="325" x="1169.5" y="2318.3507"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1184.5" y="2333.2477">break</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="153" x="1267.5" y="2332.1096">[code_verifier was supplied]</text><path d="M1190.5,2353.0567 L1190.5,2380.0567 L1473.5,2380.0567 L1473.5,2363.0567 L1463.5,2353.0567 L1190.5,2353.0567 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1463.5,2353.0567 L1463.5,2363.0567 L1473.5,2363.0567 L1463.5,2353.0567 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="262" x="1196.5" y="2371.9537">Protection against PKCE downgrade attacks</text><polygon fill="#FEFFDD" points="1257,2418.7627,1407,2418.7627,1417,2430.7627,1407,2443.7627,1257,2443.7627,1247,2430.7627,1257,2418.7627" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="1259" y="2436.6597">Revoke code (single use)</text><polygon fill="#181818" points="276.5,2734.765,266.5,2738.765,276.5,2742.765,272.5,2738.765" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="270.5" x2="1331" y1="2738.765" y2="2738.765"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="106" x="282.5" y="2467.3657">Token Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190" x="391.5" y="2467.3657">(OAuth Access Token Response)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="282.5" y="2485.0717">HTTPS 200, JSON</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="282.5" y="2502.7778">"access_token":"AT-XXXX", (opaque)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="282.5" y="2520.4838">"token_type":"bearer",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="282.5" y="2538.1898">"expires_in":3600</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="287" x="282.5" y="2555.8958">"refresh_token":"RT-XXXX", (OPTIONAL, opaque)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="282.5" y="2573.6018">"scope":"scope1 scope2",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="204" x="282.5" y="2591.3078">"id_token": "eyJ…" JWT with claims,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="294.5" y="2609.0139">"iss": "https://op",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="405" x="294.5" y="2626.7199">"sub": "SUB-XXXX", (private for the client_id if subject_type=pairwise)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="294.5" y="2644.4259">"aud": "CID-XXXX",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="294.5" y="2662.1319">"exp": …, "iat": …, "auth_time": …,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="411" x="294.5" y="2679.8379">"nonce": "AN-XXXX", (from request, protection against replay attacks)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="309" x="294.5" y="2697.5439">"acr": "…", (OPTIONAL, authentication context class),</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="386" x="294.5" y="2715.25">"amr": […], (OPTIONAL, list of user authentication methods used),</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="644" x="294.5" y="2732.956">"azp": "CID-XXXX",n    "sid": "SID-XXX", (OPTIONAL, different for different RPs, for Front/Back-Channel Logout)</text><path d="M181.5,2750.765 L248.5,2750.765 L248.5,2760.471 L238.5,2770.471 L181.5,2770.471 L181.5,2750.765 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="65.412" style="stroke:#000000;stroke-width:1.5;" width="694" x="181.5" y="2750.765"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="22" x="196.5" y="2765.662">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="596" x="263.5" y="2764.5239">[id_token encryption used (JWE), see id_token_encrypted_response_alg / id_token_encrypted_response_enc]</text><polygon fill="#FEFFDD" points="212.5,2785.471,318.5,2785.471,328.5,2797.471,318.5,2810.471,212.5,2810.471,202.5,2797.471,212.5,2785.471" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="214.5" y="2803.368">Decrypt id_token</text><path d="M8,2834.177 L75,2834.177 L75,2843.883 L65,2853.883 L8,2853.883 L8,2834.177 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="399.3179" style="stroke:#000000;stroke-width:1.5;" width="1390" x="8" y="2834.177"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="22" x="23" y="2849.074">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="570" x="90" y="2847.9359">[Signature/MAC verification may be skipped when using this flow (when directly received from the OP)]</text><polygon fill="#FEFFDD" points="39,2868.883,492,2868.883,502,2880.883,492,2893.883,39,2893.883,29,2880.883,39,2868.883" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="449" x="41" y="2886.78">Check JWT "alg" parameter is expected one (id_token_signed_response_alg)</text><path d="M31.5,2903.589 L94.5,2903.589 L94.5,2913.2951 L84.5,2923.2951 L31.5,2923.2951 L31.5,2903.589 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="315.9059" style="stroke:#000000;stroke-width:1.5;" width="1341.5" x="31.5" y="2903.589"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="46.5" y="2918.4861">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="171" x="109.5" y="2917.348">[JWT is signed (alg=RS256, etc.)]</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="31.5" x2="1373" y1="3091.1191" y2="3091.1191"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="175" x="36.5" y="3104.878">[JWT is MACed (alg=HS256, etc.)]</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="31.5" x2="1373" y1="3159.807" y2="3159.807"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="170" x="36.5" y="3173.5659">[Unsecured JWT ("alg":"none")]</text><path d="M249.5,2937.2951 L316.5,2937.2951 L316.5,2947.0011 L306.5,2957.0011 L249.5,2957.0011 L249.5,2937.2951 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="93.118" style="stroke:#000000;stroke-width:1.5;" width="1098.5" x="249.5" y="2937.2951"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="22" x="264.5" y="2952.1921">opt</text><polygon fill="#181818" points="1320,2986.7071,1330,2990.7071,1320,2994.7071,1324,2990.7071" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="265.5" x2="1326" y1="2990.7071" y2="2990.7071"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="300" x="272.5" y="2984.8981">(cached) HTTPS GET https://op/jwks.json (jwks_uri)</text><polygon fill="#181818" points="276.5,3018.4131,266.5,3022.4131,276.5,3026.4131,272.5,3022.4131" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="270.5" x2="1331" y1="3022.4131" y2="3022.4131"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="282.5" y="3016.6041">HTTPS 200, JWKS (public keys)</text><polygon fill="#FEFFDD" points="120.5,3049.4131,410.5,3049.4131,420.5,3061.4131,410.5,3074.4131,120.5,3074.4131,110.5,3061.4131,120.5,3049.4131" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="286" x="122.5" y="3067.3101">Validate JWS signature (based on OP public pair)</text><polygon fill="#FEFFDD" points="150.5,3118.101,380.5,3118.101,390.5,3130.101,380.5,3143.101,150.5,3143.101,140.5,3130.101,150.5,3118.101" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226" x="152.5" y="3135.998">Validate JWS MAC (using client_secret)</text><path d="M52.5,3186.7889 L52.5,3213.7889 L478.5,3213.7889 L478.5,3196.7889 L468.5,3186.7889 L52.5,3186.7889 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M468.5,3186.7889 L468.5,3196.7889 L478.5,3196.7889 L468.5,3186.7889 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="405" x="58.5" y="3205.6859">⚠️ Don't accept "alg":"none" when not directly received from the OP!</text><polygon fill="#FEFFDD" points="144,3252.4949,387,3252.4949,397,3282.4949,387,3313.4949,144,3313.4949,134,3282.4949,144,3252.4949" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="146" y="3270.3919">Validate id_token claims</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="215" x="146" y="3288.098">eg. acr matches with requested one,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239" x="146" y="3305.804">auth_time consistent with max_age, etc.</text><polygon fill="#FEFFDD" points="192.5,3323.613,338.5,3323.613,348.5,3335.613,338.5,3348.613,192.5,3348.613,182.5,3335.613,192.5,3323.613" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="194.5" y="3341.51">Create user session, etc.</text><polygon fill="#181818" points="543.5,3374.025,553.5,3378.025,543.5,3382.025,547.5,3378.025" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="265.5" x2="549.5" y1="3378.025" y2="3378.025"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="266" x="272.5" y="3372.216">Restore application state (eg. target_link_uri)</text><polygon fill="#181818" points="721,3374.025,731,3378.025,721,3382.025,725,3378.025" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="555.5" x2="727" y1="3378.025" y2="3378.025"/><!--MD5=[7bf0eb590756e7bc8c3d6edf785aeda1]
@startuml

!pragma teoz true

participant "Relying Party\n(OAuth Client)\nhttps://rp" as client
box
    participant "User Agent / Frontend\nfor Relying Party" as uac
    actor "User\n(OAuth Resource Owner)" as user
    participant "User Agent / Frontend for\nOpenID Provider" as uaas
end box
participant "OpenID Provider\n(OAuth Authorization Server)\nhttps://op" as as


user -> uac: Request to login
& uac -> client

|||


opt PKCE used

hnote over client: Generate random code_verifier\nand derive code_challenge=\n  code_challenge_method(code_verifier)

end

client -> uac : (HTTPS 302)
& uac -> uaas: **Authentication Request** (OAuth Authorization Request)\nRedirection to GET (query) or POST (urlencoded) https://rp/auth (authorization_endpoint)\n  ?response_type=code (REQUIRED)\n  &client_id=CID-XXXX (REQUIRED, opaque)\n  &redirect_uri=https%3A%2F%2Fclient%2Ecallback (always REQUIRED in OpenID Connect)\n  &scope=openid+profile+email+phone (OPTIONAL)\n  &state=AS-XXXX (RECOMMENDED, opaque)\n  &nonce=AN-XXXX\n    (OPTIONAL using this flow but REQUIRED for other flows,\n    included in ID token, protect against replay attacks)\n  \n  &code_challenge_method=S256 (if PKCE used)\n  &code_challenge=CCCCCC (if PKCE used)\n  \n  &response_mode=query (or fragment, form_post, etc.)\n  &claims={"userinfo":{…}, "id_token": {…}} (OPTIONAL, list of required claims)\n  &display=page / popup / touch / wap (OPTIONAL)\n  &prompt=login (OPTIONAL, and/or none/consent/select_account)\n  &max_age=320 (OPTIONAL, max. authentication age)\n  &id_token_hint=eyJ… (OPTIONAL, previous ID token)\n  &login_hint=janedoe@example.com (OPTIONAL)\n  &acr_values=… (OPTIONAL, requested authentication context class)

note right: The request may as well be passed\nas a JWT (request=…)\nor as a reference to a JWT (request_uri=…)

& uaas -> as

hnote over as: Check redirect_uri allowed for client_id
& note over uac: For native apps, the redirect_uri may be\na claimed URI (https://…),\na private URI (com.example.foo:…),\nor a localhost URI (http://localhost:XXX/…)

opt User does not already have a session (or 'prompt' includes 'login')
  user <-> uaas : User authentication
  & uaas <-> as
  & note left of user: Authorization Server\nmay use any authentication methods\n(password, WebAuthn, mobile application, etc.)\nfor authenticating the user
end

opt User consent may be skipped if already given unless 'prompt' includes 'consent')
  user <-> uaas : Consent
  rnote left: "Do you want to login on ClientFoo? Information requested: …"
  & uaas <-> as
end

alt response_mode=query

as - -> uaas: (HTTPS 302)
& uaas - -> uac: **Authentication Response** (OAuth Authorization Response)\nRedirection to GET https://rp/callback (redirect_uri)\n  ?code=AC-XXXX (opaque, single-use)\n  &state=AS-XXXX (if given)\n  &iss=https://op (extension)
& uac - -> client

else response_mode=fragment

as - -> uaas: (HTTPS 302)
& uaas - -> uac: **Authentication Response** (OAuth Authorization Response)\nRedirection to GET https://rp/callback (redirect_uri)\n  #code=AC-XXXX (opaque, single-use)\n  &state=AS-XXXX (if given)\n  &iss=https://op (extension)
& uac - -> client

else response_mode=form_post

as - -> uaas: (HTTPS with HTML form)
& uaas - -> uac: **Authentication Response** (OAuth Authorization Response)\nHTTP POST https://rp/callback, urlencoded\ncode=AC-XXXX (opaque, single-use)\n&state=AS-XXXX (if given)\n&iss=https://op (extension)
& uac - -> client

else response_mode=query.jwt (JARM extension)

as - -> uaas: (HTTPS 302)
& uaas - -> uac: **Authentication Response** (OAuth Authorization Response)\nRedirection to GET https://rp/callback (redirect_uri)\n  ?response=eyJ… (JWT)
& uac - -> client

else response_mode=fragment.jwt (JARM extension)

as - -> uaas: (HTTPS 302)
& uaas - -> uac: **Authentication Response** (OAuth Authorization Response)\nRedirection to GET https://rp/callback (redirect_uri)\n  #response=eyJ… (JWT)
& uac - -> client

else response_mode=form_post.jwt (JARM extension)

as - -> uaas: (HTTPS with HTML form)
& uaas - -> uac: **Authentication Response** (OAuth Authorization Response)\nRedirection to POST https://rp/callback (redirect_uri), urlencoded\nresponse=eyJ… (JWT)
& uac - -> client

end

opt A JARM (JWT) request was used
hnote over client: Check validity of JARM\n(signature/MAC, aud, exp, iss, etc.)
end

hnote over client: Check validity of state\nand its association with the user session\n(protection against CSRF)
hnote over client: Check "iss" field (if given),\nprotection against mixup attacks

|||

client -> as: **Token Request** (OAuth Access Token Request)\nHTTPS POST https://op/token (token_endpoint), urlencoded\nAuthorization: Basic … (client_id + client_secret) (or other authentication method, see token_endpoint_auth_method)\ngrant_type=authorization_code\n  &code=AC-XXXX\n  &redirect_uri=https%3A%2F%2Fclient%2Fcallback (REQUIRED, same as in request)\n  &code_verifier=CV-XXXXV (if and only if code_challenge was used i.e. PKCE)

note right: If support for browser-based / single-page applications\nis needed the token endpoint need a suitable CORS policy.

hnote over as: Check (client authentication,\nredirect_uri, code, etc)
hnote over as: Check code issued to client_id
opt code_challenge was sent in authentication request
  hnote over as: Check code_verifier=\ncode_challenge_method(code_challenge)
else
  break code_verifier was supplied
    note over as: Protection against PKCE downgrade attacks
  end
end
hnote over as: Revoke code (single use)

client <- - as: **Token Response** (OAuth Access Token Response)\nHTTPS 200, JSON\n"access_token":"AT-XXXX", (opaque)\n"token_type":"bearer",\n"expires_in":3600\n"refresh_token":"RT-XXXX", (OPTIONAL, opaque)\n"scope":"scope1 scope2",\n"id_token": "eyJ…" JWT with claims,\n    "iss": "https://op",\n    "sub": "SUB-XXXX", (private for the client_id if subject_type=pairwise)\n    "aud": "CID-XXXX",\n    "exp": …, "iat": …, "auth_time": …,\n    "nonce": "AN-XXXX", (from request, protection against replay attacks)\n    "acr": "…", (OPTIONAL, authentication context class),\n    "amr": […], (OPTIONAL, list of user authentication methods used),\n    "azp": "CID-XXXX",n    "sid": "SID-XXX", (OPTIONAL, different for different RPs, for Front/Back-Channel Logout)

opt id_token encryption used (JWE), see id_token_encrypted_response_alg / id_token_encrypted_response_enc
    hnote over client: Decrypt id_token
end

opt Signature/MAC verification may be skipped when using this flow (when directly received from the OP)
  hnote over client: Check JWT "alg" parameter is expected one (id_token_signed_response_alg)
  alt JWT is signed (alg=RS256, etc.)
    opt
      client -> as: (cached) HTTPS GET https://op/jwks.json (jwks_uri)
      as - -> client: HTTPS 200, JWKS (public keys)
    end
    hnote over client: Validate JWS signature (based on OP public pair)
  else JWT is MACed (alg=HS256, etc.)
    hnote over client: Validate JWS MAC (using client_secret)
  else Unsecured JWT ("alg":"none")
    note over client: ⚠️ Don't accept "alg":"none" when not directly received from the OP!
  end
end

hnote over client: Validate id_token claims\neg. acr matches with requested one,\nauth_time consistent with max_age, etc.

hnote over client: Create user session, etc.

client -> uac: Restore application state (eg. target_link_uri)
& uac -> user

@enduml

PlantUML version 1.2022.13(Sat Nov 19 14:22:17 CET 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: fr
Country: FR
--></g></svg>