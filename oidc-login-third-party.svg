<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="694px" preserveAspectRatio="none" style="width:1032px;height:694px;background:#FFFFFF;" version="1.1" viewBox="0 0 1032 694" width="1032px" zoomAndPan="magnify"><defs/><g><rect fill="#DDDDDD" height="682.1879" style="stroke:#181818;stroke-width:0.5;" width="485" x="330" y="6"/><rect fill="none" height="232.336" style="stroke:#000000;stroke-width:1.5;" width="836" x="109.5" y="157.8419"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="125.5" x2="125.5" y1="108.1358" y2="584.0521"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="415.5" x2="415.5" y1="108.1358" y2="584.0521"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="593" x2="593" y1="108.1358" y2="584.0521"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="755.5" x2="755.5" y1="108.1358" y2="584.0521"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="929.5" x2="929.5" y1="108.1358" y2="584.0521"/><rect fill="#E2E2F0" height="71.2038" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108" x="71.5" y="35.9321"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="81.5" y="57.898">Relying Party</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="78.5" y="76.9659">(OAuth Client)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="93.5" y="96.0339">https://rp</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="163" x="334" y="55"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="149" x="341" y="76.9659">User Agent / Frontend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="360" y="96.0339">for Relying Party</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="574.5" y="84.9659">User</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="166" x="507" y="104.0339">(OAuth Resource Owner)</text><ellipse cx="593" cy="18.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M593,26.5 L593,53.5 M580,34.5 L606,34.5 M593,53.5 L580,68.5 M593,53.5 L606,68.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="111" x="700" y="55"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75" x="718" y="76.9659">User-agent</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97" x="707" y="96.0339">for Third Party</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="885.5" y="74.0679"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="892.5" y="96.0339">Third Party</text><rect fill="#E2E2F0" height="71.2038" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108" x="71.5" y="584.0521"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="81.5" y="606.018">Relying Party</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="78.5" y="625.0859">(OAuth Client)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="93.5" y="644.1539">https://rp</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="163" x="334" y="584.0521"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="149" x="341" y="606.018">User Agent / Frontend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="360" y="625.0859">for Relying Party</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="574.5" y="659.018">User</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="166" x="507" y="678.0859">(OAuth Resource Owner)</text><ellipse cx="593" cy="592.5521" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M593,600.5521 L593,627.5521 M580,608.5521 L606,608.5521 M593,627.5521 L580,642.5521 M593,627.5521 L606,642.5521 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="111" x="700" y="584.0521"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75" x="718" y="606.018">User-agent</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97" x="707" y="625.0859">for Third Party</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="885.5" y="584.0521"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="892.5" y="606.018">Third Party</text><path d="M834,121.1358 L834,148.1358 L1025,148.1358 L1025,131.1358 L1015,121.1358 L834,121.1358 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1015,121.1358 L1015,131.1358 L1025,131.1358 L1015,121.1358 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170" x="840" y="140.0328">May be the OpenID provider</text><path d="M109.5,157.8419 L172.5,157.8419 L172.5,167.5479 L162.5,177.5479 L109.5,177.5479 L109.5,157.8419 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="232.336" style="stroke:#000000;stroke-width:1.5;" width="836" x="109.5" y="157.8419"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="124.5" y="172.7389">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="61" x="187.5" y="171.6008">[Using GET]</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="109.5" x2="945.5" y1="283.3719" y2="283.3719"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="222" x="114.5" y="297.1308">[Using HTML form and urlencoded POST]</text><polygon fill="#181818" points="766.5,260.3719,756.5,264.3719,766.5,268.3719,762.5,264.3719" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="760.5" x2="928.5" y1="264.3719" y2="264.3719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="772.5" y="258.5629">(HTTPS 302)</text><polygon fill="#181818" points="426.5,260.3719,416.5,264.3719,426.5,268.3719,422.5,264.3719" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="420.5" x2="754.5" y1="264.3719" y2="264.3719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="316" x="432.5" y="205.4449">Redirection to GET https://rp/login (initiate_login_uri)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="438.5" y="223.1509">?iss=https://op</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="292" x="438.5" y="240.8569">&amp;login_hint=janedoe@example.com (OPTIONAL)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="278" x="438.5" y="258.5629">&amp;target_link_uri=https://rp/page4 (OPTIONAL)</text><polygon fill="#181818" points="136.5,260.3719,126.5,264.3719,136.5,268.3719,132.5,264.3719" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="130.5" x2="414.5" y1="264.3719" y2="264.3719"/><polygon fill="#181818" points="766.5,378.1779,756.5,382.1779,766.5,386.1779,762.5,382.1779" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="760.5" x2="928.5" y1="382.1779" y2="382.1779"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="772.5" y="376.3689">(HTTPS with HTML Form)</text><polygon fill="#181818" points="426.5,378.1779,416.5,382.1779,426.5,386.1779,422.5,382.1779" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="420.5" x2="754.5" y1="382.1779" y2="382.1779"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="286" x="432.5" y="323.2508">Redirection to POST https://rp/login urlencoded</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="432.5" y="340.9569">iss=https://op</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="292" x="438.5" y="358.6629">&amp;login_hint=janedoe@example.com (OPTIONAL)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="278" x="438.5" y="376.3689">&amp;target_link_uri=https://rp/page4 (OPTIONAL)</text><polygon fill="#181818" points="136.5,378.1779,126.5,382.1779,136.5,386.1779,132.5,382.1779" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="130.5" x2="414.5" y1="382.1779" y2="382.1779"/><polygon fill="#FEFFDD" points="32.5,409.1779,218.5,409.1779,228.5,430.1779,218.5,452.1779,32.5,452.1779,22.5,430.1779,32.5,409.1779" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="34.5" y="427.0749">⚠️ Validate target_link_uri</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182" x="34.5" y="444.7809">(protect against open redirect)</text><polygon fill="#FEFFDD" points="20,462.5899,231,462.5899,241,474.5899,231,487.5899,20,487.5899,10,474.5899,20,462.5899" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207" x="22" y="480.4869">Associate target_link_uri with state</text><rect fill="none" height="44.0501" style="stroke:#000000;stroke-width:1.5;" width="603.5" x="73.5" y="493.2959"/><path d="M73.5,493.2959 L137.5,493.2959 L137.5,502.2959 L127.5,512.2959 L73.5,512.2959 L73.5,493.2959 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="86.5" y="509.1929">ref</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="153" x="298.75" y="529.124">Some OpenID Connect flow</text><polygon fill="#181818" points="403.5,562.0521,413.5,566.0521,403.5,570.0521,407.5,566.0521" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="125.5" x2="409.5" y1="566.0521" y2="566.0521"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="266" x="132.5" y="560.2431">Restore application state (eg. target_link_uri)</text><polygon fill="#181818" points="581,562.0521,591,566.0521,581,570.0521,585,566.0521" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="415.5" x2="587" y1="566.0521" y2="566.0521"/><!--MD5=[306863459ad088c0b69d0a3c2b35c74d]
@startuml

!pragma teoz true

participant "Relying Party\n(OAuth Client)\nhttps://rp" as client
box
    participant "User Agent / Frontend\nfor Relying Party" as uac
    actor "User\n(OAuth Resource Owner)" as user
    participant "User-agent\nfor Third Party" as ua  
end box
participant "Third Party" as tp

note over tp: May be the OpenID provider

alt Using GET

tp -> ua: (HTTPS 302)

& ua -> uac : Redirection to GET https://rp/login (initiate_login_uri)\n  ?iss=https://op\n  &login_hint=janedoe@example.com (OPTIONAL)\n  &target_link_uri=https://rp/page4 (OPTIONAL)
& uac->client

else Using HTML form and urlencoded POST

tp -> ua : (HTTPS with HTML Form)

& ua->uac: Redirection to POST https://rp/login urlencoded\niss=https://op\n  &login_hint=janedoe@example.com (OPTIONAL)\n  &target_link_uri=https://rp/page4 (OPTIONAL)

& uac->client

end

hnote over client: ⚠️ Validate target_link_uri\n(protect against open redirect)
hnote over client: Associate target_link_uri with state

ref over client, user: Some OpenID Connect flow

client -> uac: Restore application state (eg. target_link_uri)
& uac -> user  

@enduml

PlantUML version 1.2022.13(Sat Nov 19 14:22:17 CET 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: fr
Country: FR
--></g></svg>