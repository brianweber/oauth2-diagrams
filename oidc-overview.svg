<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="957px" preserveAspectRatio="none" style="width:770px;height:957px;background:#FFFFFF;" version="1.1" viewBox="0 0 770 957" width="770px" zoomAndPan="magnify"><defs/><g><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="95.5" x2="95.5" y1="77.2038" y2="531.206"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="95.5" x2="95.5" y1="531.206" y2="574.1879"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="95.5" x2="95.5" y1="574.1879" y2="880.6601"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="643.5" x2="643.5" y1="77.2038" y2="531.206"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="643.5" x2="643.5" y1="531.206" y2="574.1879"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="643.5" x2="643.5" y1="574.1879" y2="880.6601"/><rect fill="#FFFFFF" height="102.8241" style="stroke:#181818;stroke-width:1.0;" width="10" x="638.5" y="180.0278"/><rect fill="#FFFFFF" height="67.118" style="stroke:#181818;stroke-width:1.0;" width="10" x="638.5" y="349.9699"/><rect fill="#FFFFFF" height="31.706" style="stroke:#181818;stroke-width:1.0;" width="10" x="638.5" y="491.5"/><rect fill="#FFFFFF" height="31.706" style="stroke:#181818;stroke-width:1.0;" width="10" x="638.5" y="615.6"/><rect fill="#FFFFFF" height="67.118" style="stroke:#181818;stroke-width:1.0;" width="10" x="638.5" y="714.424"/><rect fill="#FFFFFF" height="31.706" style="stroke:#181818;stroke-width:1.0;" width="10" x="638.5" y="830.9541"/><rect fill="#E2E2F0" height="71.2038" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108" x="41.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="51.5" y="26.9659">Relying Party</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="48.5" y="46.0339">(OAuth Client)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="63.5" y="65.1018">https://rp</text><rect fill="#E2E2F0" height="71.2038" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="207" x="540" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="587.5" y="26.9659">OpenID Provider</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="193" x="547" y="46.0339">(OAuth Authorization Server)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="610.5" y="65.1018">https://op</text><rect fill="#E2E2F0" height="71.2038" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108" x="41.5" y="880.6601"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="51.5" y="902.6261">Relying Party</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="48.5" y="921.694">(OAuth Client)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="63.5" y="940.7619">https://rp</text><rect fill="#E2E2F0" height="71.2038" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="207" x="540" y="880.6601"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="587.5" y="902.6261">OpenID Provider</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="193" x="547" y="921.694">(OAuth Authorization Server)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="610.5" y="940.7619">https://op</text><polygon fill="#FEFFDD" points="20,90.2038,171,90.2038,181,102.2038,171,115.2038,20,115.2038,10,102.2038,20,90.2038" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="22" y="108.1008">User starts login process</text><polygon fill="#181818" points="626.5,176.0278,636.5,180.0278,626.5,184.0278,630.5,180.0278" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="95.5" x2="632.5" y1="180.0278" y2="180.0278"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="159" x="102.5" y="138.8068">Authentication Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="356" x="102.5" y="156.5128">Front channel GET https://as/auth (authorization_endpoint)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="262" x="102.5" y="174.2188">client_id, redirect_uri=https://client/callback,</text><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="30" x="367.5" y="174.2188">state</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="3" x="397.5" y="174.2188">,</text><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="37" x="403.5" y="174.2188">nonce</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="3" x="440.5" y="174.2188">,</text><text fill="#008000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="446.5" y="174.2188">code_challenge</text><polygon fill="#FEFFDD" points="543.5,193.0278,743.5,193.0278,753.5,205.0278,743.5,218.0278,543.5,218.0278,533.5,205.0278,543.5,193.0278" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196" x="545.5" y="210.9248">User authentication and consent</text><polygon fill="#181818" points="106.5,278.8519,96.5,282.8519,106.5,286.8519,102.5,282.8519" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="100.5" x2="637.5" y1="282.8519" y2="282.8519"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="167" x="112.5" y="241.6308">Authentication Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="371" x="112.5" y="259.3369">Front channel GET or POST https://client/callback (redirect_uri)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="112.5" y="277.0429">code</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="3" x="141.5" y="277.0429">,</text><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="30" x="147.5" y="277.0429">state</text><polygon fill="#181818" points="626.5,345.9699,636.5,349.9699,626.5,353.9699,630.5,349.9699" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="95.5" x2="632.5" y1="349.9699" y2="349.9699"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="144" x="102.5" y="308.7489">Access Token Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="519" x="102.5" y="326.4549">HTTPS POST https://as/token (token_endpoint), urlencoded (with client authentication)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="102.5" y="344.1609">code</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="408" x="131.5" y="344.1609">, grant_type=authorization_code, redirect_uri=https://client/callback,</text><text fill="#008000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="542.5" y="344.1609">code_verifier</text><polygon fill="#181818" points="106.5,413.088,96.5,417.088,106.5,421.088,102.5,417.088" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="100.5" x2="637.5" y1="417.088" y2="417.088"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="152" x="112.5" y="375.8669">Access Token Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="112.5" y="393.573">HTTPS 200, JSON</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="112.5" y="411.279">access_token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="194.5" y="411.279">(JWT, including</text><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="37" x="285.5" y="411.279">nonce</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="38" x="325.5" y="411.279">claim),</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="366.5" y="411.279">access_token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="3" x="445.5" y="411.279">,</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="451.5" y="411.279">refresh_token</text><polygon fill="#181818" points="626.5,487.5,636.5,491.5,626.5,495.5,630.5,491.5" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="95.5" x2="632.5" y1="491.5" y2="491.5"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="114" x="102.5" y="467.985">UserInfo Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="264" x="102.5" y="485.691">HTTPS GET/POST/… https://op/userinfo with</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="369.5" y="485.691">access_token</text><polygon fill="#181818" points="106.5,519.206,96.5,523.206,106.5,527.206,102.5,523.206" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="100.5" x2="637.5" y1="523.206" y2="523.206"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="122" x="112.5" y="517.397">UserInfo Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169" x="234.5" y="517.397">, HTTPS 200, JSON (user info)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="138" x="300.5" y="556.9649">later, access_token expires</text><polygon fill="#181818" points="626.5,611.6,636.5,615.6,626.5,619.6,630.5,615.6" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="95.5" x2="632.5" y1="615.6" y2="615.6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="114" x="102.5" y="592.0849">UserInfo Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="264" x="102.5" y="609.7909">HTTPS GET/POST/… https://op/userinfo with</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="369.5" y="609.7909">access_token</text><polygon fill="#181818" points="106.5,643.306,96.5,647.306,106.5,651.306,102.5,647.306" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="100.5" x2="637.5" y1="647.306" y2="647.306"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="122" x="112.5" y="641.497">UserInfo Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="230" x="234.5" y="641.497">, HTTPS 401, Bearer error invalid_token</text><polygon fill="#181818" points="626.5,710.424,636.5,714.424,626.5,718.424,630.5,714.424" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="95.5" x2="632.5" y1="714.424" y2="714.424"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="152" x="102.5" y="673.203">Refresh Token Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="519" x="102.5" y="690.909">HTTPS POST https://as/token (token_endpoint), urlencoded (with client authentication)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="102.5" y="708.615">refresh_token</text><polygon fill="#181818" points="106.5,777.5421,96.5,781.5421,106.5,785.5421,102.5,781.5421" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="100.5" x2="637.5" y1="781.5421" y2="781.5421"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="160" x="112.5" y="740.321">Refresh Token Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="112.5" y="758.027">HTTPS 200, JSON</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="112.5" y="775.7331">access_token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="3" x="191.5" y="775.7331">,</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="197.5" y="775.7331">refresh_token</text><polygon fill="#181818" points="626.5,826.9541,636.5,830.9541,626.5,834.9541,630.5,830.9541" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="95.5" x2="632.5" y1="830.9541" y2="830.9541"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="114" x="102.5" y="807.4391">UserInfo Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="264" x="102.5" y="825.1451">HTTPS GET/POST/… https://op/userinfo with</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="369.5" y="825.1451">access_token</text><polygon fill="#181818" points="106.5,858.6601,96.5,862.6601,106.5,866.6601,102.5,862.6601" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="100.5" x2="637.5" y1="862.6601" y2="862.6601"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="122" x="112.5" y="856.8511">UserInfo Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169" x="234.5" y="856.8511">, HTTPS 200, JSON (user info)</text><!--MD5=[6064209c7f4b12dc3f69d241b7202b09]
@startuml

!pragma teoz true

participant "Relying Party\n(OAuth Client)\nhttps://rp" as client
participant "OpenID Provider\n(OAuth Authorization Server)\nhttps://op" as as

hnote over client: User starts login process

client -> as ++: **Authentication Request**\nFront channel GET https://as/auth (authorization_endpoint)\nclient_id, redirect_uri=https://client/callback, <color:blue>state</color>, <color:blue>nonce</color>, <color:green>code_challenge</color>

hnote over as: User authentication and consent

as - -> client - -: **Authentication Response**\nFront channel GET or POST https://client/callback (redirect_uri)\n<color:red>code</color>, <color:blue>state</color>

client -> as ++ : **Access Token Request**\nHTTPS POST https://as/token (token_endpoint), urlencoded (with client authentication)\n<color:red>code</color>, grant_type=authorization_code, redirect_uri=https://client/callback, <color:green>code_verifier</color>

as - -> client - -: **Access Token Response**\nHTTPS 200, JSON\n<color:red>access_token</color> (JWT, including <color:blue>nonce</color> claim), <color:red>access_token</color>, <color:red>refresh_token</color>

|||

client -> as ++ : **UserInfo Request**\nHTTPS GET/POST/… https://op/userinfo with <color:red>access_token</color>
as - -> client - -: **UserInfo Response**, HTTPS 200, JSON (user info)

... later, access_token expires ...

client -> as ++ : **UserInfo Request**\nHTTPS GET/POST/… https://op/userinfo with <color:red>access_token</color>
as - -> client - -: **UserInfo Response**, HTTPS 401, Bearer error invalid_token

client -> as ++ : **Refresh Token Request**\nHTTPS POST https://as/token (token_endpoint), urlencoded (with client authentication)\n<color:red>refresh_token</color>

as - -> client - -: **Refresh Token Response**\nHTTPS 200, JSON\n<color:red>access_token</color>, <color:red>refresh_token</color>

client -> as ++ : **UserInfo Request**\nHTTPS GET/POST/… https://op/userinfo with <color:red>access_token</color>
as - -> client - -: **UserInfo Response**, HTTPS 200, JSON (user info)

@enduml

PlantUML version 1.2022.13(Sat Nov 19 14:22:17 CET 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: fr
Country: FR
--></g></svg>