<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1260px" preserveAspectRatio="none" style="width:1061px;height:1260px;background:#FFFFFF;" version="1.1" viewBox="0 0 1061 1260" width="1061px" zoomAndPan="magnify"><defs/><g><rect fill="#DDDDDD" height="1248.2581" style="stroke:#181818;stroke-width:0.5;" width="590.5" x="164" y="6"/><rect fill="none" height="83.118" style="stroke:#000000;stroke-width:1.5;" width="200" x="8" y="249.9599"/><rect fill="none" height="93.118" style="stroke:#000000;stroke-width:1.5;" width="770.5" x="92" y="351.0779"/><rect fill="none" height="280.7662" style="stroke:#000000;stroke-width:1.5;" width="770.5" x="92" y="462.196"/><rect fill="none" height="93.118" style="stroke:#000000;stroke-width:1.5;" width="770.5" x="92" y="851.7862"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="108" x2="108" y1="108.1358" y2="1097.1404"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="108" x2="108" y1="1097.1404" y2="1140.1223"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="108" x2="108" y1="1140.1223" y2="1150.1223"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="249.5" x2="249.5" y1="108.1358" y2="1097.1404"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="249.5" x2="249.5" y1="1097.1404" y2="1140.1223"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="249.5" x2="249.5" y1="1140.1223" y2="1150.1223"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="494.5" x2="494.5" y1="108.1358" y2="1097.1404"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="494.5" x2="494.5" y1="1097.1404" y2="1140.1223"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="494.5" x2="494.5" y1="1140.1223" y2="1150.1223"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="657.5" x2="657.5" y1="108.1358" y2="1097.1404"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="657.5" x2="657.5" y1="1097.1404" y2="1140.1223"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="657.5" x2="657.5" y1="1140.1223" y2="1150.1223"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="846.5" x2="846.5" y1="108.1358" y2="1097.1404"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="846.5" x2="846.5" y1="1097.1404" y2="1140.1223"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="846.5" x2="846.5" y1="1140.1223" y2="1150.1223"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="994" x2="994" y1="108.1358" y2="1097.1404"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="994" x2="994" y1="1097.1404" y2="1140.1223"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="994" x2="994" y1="1140.1223" y2="1150.1223"/><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="100" x="58" y="55"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="88.5" y="76.9659">Client</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="65" y="96.0339">https://client</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="163" x="168" y="55"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="149" x="175" y="76.9659">User Agent / Frontend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="218.5" y="96.0339">for Client</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="436" y="84.9659">Resource Owner</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="472" y="104.0339">(User)</text><ellipse cx="494.5" cy="18.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M494.5,26.5 L494.5,53.5 M481.5,34.5 L507.5,34.5 M494.5,53.5 L481.5,68.5 M494.5,53.5 L507.5,68.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="186" x="564.5" y="55"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="172" x="571.5" y="76.9659">User Agent / Frontend for</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="588.5" y="96.0339">Authorization Server</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="152" x="770.5" y="55"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="777.5" y="76.9659">Authorization Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="814.5" y="96.0339">https://as</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="123" x="932.5" y="55"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109" x="939.5" y="76.9659">Resource Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="963" y="96.0339">https://rs</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="100" x="58" y="1150.1223"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="88.5" y="1172.0882">Client</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="65" y="1191.1561">https://client</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="163" x="168" y="1150.1223"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="149" x="175" y="1172.0882">User Agent / Frontend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="218.5" y="1191.1561">for Client</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="436" y="1225.0882">Resource Owner</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="472" y="1244.1561">(User)</text><ellipse cx="494.5" cy="1158.6223" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M494.5,1166.6223 L494.5,1193.6223 M481.5,1174.6223 L507.5,1174.6223 M494.5,1193.6223 L481.5,1208.6223 M494.5,1193.6223 L507.5,1208.6223 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="186" x="564.5" y="1150.1223"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="172" x="571.5" y="1172.0882">User Agent / Frontend for</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="588.5" y="1191.1561">Authorization Server</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="152" x="770.5" y="1150.1223"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="777.5" y="1172.0882">Authorization Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="814.5" y="1191.1561">https://as</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="123" x="932.5" y="1150.1223"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109" x="939.5" y="1172.0882">Resource Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="963" y="1191.1561">https://rs</text><path d="M626.5,121.1358 L626.5,184.1358 L877.5,184.1358 L877.5,131.1358 L867.5,121.1358 L626.5,121.1358 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M867.5,121.1358 L867.5,131.1358 L877.5,131.1358 L867.5,121.1358 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="632.5" y="140.0328">Relevant AS Metadata:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="632.5" y="157.7389">"jwks_uri": "http://as/jwks.json",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="230" x="632.5" y="175.4449">"require_signed_request_object": false,</text><path d="M29.75,121.1358 L29.75,184.1358 L327.75,184.1358 L327.75,131.1358 L317.75,121.1358 L29.75,121.1358 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M317.75,121.1358 L317.75,131.1358 L327.75,131.1358 L317.75,121.1358 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="35.75" y="140.0328">Relevant Client Metadata:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="277" x="35.75" y="157.7389">"jwks_uri": "http://as/jwks.json" (or "jwks": {â€¦}),</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="230" x="35.75" y="175.4449">"require_signed_request_object": false,</text><polygon fill="#181818" points="260.5,208.9599,250.5,212.9599,260.5,216.9599,256.5,212.9599" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="254.5" x2="493.5" y1="212.9599" y2="212.9599"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221" x="266.5" y="207.1509">Request to authorize resource access</text><polygon fill="#181818" points="119,208.9599,109,212.9599,119,216.9599,115,212.9599" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="113" x2="248.5" y1="212.9599" y2="212.9599"/><path d="M8,249.9599 L75,249.9599 L75,259.6659 L65,269.6659 L8,269.6659 L8,249.9599 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="83.118" style="stroke:#000000;stroke-width:1.5;" width="200" x="8" y="249.9599"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="22" x="23" y="264.8569">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="64" x="90" y="263.7188">[PKCE used]</text><polygon fill="#FEFFDD" points="39,284.6659,177,284.6659,187,305.6659,177,327.6659,39,327.6659,29,305.6659,39,284.6659" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="41" y="302.5629">Generate code_verifier</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="41" y="320.2689">and code_challenge</text><path d="M92,351.0779 L159,351.0779 L159,360.784 L149,370.784 L92,370.784 L92,351.0779 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="93.118" style="stroke:#000000;stroke-width:1.5;" width="770.5" x="92" y="351.0779"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="22" x="107" y="365.975">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="99" x="174" y="364.8369">[Encryption (JWE)]</text><polygon fill="#181818" points="834.5,400.49,844.5,404.49,834.5,408.49,838.5,404.49" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="108" x2="840.5" y1="404.49" y2="404.49"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="232" x="115" y="398.681">HTTPS GET http://as/jwks.json (cached)</text><polygon fill="#181818" points="119,432.196,109,436.196,119,440.196,115,436.196" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="113" x2="845.5" y1="436.196" y2="436.196"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217" x="125" y="430.387">HTTPS 200, JWKS (server public keys)</text><path d="M92,462.196 L155,462.196 L155,471.902 L145,481.902 L92,481.902 L92,462.196 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="280.7662" style="stroke:#000000;stroke-width:1.5;" width="770.5" x="92" y="462.196"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="107" y="477.093">alt</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="92" x2="862.5" y1="587.7261" y2="587.7261"/><polygon fill="#181818" points="237.5,564.7261,247.5,568.7261,237.5,572.7261,241.5,568.7261" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="108" x2="243.5" y1="568.7261" y2="568.7261"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="115" y="562.9171">(HTTPS 302)</text><polygon fill="#181818" points="645.5,564.7261,655.5,568.7261,645.5,572.7261,649.5,568.7261" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="249.5" x2="651.5" y1="568.7261" y2="568.7261"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="149" x="256.5" y="509.799">Authorization Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="357" x="256.5" y="527.505">Redirection to GET https://as/auth (authorization_endpoint)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="245" x="262.5" y="545.2111">?client_id=CID-XXXX (opaque, REQUIRED)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="272" x="262.5" y="562.9171">&amp;request=eyJâ€¦ (authorization request in JWT)</text><polygon fill="#181818" points="834.5,564.7261,844.5,568.7261,834.5,572.7261,838.5,568.7261" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="657.5" x2="840.5" y1="568.7261" y2="568.7261"/><polygon fill="#181818" points="237.5,667.5501,247.5,671.5501,237.5,675.5501,241.5,671.5501" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="108" x2="243.5" y1="671.5501" y2="671.5501"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="115" y="665.7411">(HTTPS 302)</text><polygon fill="#181818" points="645.5,667.5501,655.5,671.5501,645.5,675.5501,649.5,671.5501" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="249.5" x2="651.5" y1="671.5501" y2="671.5501"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="149" x="256.5" y="612.6231">Authorization Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="357" x="256.5" y="630.3291">Redirection to GET https://as/auth (authorization_endpoint)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="245" x="262.5" y="648.0351">?client_id=CID-XXXX (opaque, REQUIRED)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="378" x="262.5" y="665.7411">&amp;request_uri=https://client/ZZZZZZ.jwt (request payload in JWT)</text><polygon fill="#181818" points="834.5,667.5501,844.5,671.5501,834.5,675.5501,838.5,671.5501" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="657.5" x2="840.5" y1="671.5501" y2="671.5501"/><polygon fill="#181818" points="119,699.2562,109,703.2562,119,707.2562,115,703.2562" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="113" x2="845.5" y1="703.2562" y2="703.2562"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="125" y="697.4472">HTTPS GET https://client/ZZZZZZ.jwt</text><polygon fill="#181818" points="834.5,730.9622,844.5,734.9622,834.5,738.9622,838.5,734.9622" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="108" x2="840.5" y1="734.9622" y2="734.9622"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="230" x="115" y="729.1532">HTTP 200, JWT (Authorization Request)</text><path d="M58.75,761.9622 L58.75,841.9622 L543.75,841.9622 L543.75,771.9622 L533.75,761.9622 L58.75,761.9622 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M533.75,761.9622 L533.75,771.9622 L543.75,771.9622 L533.75,761.9622 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="393" x="100.25" y="780.8592">Request may be signed (JWS) or signed-then-encrypted (JWS+JWE)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="285" x="100.25" y="798.5652">JWT header "kid" may reference the keys to use"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="100.25" y="816.2712">JWT header "type": "oauth-authz-req+jwt"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="389" x="100.25" y="833.9772">JWT claims: authorization request + "iss" (client_id) + "aud" (issuer)</text><path d="M92,851.7862 L159,851.7862 L159,861.4923 L149,871.4923 L92,871.4923 L92,851.7862 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="93.118" style="stroke:#000000;stroke-width:1.5;" width="770.5" x="92" y="851.7862"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="22" x="107" y="866.6833">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="161" x="174" y="865.5452">[Signature Verification (JWS)]</text><polygon fill="#181818" points="119,901.1983,109,905.1983,119,909.1983,115,905.1983" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="113" x2="845.5" y1="905.1983" y2="905.1983"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="251" x="125" y="899.3893">HTTPS GET http://client/jwks.json (cached)</text><polygon fill="#181818" points="834.5,932.9043,844.5,936.9043,834.5,940.9043,838.5,936.9043" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="108" x2="840.5" y1="936.9043" y2="936.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="212" x="115" y="931.0953">HTTPS 200, JWKS (client public keys)</text><polygon fill="#FEFFDD" points="765.5,963.9043,927.5,963.9043,937.5,1002.9043,927.5,1041.9043,765.5,1041.9043,755.5,1002.9043,765.5,963.9043" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73" x="767.5" y="981.8013">Decrypt JWT</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="767.5" y="999.5073">(using serveur private key)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="767.5" y="1017.2133">and/or check signature</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139" x="767.5" y="1034.9194">(using client public key)</text><polygon fill="#181818" points="668.5,1085.1404,658.5,1089.1404,668.5,1093.1404,664.5,1089.1404" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="662.5" x2="845.5" y1="1089.1404" y2="1089.1404"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="674.5" y="1083.3314">(HTTPS 302)</text><polygon fill="#181818" points="260.5,1085.1404,250.5,1089.1404,260.5,1093.1404,256.5,1089.1404" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="254.5" x2="656.5" y1="1089.1404" y2="1089.1404"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="149" x="266.5" y="1065.6254">Authorization Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="232" x="266.5" y="1083.3314">Redirection to https://client/callback?â€¦</text><polygon fill="#181818" points="119,1085.1404,109,1089.1404,119,1093.1404,115,1089.1404" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="113" x2="248.5" y1="1089.1404" y2="1089.1404"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="80" x="511" y="1122.8993">end of the flow</text><!--MD5=[fc134470ad1fb3a7ca38f7219a38a2e4]
@startuml

!pragma teoz true

participant "Client\nhttps://client" as client
box
    participant "User Agent / Frontend\nfor Client" as uac
    actor "Resource Owner\n(User)" as user
    participant "User Agent / Frontend for\nAuthorization Server" as uaas
end box
participant "Authorization Server\nhttps://as" as as
participant "Resource Server\nhttps://rs" as rs

note over as, uaas:Relevant AS Metadata:\n"jwks_uri": "http://as/jwks.json",\n"require_signed_request_object": false,

& note over client, uac:Relevant Client Metadata:\n"jwks_uri": "http://as/jwks.json" (or "jwks": {â€¦}),\n"require_signed_request_object": false,

user -> uac: Request to authorize resource access
& uac -> client

|||

opt PKCE used
  hnote over client: Generate code_verifier\nand code_challenge
end

opt Encryption (JWE)
    client -> as: HTTPS GET http://as/jwks.json (cached)
    as - -> client: HTTPS 200, JWKS (server public keys)
end

alt 

client -> uac : (HTTPS 302)
& uac -> uaas : **Authorization Request**\nRedirection to GET https://as/auth (authorization_endpoint)\n  ?client_id=CID-XXXX (opaque, REQUIRED)\n  &request=eyJâ€¦ (authorization request in JWT)
& uaas -> as

else

client -> uac : (HTTPS 302)
& uac -> uaas: **Authorization Request**\nRedirection to GET https://as/auth (authorization_endpoint)\n  ?client_id=CID-XXXX (opaque, REQUIRED)\n  &request_uri=https://client/ZZZZZZ.jwt (request payload in JWT)
& uaas -> as

as -> client: HTTPS GET https://client/ZZZZZZ.jwt
client - -> as: HTTP 200, JWT (Authorization Request)

end

note over client, user:Request may be signed (JWS) or signed-then-encrypted (JWS+JWE)\nJWT header "kid" may reference the keys to use"\nJWT header "type": "oauth-authz-req+jwt"\nJWT claims: authorization request + "iss" (client_id) + "aud" (issuer)

opt Signature Verification (JWS)
    as -> client : HTTPS GET http://client/jwks.json (cached)
    client - -> as: HTTPS 200, JWKS (client public keys)
end

hnote over as: Decrypt JWT\n(using serveur private key)\nand/or check signature\n(using client public key)

as -> uaas: (HTTPS 302)
& uaas -> uac: **Authorization Request**\nRedirection to https://client/callback?â€¦
& uac -> client

... end of the flow ...

@enduml

PlantUML version 1.2022.13(Sat Nov 19 14:22:17 CET 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: fr
Country: FR
--></g></svg>