<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1504px" preserveAspectRatio="none" style="width:1352px;height:1504px;background:#FFFFFF;" version="1.1" viewBox="0 0 1352 1504" width="1352px" zoomAndPan="magnify"><defs/><g><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="91" x2="91" y1="122.2038" y2="1383.0848"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="268.5" x2="268.5" y1="122.2038" y2="1383.0848"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="493.5" x2="493.5" y1="122.2038" y2="1383.0848"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1079.5" x2="1079.5" y1="122.2038" y2="1383.0848"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1269" x2="1269" y1="122.2038" y2="1383.0848"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="72.5" y="79.9659">User</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="166" x="5" y="99.0339">(OAuth Resource Owner)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="156" x="10" y="118.1018">janedoe@example.com</text><ellipse cx="91" cy="13.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M91,21.5 L91,48.5 M78,29.5 L104,29.5 M91,48.5 L78,63.5 M91,48.5 L104,63.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="163" x="187" y="69.0679"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="149" x="194" y="91.0339">User Agent / Frontend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="213" y="110.1018">for Relying Party</text><rect fill="#E2E2F0" height="71.2038" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108" x="439.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="449.5" y="71.9659">Relying Party</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="446.5" y="91.0339">(OAuth Client)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="461.5" y="110.1018">https://rp</text><rect fill="#E2E2F0" height="71.2038" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="207" x="976" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="1023.5" y="71.9659">OpenID Provider</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="193" x="983" y="91.0339">(OAuth Authorization Server)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="1046.5" y="110.1018">https://op</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="152" x="1193" y="69.0679"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="1226" y="91.0339">User domain</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="1200" y="110.1018">https://example.com</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="72.5" y="1458.0507">User</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="166" x="5" y="1477.1186">(OAuth Resource Owner)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="156" x="10" y="1496.1866">janedoe@example.com</text><ellipse cx="91" cy="1391.5848" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M91,1399.5848 L91,1426.5848 M78,1407.5848 L104,1407.5848 M91,1426.5848 L78,1441.5848 M91,1426.5848 L104,1441.5848 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="163" x="187" y="1383.0848"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="149" x="194" y="1405.0507">User Agent / Frontend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="213" y="1424.1186">for Relying Party</text><rect fill="#E2E2F0" height="71.2038" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108" x="439.5" y="1383.0848"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="449.5" y="1405.0507">Relying Party</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="446.5" y="1424.1186">(OAuth Client)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="461.5" y="1443.1866">https://rp</text><rect fill="#E2E2F0" height="71.2038" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="207" x="976" y="1383.0848"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="1023.5" y="1405.0507">OpenID Provider</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="193" x="983" y="1424.1186">(OAuth Authorization Server)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="1046.5" y="1443.1866">https://op</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="152" x="1193" y="1383.0848"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="1226" y="1405.0507">User domain</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="1200" y="1424.1186">https://example.com</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1340" x="5" y="152.0568"/><line style="stroke:#000000;stroke-width:1.0;" x1="5" x2="1345" y1="152.0568" y2="152.0568"/><line style="stroke:#000000;stroke-width:1.0;" x1="5" x2="1345" y1="155.0568" y2="155.0568"/><rect fill="#EEEEEE" height="25.706" style="stroke:#000000;stroke-width:2.0;" width="80" x="635" y="140.2038"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="641" y="158.1008">Discovery</text><polygon fill="#181818" points="256.5,213.3218,266.5,217.3218,256.5,221.3218,260.5,217.3218" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="91" x2="262.5" y1="217.3218" y2="217.3218"/><polygon fill="#181818" points="481.5,213.3218,491.5,217.3218,481.5,221.3218,485.5,217.3218" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="268.5" x2="487.5" y1="217.3218" y2="217.3218"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="275.5" y="193.8068">Try to login using</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="275.5" y="211.5128">account "janedoe@example.com"</text><path d="M498.5,180.9098 L498.5,207.9098 L751.5,207.9098 L751.5,190.9098 L741.5,180.9098 L498.5,180.9098 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M741.5,180.9098 L741.5,190.9098 L751.5,190.9098 L741.5,180.9098 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="232" x="504.5" y="199.8068">Which OP should be used for this user?</text><path d="M1073.25,194.6158 L1073.25,239.6158 L1275.25,239.6158 L1275.25,204.6158 L1265.25,194.6158 L1073.25,194.6158 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1265.25,194.6158 L1265.25,204.6158 L1275.25,204.6158 L1265.25,194.6158 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="1079.25" y="213.5128">https://example.com uses</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="1079.25" y="231.2188">https://as for OpenID provider</text><polygon fill="#181818" points="1257,335.5579,1267,339.5579,1257,343.5579,1261,339.5579" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="493.5" x2="1263" y1="339.5579" y2="339.5579"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="274" x="500.5" y="262.9248">OpenID Provider Issuer Discovery Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="777.5" y="262.9248">(WebFinger Query)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="276" x="500.5" y="280.6308">HTTPS GET https://op/.well-known/webfinger?</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239" x="506.5" y="298.3369">resource=acct:janedoe%40example.com</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="506.5" y="316.0429">&amp;host=example.com</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="432" x="506.5" y="333.7489">&amp;rel=http%3A%2F%2Fopenid.net%2Fspecs%2Fconnect%2F1.0%2Fissuer</text><polygon fill="#181818" points="504.5,438.088,494.5,442.088,504.5,446.088,500.5,442.088" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="498.5" x2="1268" y1="442.088" y2="442.088"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="282" x="510.5" y="365.4549">OpenID Provider Issuer Discovery Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="795.5" y="365.4549">(WebFinger Response)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="241" x="510.5" y="383.1609">HTTPS 200 OK, JRD (application/jrd+json)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="244" x="510.5" y="400.8669">{"subject": "acct:janedoe@example.com",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="347" x="513.5" y="418.573">"links":[{"rel":"http://openid.net/specs/connect/1.0/issuer",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="543.5" y="436.279">"href="https://op"}]}</text><rect fill="none" height="44.0501" style="stroke:#000000;stroke-width:1.5;" width="739.5" x="441.5" y="450.088"/><path d="M441.5,450.088 L505.5,450.088 L505.5,459.088 L495.5,469.088 L441.5,469.088 L441.5,450.088 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="454.5" y="465.985">ref</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="447" x="587.75" y="485.9161">OpenID Connect, Metadata Request, Dynamic Client Registration, Authentication</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1340" x="5" y="520.9911"/><line style="stroke:#000000;stroke-width:1.0;" x1="5" x2="1345" y1="520.9911" y2="520.9911"/><line style="stroke:#000000;stroke-width:1.0;" x1="5" x2="1345" y1="523.9911" y2="523.9911"/><rect fill="#EEEEEE" height="25.706" style="stroke:#000000;stroke-width:2.0;" width="138" x="606" y="509.1381"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="121" x="612" y="527.0351">Metadata Request</text><polygon fill="#FEFFDD" points="381,549.8441,606,549.8441,616,561.8441,606,574.8441,381,574.8441,371,561.8441,381,549.8441" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221" x="383" y="567.7411">Start discovery for issuer "https://op"</text><polygon fill="#181818" points="1067.5,635.6682,1077.5,639.6682,1067.5,643.6682,1071.5,639.6682" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="493.5" x2="1073.5" y1="639.6682" y2="639.6682"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="261" x="500.5" y="598.4472">Authorization Server Metadata Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="372" x="500.5" y="616.1532">HTTPS GET https://op/.well-known/oauth-authorization-server</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="374" x="506.5" y="633.8592">or https://op/.well-known/openid-configuration (compatibility)</text><polygon fill="#181818" points="504.5,897.5524,494.5,901.5524,504.5,905.5524,500.5,901.5524" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="498.5" x2="1078.5" y1="901.5524" y2="901.5524"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="269" x="510.5" y="665.5652">Authorization Server Metadata Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="510.5" y="683.2712">HTTPS 200 OK, JSON</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10" x="510.5" y="700.9772">…</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="506" x="510.5" y="718.6833">"scopes_supported": ["openid", "profile", "email", "address", "phone", "offline_access"],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="254" x="510.5" y="736.3893">"userinfo_endpoint": "https://op/userinfo",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="503" x="510.5" y="754.0953">"response_types_supported": ["code", "code id_token", "id_token", "token id_token"],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="510.5" y="771.8013">"acr_values_supported": […]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="289" x="510.5" y="789.5073">"subject_types_supported": ["public", "pairwise"],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="278" x="510.5" y="807.2133">"display_values_supported": ["page", "popup"],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="301" x="510.5" y="824.9194">"claim_types_supported": ["normal", "distributed"],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="551" x="510.5" y="842.6254">"claims_supported": ["sub", "iss", "auth_time", "acr", "name", "given_name", "family_name", …]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="219" x="510.5" y="860.3314">"claims_parameter_supported": true,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="312" x="510.5" y="878.0374">"response_modes_supported": ["query", "fragment"]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10" x="510.5" y="895.7434">…</text><polygon fill="#FEFFDD" points="377.5,914.5524,609.5,914.5524,619.5,926.5524,609.5,939.5524,377.5,939.5524,367.5,926.5524,377.5,914.5524" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="228" x="379.5" y="932.4494">Check issuer match with expected one</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1340" x="5" y="967.1115"/><line style="stroke:#000000;stroke-width:1.0;" x1="5" x2="1345" y1="967.1115" y2="967.1115"/><line style="stroke:#000000;stroke-width:1.0;" x1="5" x2="1345" y1="970.1115" y2="970.1115"/><rect fill="#EEEEEE" height="25.706" style="stroke:#000000;stroke-width:2.0;" width="199" x="575.5" y="955.2584"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="182" x="581.5" y="973.1555">Dynamic Client registration</text><polygon fill="#181818" points="1067.5,1205.4367,1077.5,1209.4367,1067.5,1213.4367,1071.5,1209.4367" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="493.5" x2="1073.5" y1="1209.4367" y2="1209.4367"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="181" x="500.5" y="1008.8615">Client Registration Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="365" x="500.5" y="1026.5675">HTTPS POST https://as/register (registration_endpoint), JSON</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="348" x="500.5" y="1044.2735">(optionally, authentication using some initial access token)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="240" x="500.5" y="1061.9795">"redirect_uris": ["https://client/callback"],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="500.5" y="1079.6855">"response_types": ["code"]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227" x="500.5" y="1097.3916">"application_type": "web" (or "native"),</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="500.5" y="1115.0976">"client_name": "Foo",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="500.5" y="1132.8036">"client_uri": "https://client",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="500.5" y="1150.5096">"logo_uri": "https://client/logo.png"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221" x="500.5" y="1168.2156">"subject_type":"pairwise" (or "public")</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="237" x="500.5" y="1185.9216">"initiate_login_uri": "https://client/login"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10" x="500.5" y="1203.6277">…</text><polygon fill="#181818" points="504.5,1361.0848,494.5,1365.0848,504.5,1369.0848,500.5,1365.0848" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="498.5" x2="1078.5" y1="1365.0848" y2="1365.0848"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="189" x="510.5" y="1235.3337">Client Registration Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="510.5" y="1253.0397">HTTPS 200, JSON</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="510.5" y="1270.7457">"client_id": "CID-XXXX",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="447" x="510.5" y="1288.4517">"client_secret": "SECRET-XXXX" (opaque, depending on client auth. method)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="510.5" y="1306.1577">"client_secret_expires_at": 0,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="562" x="510.5" y="1323.8638">"registration_client_uri": "htpps://as/registration/RRRRR" (if dynamic management supported),</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="514" x="510.5" y="1341.5698">"registration_access_token", "RAT-XXXX" (opaque, if dynamic management supported)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10" x="510.5" y="1359.2758">…</text><!--MD5=[f3a105110cb3b53603af72055c1edd03]
@startuml

!pragma teoz true

actor "User\n(OAuth Resource Owner)\njanedoe@example.com" as user
participant "User Agent / Frontend\nfor Relying Party" as ua
participant "Relying Party\n(OAuth Client)\nhttps://rp" as client
participant "OpenID Provider\n(OAuth Authorization Server)\nhttps://op" as as
participant "User domain\nhttps://example.com" as domain

== Discovery ==

user -> ua
& ua -> client: Try to login using\naccount "janedoe@example.com"
note right: Which OP should be used for this user?
& note over domain, as: https://example.com uses\nhttps://as for OpenID provider
client -> domain: **OpenID Provider Issuer Discovery Request** (WebFinger Query) \nHTTPS GET https://op/.well-known/webfinger?\n  resource=acct:janedoe%40example.com\n  &host=example.com\n  &rel=http%3A%2F%2Fopenid.net%2Fspecs%2Fconnect%2F1.0%2Fissuer
domain - -> client: **OpenID Provider Issuer Discovery Response** (WebFinger Response)\nHTTPS 200 OK, JRD (application/jrd+json)\n{"subject": "acct:janedoe@example.com",\n "links":[{"rel":"http://openid.net/specs/connect/1.0/issuer",\n           "href="https://op"}]}

ref over client, as: OpenID Connect, Metadata Request, Dynamic Client Registration, Authentication

== Metadata Request ==

hnote over client: Start discovery for issuer "https://op"

client -> as: **Authorization Server Metadata Request**\nHTTPS GET https://op/.well-known/oauth-authorization-server\n  or https://op/.well-known/openid-configuration (compatibility)

as - -> client: **Authorization Server Metadata Response**\nHTTPS 200 OK, JSON\n…\n"scopes_supported": ["openid", "profile", "email", "address", "phone", "offline_access"],\n"userinfo_endpoint": "https://op/userinfo",\n"response_types_supported": ["code", "code id_token", "id_token", "token id_token"],\n"acr_values_supported": […]\n"subject_types_supported": ["public", "pairwise"],\n"display_values_supported": ["page", "popup"],\n"claim_types_supported": ["normal", "distributed"],\n"claims_supported": ["sub", "iss", "auth_time", "acr", "name", "given_name", "family_name", …]\n"claims_parameter_supported": true,\n"response_modes_supported": ["query", "fragment"]\n…

hnote over client: Check issuer match with expected one

== Dynamic Client registration ==

client -> as: **Client Registration Request**\nHTTPS POST https://as/register (registration_endpoint), JSON\n(optionally, authentication using some initial access token)\n"redirect_uris": ["https://client/callback"],\n"response_types": ["code"]\n"application_type": "web" (or "native"),\n"client_name": "Foo",\n"client_uri": "https://client",\n"logo_uri": "https://client/logo.png"\n"subject_type":"pairwise" (or "public")\n"initiate_login_uri": "https://client/login"\n…

as - -> client: **Client Registration Response**\nHTTPS 200, JSON\n"client_id": "CID-XXXX",\n"client_secret": "SECRET-XXXX" (opaque, depending on client auth. method)\n"client_secret_expires_at": 0,\n"registration_client_uri": "htpps://as/registration/RRRRR" (if dynamic management supported),\n"registration_access_token", "RAT-XXXX" (opaque, if dynamic management supported)\n…

@enduml

PlantUML version 1.2022.13(Sat Nov 19 14:22:17 CET 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: fr
Country: FR
--></g></svg>