<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="884px" preserveAspectRatio="none" style="width:884px;height:884px;background:#FFFFFF;" version="1.1" viewBox="0 0 884 884" width="884px" zoomAndPan="magnify"><defs/><g><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="121" x2="121" y1="58.1358" y2="494.4321"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="121" x2="121" y1="494.4321" y2="537.414"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="121" x2="121" y1="537.414" y2="826.1802"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="669" x2="669" y1="58.1358" y2="494.4321"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="669" x2="669" y1="494.4321" y2="537.414"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="669" x2="669" y1="537.414" y2="826.1802"/><rect fill="#FFFFFF" height="102.8241" style="stroke:#181818;stroke-width:1.0;" width="10" x="664" y="160.9599"/><rect fill="#FFFFFF" height="67.118" style="stroke:#181818;stroke-width:1.0;" width="10" x="664" y="330.902"/><rect fill="#FFFFFF" height="67.118" style="stroke:#181818;stroke-width:1.0;" width="10" x="664" y="677.6501"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="816.5" x2="816.5" y1="58.1358" y2="494.4321"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="816.5" x2="816.5" y1="494.4321" y2="537.414"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="816.5" x2="816.5" y1="537.414" y2="826.1802"/><rect fill="#FFFFFF" height="14" style="stroke:#181818;stroke-width:1.0;" width="10" x="811.5" y="472.4321"/><rect fill="#FFFFFF" height="31.706" style="stroke:#181818;stroke-width:1.0;" width="10" x="811.5" y="578.826"/><rect fill="#FFFFFF" height="14" style="stroke:#181818;stroke-width:1.0;" width="10" x="811.5" y="794.1802"/><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="100" x="71" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="101.5" y="26.9659">Client</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="78" y="46.0339">https://client</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="152" x="593" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="600" y="26.9659">Authorization Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="637" y="46.0339">https://as</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="123" x="755" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109" x="762" y="26.9659">Resource Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="785.5" y="46.0339">https://rs</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="100" x="71" y="826.1802"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="101.5" y="848.1461">Client</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="78" y="867.214">https://client</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="152" x="593" y="826.1802"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="600" y="848.1461">Authorization Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="637" y="867.214">https://as</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="123" x="755" y="826.1802"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109" x="762" y="848.1461">Resource Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="785.5" y="867.214">https://rs</text><polygon fill="#FEFFDD" points="20,71.1358,222,71.1358,232,83.1358,222,96.1358,20,96.1358,10,83.1358,20,71.1358" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198" x="22" y="89.0328">User starts authorization process</text><polygon fill="#181818" points="652,156.9599,662,160.9599,652,164.9599,656,160.9599" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="121" x2="658" y1="160.9599" y2="160.9599"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="149" x="128" y="119.7389">Authorization Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="356" x="128" y="137.4449">Front channel GET https://as/auth (authorization_endpoint)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="262" x="128" y="155.1509">client_id, redirect_uri=https://client/callback,</text><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="30" x="393" y="155.1509">state</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="3" x="423" y="155.1509">,</text><text fill="#008000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="429" y="155.1509">code_challenge</text><polygon fill="#FEFFDD" points="569,173.9599,769,173.9599,779,185.9599,769,198.9599,569,198.9599,559,185.9599,569,173.9599" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196" x="571" y="191.8569">User authentication and consent</text><polygon fill="#181818" points="132,259.784,122,263.784,132,267.784,128,263.784" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="126" x2="663" y1="263.784" y2="263.784"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="157" x="138" y="222.5629">Authorization Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="320" x="138" y="240.2689">Front channel GET https://client/callback (redirect_uri)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="138" y="257.975">code</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="3" x="167" y="257.975">,</text><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="30" x="173" y="257.975">state</text><polygon fill="#181818" points="652,326.902,662,330.902,652,334.902,656,330.902" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="121" x2="658" y1="330.902" y2="330.902"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="144" x="128" y="289.681">Access Token Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="519" x="128" y="307.387">HTTPS POST https://as/token (token_endpoint), urlencoded (with client authentication)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="128" y="325.093">code</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="408" x="157" y="325.093">, grant_type=authorization_code, redirect_uri=https://client/callback,</text><text fill="#008000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="568" y="325.093">code_verifier</text><polygon fill="#181818" points="132,394.0201,122,398.0201,132,402.0201,128,398.0201" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="126" x2="663" y1="398.0201" y2="398.0201"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="152" x="138" y="356.799">Access Token Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="138" y="374.505">HTTPS 200, JSON</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="138" y="392.2111">access_token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="3" x="217" y="392.2111">,</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="223" y="392.2111">refresh_token</text><polygon fill="#181818" points="799.5,468.4321,809.5,472.4321,799.5,476.4321,803.5,472.4321" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="121" x2="805.5" y1="472.4321" y2="472.4321"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="154" x="128" y="448.9171">Authenticated Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="350" x="128" y="466.6231">HTTPS GET/POST/… https://rs/api/protected_resource with</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="481" y="466.6231">access_token</text><polygon fill="#181818" points="132,482.4321,122,486.4321,132,490.4321,128,486.4321" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="126" x2="810.5" y1="486.4321" y2="486.4321"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="157" x="390.25" y="520.191">later (access_token expiration)</text><polygon fill="#181818" points="799.5,574.826,809.5,578.826,799.5,582.826,803.5,578.826" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="121" x2="805.5" y1="578.826" y2="578.826"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="154" x="128" y="555.311">Authenticated Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="350" x="128" y="573.017">HTTPS GET/POST/… https://rs/api/protected_resource with</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="481" y="573.017">access_token</text><polygon fill="#181818" points="132,606.532,122,610.532,132,614.532,128,610.532" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="126" x2="810.5" y1="610.532" y2="610.532"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="238" x="138" y="604.723">HTTPS 403, Bearer error="invalid_token"</text><polygon fill="#181818" points="652,673.6501,662,677.6501,652,681.6501,656,677.6501" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="121" x2="658" y1="677.6501" y2="677.6501"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="152" x="128" y="636.429">Refresh Token Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="519" x="128" y="654.1351">HTTPS POST https://as/token (token_endpoint), urlencoded (with client authentication)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="128" y="671.8411">refresh_token</text><polygon fill="#181818" points="132,740.7681,122,744.7681,132,748.7681,128,744.7681" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="126" x2="663" y1="744.7681" y2="744.7681"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="160" x="138" y="703.5471">Refresh Token Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="138" y="721.2531">HTTPS 200, JSON</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="138" y="738.9591">access_token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="3" x="217" y="738.9591">,</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="223" y="738.9591">refresh_token</text><polygon fill="#181818" points="799.5,790.1802,809.5,794.1802,799.5,798.1802,803.5,794.1802" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="121" x2="805.5" y1="794.1802" y2="794.1802"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="154" x="128" y="770.6651">Authenticated Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="350" x="128" y="788.3712">HTTPS GET/POST/… https://rs/api/protected_resource with</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="481" y="788.3712">access_token</text><polygon fill="#181818" points="132,804.1802,122,808.1802,132,812.1802,128,808.1802" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="126" x2="810.5" y1="808.1802" y2="808.1802"/><!--MD5=[09fd6b2749d4d1a7a7a115c28e5d7df9]
@startuml

!pragma teoz true

participant "Client\nhttps://client" as client
participant "Authorization Server\nhttps://as" as as
participant "Resource Server\nhttps://rs" as rs

hnote over client: User starts authorization process

client -> as ++: **Authorization Request**\nFront channel GET https://as/auth (authorization_endpoint)\nclient_id, redirect_uri=https://client/callback, <color:blue>state</color>, <color:green>code_challenge</color>

hnote over as: User authentication and consent

as - -> client - -: **Authorization Response**\nFront channel GET https://client/callback (redirect_uri)\n<color:red>code</color>, <color:blue>state</color>

client -> as ++ : **Access Token Request**\nHTTPS POST https://as/token (token_endpoint), urlencoded (with client authentication)\n<color:red>code</color>, grant_type=authorization_code, redirect_uri=https://client/callback, <color:green>code_verifier</color>

as - -> client - -: **Access Token Response**\nHTTPS 200, JSON\n<color:red>access_token</color>, <color:red>refresh_token</color>

|||

client -> rs ++ : **Authenticated Request**\nHTTPS GET/POST/… https://rs/api/protected_resource with <color:red>access_token</color>
rs - -> client - -

... later (access_token expiration) ...

client -> rs ++ : **Authenticated Request**\nHTTPS GET/POST/… https://rs/api/protected_resource with <color:red>access_token</color>
rs - -> client - -: HTTPS 403, Bearer error="invalid_token"

client -> as ++ : **Refresh Token Request**\nHTTPS POST https://as/token (token_endpoint), urlencoded (with client authentication)\n<color:red>refresh_token</color>

as - -> client - -: **Refresh Token Response**\nHTTPS 200, JSON\n<color:red>access_token</color>, <color:red>refresh_token</color>

client -> rs ++ : **Authenticated Request**\nHTTPS GET/POST/… https://rs/api/protected_resource with <color:red>access_token</color>
rs - -> client - -

@enduml

PlantUML version 1.2022.13(Sat Nov 19 14:22:17 CET 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: fr
Country: FR
--></g></svg>