<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1304px" preserveAspectRatio="none" style="width:840px;height:1304px;background:#FFFFFF;" version="1.1" viewBox="0 0 840 1304" width="840px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="279.3179" style="stroke:#000000;stroke-width:1.5;" width="540" x="77" y="70.1358"/><rect fill="none" height="65.412" style="stroke:#000000;stroke-width:1.5;" width="373" x="414.5" y="367.4538"/><rect fill="none" height="78.7561" style="stroke:#000000;stroke-width:1.5;" width="517.5" x="161" y="450.8658"/><rect fill="none" height="638.9622" style="stroke:#000000;stroke-width:1.5;" width="609" x="8" y="583.328"/><rect fill="none" height="78.7561" style="stroke:#000000;stroke-width:1.5;" width="318" x="27" y="862.578"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="93" x2="93" y1="58.1358" y2="1246.2901"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="253" x2="253" y1="58.1358" y2="1246.2901"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="601" x2="601" y1="58.1358" y2="1246.2901"/><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="100" x="43" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="73.5" y="26.9659">Client</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="50" y="46.0339">https://client</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="152" x="177" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="184" y="26.9659">Authorization Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="221" y="46.0339">https://as</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="123" x="539.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109" x="546.5" y="26.9659">Resource Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="570" y="46.0339">https://rs</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="100" x="43" y="1246.2901"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="73.5" y="1268.2561">Client</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="50" y="1287.324">https://client</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="152" x="177" y="1246.2901"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="184" y="1268.2561">Authorization Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="221" y="1287.324">https://as</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="123" x="539.5" y="1246.2901"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109" x="546.5" y="1268.2561">Resource Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="570" y="1287.324">https://rs</text><path d="M77,70.1358 L140,70.1358 L140,79.8419 L130,89.8419 L77,89.8419 L77,70.1358 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="279.3179" style="stroke:#000000;stroke-width:1.5;" width="540" x="77" y="70.1358"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="92" y="85.0328">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="237" x="155" y="83.8947">[using Authorization Request Header Field]</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="77" x2="617" y1="177.9599" y2="177.9599"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="214" x="82" y="191.7188">[using Form-Encoded Body Parameter]</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="77" x2="617" y1="278.0598" y2="278.0598"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="160" x="82" y="291.8187">[using URI Query Parameter]</text><polygon fill="#181818" points="589,154.9599,599,158.9599,589,162.9599,593,158.9599" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="93" x2="595" y1="158.9599" y2="158.9599"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="154" x="100" y="117.7389">Authenticated Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="321" x="100" y="135.4449">HTTPS GET/POST/… https://rs/api/protected_resource</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="100" y="153.1509">Authorization: Bearer AT-XXXX</text><polygon fill="#181818" points="589,255.0598,599,259.0598,589,263.0598,593,259.0598" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="93" x2="595" y1="259.0598" y2="259.0598"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="154" x="100" y="217.8388">Authenticated Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="352" x="100" y="235.5448">HTTPS POST https://rs/api/protected_resource, urlencoded</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="100" y="253.2508">access_token=AT-XXXX&amp;…</text><polygon fill="#181818" points="589,337.4538,599,341.4538,589,345.4538,593,341.4538" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="93" x2="595" y1="341.4538" y2="341.4538"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="154" x="100" y="317.9387">Authenticated Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="484" x="100" y="335.6448">HTTPS GET/POST/… https://rs/api/protected_resource?access_token=AT-XXXX&amp;…</text><path d="M414.5,367.4538 L481.5,367.4538 L481.5,377.1598 L471.5,387.1598 L414.5,387.1598 L414.5,367.4538 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="65.412" style="stroke:#000000;stroke-width:1.5;" width="373" x="414.5" y="367.4538"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="22" x="429.5" y="382.3508">opt</text><polygon fill="#FEFFDD" points="445.5,402.1598,756.5,402.1598,766.5,414.1598,756.5,427.1598,445.5,427.1598,435.5,414.1598,445.5,402.1598" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="307" x="447.5" y="420.0568">Offline validation of access token (eg. if this is a JWT)</text><path d="M161,450.8658 L228,450.8658 L228,460.5718 L218,470.5718 L161,470.5718 L161,450.8658 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="78.7561" style="stroke:#000000;stroke-width:1.5;" width="517.5" x="161" y="450.8658"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="22" x="176" y="465.7628">opt</text><rect fill="none" height="44.0501" style="stroke:#000000;stroke-width:1.5;" width="481.5" x="179" y="480.5718"/><path d="M179,480.5718 L243,480.5718 L243,489.5718 L233,499.5718 L179,499.5718 L179,480.5718 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="192" y="496.4688">ref</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="357" x="241.25" y="516.3999">Online validation of access token (eg. using Token Introspection)</text><polygon fill="#FEFFDD" points="389,548.6219,813,548.6219,823,560.6219,813,573.6219,389,573.6219,379,560.6219,389,548.6219" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="420" x="391" y="566.519">Authorization verifications (scope, resource, authorization_details, etc.)</text><path d="M8,583.328 L71,583.328 L71,593.034 L61,603.034 L8,603.034 L8,583.328 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="638.9622" style="stroke:#000000;stroke-width:1.5;" width="609" x="8" y="583.328"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="23" y="598.225">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="96" x="86" y="597.0869">[token accepted]</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="8" x2="617" y1="655.74" y2="655.74"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="147" x="13" y="669.4989">[Token must be refreshed]</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="8" x2="617" y1="787.184" y2="787.184"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="170" x="13" y="800.943">[Insufficient scope for request]</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="8" x2="617" y1="966.3341" y2="966.3341"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="378" x="13" y="980.093">[Step-up Authentication (draft-ietf-oauth-step-up-authn-challenge)]</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="8" x2="617" y1="1150.8962" y2="1150.8962"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="91" x="13" y="1164.6551">[Invalid request]</text><polygon fill="#181818" points="104,632.74,94,636.74,104,640.74,100,636.74" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="98" x2="600" y1="636.74" y2="636.74"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="110" y="630.931">HTTPS 2xx, etc.</text><polygon fill="#181818" points="104,715.1339,94,719.1339,104,723.1339,100,719.1339" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="98" x2="600" y1="719.1339" y2="719.1339"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="110" y="695.6189">HTTPS 401 Unauthorized</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="428" x="110" y="713.3249">WWW-Authenticate: Bearer error="invalid_token", error_description="…"</text><rect fill="none" height="44.0501" style="stroke:#000000;stroke-width:1.5;" width="282" x="45" y="727.1339"/><path d="M45,727.1339 L109,727.1339 L109,736.1339 L99,746.1339 L45,746.1339 L45,727.1339 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="58" y="743.0309">ref</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="98" x="137" y="762.962">Refresh the token</text><polygon fill="#181818" points="104,846.578,94,850.578,104,854.578,100,850.578" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="98" x2="600" y1="850.578" y2="850.578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="110" y="827.0629">HTTPS 403 Forbidden</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="418" x="110" y="844.769">WWW-Authenticate: Bearer error="insufficient_scope", scope="scope4"</text><path d="M27,862.578 L94,862.578 L94,872.284 L84,882.284 L27,882.284 L27,862.578 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="78.7561" style="stroke:#000000;stroke-width:1.5;" width="318" x="27" y="862.578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="22" x="42" y="877.475">opt</text><rect fill="none" height="44.0501" style="stroke:#000000;stroke-width:1.5;" width="282" x="45" y="892.284"/><path d="M45,892.284 L109,892.284 L109,901.284 L99,911.284 L45,911.284 L45,892.284 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="58" y="908.181">ref</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="274" x="49" y="928.1121">(New) Authorization request (with scope=scope4)</text><polygon fill="#181818" points="104,1078.8461,94,1082.8461,104,1086.8461,100,1082.8461" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="98" x2="600" y1="1082.8461" y2="1082.8461"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="110" y="1006.213">HTTPS 401 Unauthorized</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="406" x="110" y="1023.919">WWW-Authenticate: Bearer error="insufficient_user_authentication",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="122" y="1041.625">error_description="…",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="241" x="122" y="1059.3311">acr_values="…", (if a new ACR is required)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="301" x="122" y="1077.0371">max_age="5" (if a fresher authorization is required)</text><rect fill="none" height="44.0501" style="stroke:#000000;stroke-width:1.5;" width="282" x="45" y="1090.8461"/><path d="M45,1090.8461 L109,1090.8461 L109,1099.8461 L99,1109.8461 L45,1109.8461 L45,1090.8461 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="58" y="1106.7431">ref</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="157" x="107.5" y="1126.6742">(New) Authorization request</text><polygon fill="#181818" points="104,1210.2901,94,1214.2901,104,1218.2901,100,1214.2901" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="98" x2="600" y1="1214.2901" y2="1214.2901"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141" x="110" y="1190.7751">HTTPS 400 Bad Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="303" x="110" y="1208.4811">WWW-Authenticate: Bearer error="invalid_request"</text><!--MD5=[e0ce9d373781782a7b234ed15b7c0afd]
@startuml

!pragma teoz true

participant "Client\nhttps://client" as client
participant "Authorization Server\nhttps://as" as as
participant "Resource Server\nhttps://rs" as rs

alt using Authorization Request Header Field
    client -> rs: **Authenticated Request**\nHTTPS GET/POST/… https://rs/api/protected_resource\nAuthorization: Bearer AT-XXXX
else using Form-Encoded Body Parameter
    client -> rs: **Authenticated Request**\nHTTPS POST https://rs/api/protected_resource, urlencoded\naccess_token=AT-XXXX&…
else using URI Query Parameter
    client -> rs: **Authenticated Request**\nHTTPS GET/POST/… https://rs/api/protected_resource?access_token=AT-XXXX&…
end

opt
    hnote over rs: Offline validation of access token (eg. if this is a JWT)
end
opt
    ref over as, rs: Online validation of access token (eg. using Token Introspection)
end

hnote over rs: Authorization verifications (scope, resource, authorization_details, etc.)

alt token accepted

rs - -> client: HTTPS 2xx, etc.

else Token must be refreshed

rs - -> client: HTTPS 401 Unauthorized\nWWW-Authenticate: Bearer error="invalid_token", error_description="…"
ref over client, as: Refresh the token

else Insufficient scope for request

rs - -> client: HTTPS 403 Forbidden\nWWW-Authenticate: Bearer error="insufficient_scope", scope="scope4"
opt
    ref over client, as: (New) Authorization request (with scope=scope4)
end

else Step-up Authentication (draft-ietf-oauth-step-up-authn-challenge)

rs - -> client: HTTPS 401 Unauthorized\nWWW-Authenticate: Bearer error="insufficient_user_authentication",\n    error_description="…",\n    acr_values="…", (if a new ACR is required)\n    max_age="5" (if a fresher authorization is required)
ref over client, as: (New) Authorization request

else Invalid request

rs - -> client: HTTPS 400 Bad Request\nWWW-Authenticate: Bearer error="invalid_request"

end

@enduml

PlantUML version 1.2022.13(Sat Nov 19 14:22:17 CET 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: fr
Country: FR
--></g></svg>