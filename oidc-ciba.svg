<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="2734px" preserveAspectRatio="none" style="width:1418px;height:2734px;background:#FFFFFF;" version="1.1" viewBox="0 0 1418 2734" width="1418px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="61.412" style="stroke:#000000;stroke-width:1.5;" width="375" x="197.5" y="241.3719"/><rect fill="none" height="61.412" style="stroke:#000000;stroke-width:1.5;" width="375" x="197.5" y="320.784"/><rect fill="none" height="338.5721" style="stroke:#000000;stroke-width:1.5;" width="1000" x="197.5" y="400.196"/><rect fill="none" height="865.8684" style="stroke:#000000;stroke-width:1.5;" width="1270.5" x="140.5" y="792.4742"/><rect fill="none" height="521.1022" style="stroke:#000000;stroke-width:1.5;" width="1226.5" x="159.5" y="1123.2403"/><rect fill="none" height="473.3962" style="stroke:#000000;stroke-width:1.5;" width="1182.5" x="178.5" y="1156.9464"/><rect fill="none" height="267.7481" style="stroke:#000000;stroke-width:1.5;" width="1000" x="197.5" y="1348.5945"/><rect fill="none" height="746.2623" style="stroke:#000000;stroke-width:1.5;" width="1000" x="197.5" y="1676.3426"/><rect fill="none" height="118.5301" style="stroke:#000000;stroke-width:1.5;" width="345" x="41" y="2489.655"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="213.5" x2="213.5" y1="103.1358" y2="2632.1851"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="353.5" x2="353.5" y1="103.1358" y2="2632.1851"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="556.5" x2="556.5" y1="103.1358" y2="2632.1851"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="986.5" x2="986.5" y1="103.1358" y2="2632.1851"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1181.5" x2="1181.5" y1="103.1358" y2="2632.1851"/><rect fill="#E2E2F0" height="71.2038" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108" x="159.5" y="30.9321"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="169.5" y="52.898">Relying Party</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="166.5" y="71.9659">(OAuth Client)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="181.5" y="91.0339">https://rp</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="152" x="277.5" y="69.0679"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="284.5" y="91.0339">Consumption Device</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="538" y="79.9659">User</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="166" x="470.5" y="99.0339">(OAuth Resource Owner)</text><ellipse cx="556.5" cy="13.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M556.5,21.5 L556.5,48.5 M543.5,29.5 L569.5,29.5 M556.5,48.5 L543.5,63.5 M556.5,48.5 L569.5,63.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="163" x="905" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="147" x="913" y="71.9659">Authentication Device</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="149" x="912" y="91.0339">(eg. user smartphone)</text><rect fill="#E2E2F0" height="71.2038" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="207" x="1078" y="30.9321"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="1125.5" y="52.898">OpenID Provider</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="193" x="1085" y="71.9659">(OAuth Authorization Server)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="1148.5" y="91.0339">https://op</text><rect fill="#E2E2F0" height="71.2038" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108" x="159.5" y="2632.1851"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="169.5" y="2654.151">Relying Party</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="166.5" y="2673.2189">(OAuth Client)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="181.5" y="2692.2869">https://rp</text><rect fill="#E2E2F0" height="33.0679" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="152" x="277.5" y="2632.1851"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="284.5" y="2654.151">Consumption Device</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="538" y="2707.151">User</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="166" x="470.5" y="2726.2189">(OAuth Resource Owner)</text><ellipse cx="556.5" cy="2640.6851" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M556.5,2648.6851 L556.5,2675.6851 M543.5,2656.6851 L569.5,2656.6851 M556.5,2675.6851 L543.5,2690.6851 M556.5,2675.6851 L569.5,2690.6851 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="163" x="905" y="2632.1851"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="147" x="913" y="2654.151">Authentication Device</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="149" x="912" y="2673.2189">(eg. user smartphone)</text><rect fill="#E2E2F0" height="71.2038" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="207" x="1078" y="2632.1851"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="1125.5" y="2654.151">OpenID Provider</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="193" x="1085" y="2673.2189">(OAuth Authorization Server)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="1148.5" y="2692.2869">https://op</text><path d="M954,124.9888 L954,222.9888 L1409,222.9888 L1409,134.9888 L1399,124.9888 L954,124.9888 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1399,124.9888 L1399,134.9888 L1409,134.9888 L1399,124.9888 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="960" y="143.8859">Relevant OP Metadata</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="433" x="960" y="161.5919">"backchannel_token_delivery_modes_supported": ["poll", "ping", "push"],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="371" x="960" y="179.2979">"backchannel_authentication_endpoint": "https://op/bc-auth",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="434" x="960" y="197.0039">"backchannel_authentication_request_signing_alg_values_supported": …</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="364" x="960" y="214.7099">"backchannel_user_code_parameter_supported": true | false,</text><path d="M10,116.1358 L10,232.1358 L417,232.1358 L417,126.1358 L407,116.1358 L10,116.1358 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M407,116.1358 L407,126.1358 L417,126.1358 L407,116.1358 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="16" y="135.0328">Relevant RP Registration</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="282" x="16" y="152.7389">"backchannel_token_delivery_mode": "poll" / …,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="386" x="16" y="170.4449">"backchannel_client_notification_endpoint": "https://rp/bc-notif",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="321" x="16" y="188.1509">"backchannel_authentication_request_signing_alg": …</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="295" x="16" y="205.8569">"backchannel_user_code_parameter": true | false,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="285" x="16" y="223.5629">"token_endpoint_auth_methods_supported": …</text><path d="M197.5,241.3719 L264.5,241.3719 L264.5,251.0779 L254.5,261.0779 L197.5,261.0779 L197.5,241.3719 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="61.412" style="stroke:#000000;stroke-width:1.5;" width="375" x="197.5" y="241.3719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="22" x="212.5" y="256.2689">opt</text><polygon fill="#181818" points="364.5,290.784,354.5,294.784,364.5,298.784,360.5,294.784" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="358.5" x2="555.5" y1="294.784" y2="294.784"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="370.5" y="288.975">Login hint (login_hint)</text><polygon fill="#181818" points="224.5,290.784,214.5,294.784,224.5,298.784,220.5,294.784" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="218.5" x2="352.5" y1="294.784" y2="294.784"/><path d="M197.5,320.784 L264.5,320.784 L264.5,330.49 L254.5,340.49 L197.5,340.49 L197.5,320.784 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="61.412" style="stroke:#000000;stroke-width:1.5;" width="375" x="197.5" y="320.784"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="22" x="212.5" y="335.681">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="236" x="279.5" y="334.5429">[backchannel_user_code_parameter=true]</text><polygon fill="#181818" points="364.5,370.196,354.5,374.196,364.5,378.196,360.5,374.196" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="358.5" x2="555.5" y1="374.196" y2="374.196"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179" x="370.5" y="368.387">User code (user_code) "WXYZ"</text><polygon fill="#181818" points="224.5,370.196,214.5,374.196,224.5,378.196,220.5,374.196" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="218.5" x2="352.5" y1="374.196" y2="374.196"/><path d="M197.5,400.196 L260.5,400.196 L260.5,409.902 L250.5,419.902 L197.5,419.902 L197.5,400.196 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="338.5721" style="stroke:#000000;stroke-width:1.5;" width="1000" x="197.5" y="400.196"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="212.5" y="415.093">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="191" x="275.5" y="413.9549">[Unsigned authentication request]</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="197.5" x2="1197.5" y1="631.9622" y2="631.9622"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="637" x="202.5" y="645.7211">[Signed authentication request (if backchannel_authentication_request_signing_alg_values_supported non-empty)]</text><polygon fill="#181818" points="1169.5,608.9622,1179.5,612.9622,1169.5,616.9622,1173.5,612.9622" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="213.5" x2="1175.5" y1="612.9622" y2="612.9622"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="88" x="220.5" y="447.799">CIBA Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="501" x="220.5" y="465.505">HTTPS POST https://as/bc-auth (backchannel_authentication_endpoint), urlencoded</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="352" x="220.5" y="483.2111">(client auth. to token_endpoint_auth_methods_supported)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="220.5" y="500.9171">scope=openid …</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="545" x="220.5" y="518.6231">&amp;client_notification_token=CNT-XXXX (if backchannel_token_delivery_mode = ping or push)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164" x="220.5" y="536.3291">&amp;acr_values=… (OPTIONAL)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="391" x="220.5" y="554.0351">&amp;login_hint=… (OPTIONAL) (or id_token_hint or login_hint_token)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="323" x="220.5" y="571.7411">&amp;binding_message=XOXO-123456-ABCDE (OPTIONAL)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="446" x="220.5" y="589.4472">&amp;user_code=WXYZ (OPTIONAL, if backchannel_user_code_parameter=true)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217" x="220.5" y="607.1532">&amp;requested_expiry=120 (OPTIONAL)</text><polygon fill="#181818" points="1169.5,726.7681,1179.5,730.7681,1169.5,734.7681,1173.5,730.7681" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="213.5" x2="1175.5" y1="730.7681" y2="730.7681"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="88" x="220.5" y="671.8411">CIBA Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="501" x="220.5" y="689.5471">HTTPS POST https://as/bc-auth (backchannel_authentication_endpoint), urlencoded</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="414" x="220.5" y="707.2531">(client auth. according to token_endpoint_auth_methods_supported)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="811" x="220.5" y="724.9591">request=eyJ… (JWT authenticated using method in backchannel_authentication_request_signing_alg_values_supported, NOT encrypted)</text><polygon fill="#FEFFDD" points="1131,757.7681,1232,757.7681,1242,769.7681,1232,782.7681,1131,782.7681,1121,769.7681,1131,757.7681" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="1133" y="775.6651">Check user code</text><path d="M140.5,792.4742 L207.5,792.4742 L207.5,802.1802 L197.5,812.1802 L140.5,812.1802 L140.5,792.4742 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="865.8684" style="stroke:#000000;stroke-width:1.5;" width="1270.5" x="140.5" y="792.4742"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="22" x="155.5" y="807.3712">par</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="140.5" x2="1411" y1="1112.2403" y2="1112.2403"/><polygon fill="#181818" points="224.5,912.7103,214.5,916.7103,224.5,920.7103,220.5,916.7103" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="218.5" x2="1180.5" y1="916.7103" y2="916.7103"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="286" x="230.5" y="840.0772">Authentication Request Acknowledgement</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="230.5" y="857.7832">HTTPS 200, JSON</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="230.5" y="875.4892">"auth_req_id": "ARID-XXXX",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="230.5" y="893.1952">"expires_in": 120,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="328" x="230.5" y="910.9012">"interval": 2 (if backchannel_token_delivery_mode=poll)</text><polygon fill="#181818" points="341.5,926.7103,351.5,930.7103,341.5,934.7103,345.5,930.7103" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="213.5" x2="347.5" y1="930.7103" y2="930.7103"/><polygon fill="#181818" points="544.5,926.7103,554.5,930.7103,544.5,934.7103,548.5,930.7103" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="353.5" x2="550.5" y1="930.7103" y2="930.7103"/><polygon fill="#181818" points="997.5,958.4163,987.5,962.4163,997.5,966.4163,993.5,962.4163" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="991.5" x2="1180.5" y1="962.4163" y2="962.4163"/><polygon fill="#181818" points="567.5,958.4163,557.5,962.4163,567.5,966.4163,563.5,962.4163" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="561.5" x2="985.5" y1="962.4163" y2="962.4163"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="316" x="573.5" y="956.6073">"Application XXX has requested to authenticate you."</text><polygon fill="#181818" points="997.5,990.1223,987.5,994.1223,997.5,998.1223,993.5,994.1223" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1169.5,990.1223,1179.5,994.1223,1169.5,998.1223,1173.5,994.1223" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="991.5" x2="1175.5" y1="994.1223" y2="994.1223"/><polygon fill="#181818" points="567.5,990.1223,557.5,994.1223,567.5,998.1223,563.5,994.1223" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="974.5,990.1223,984.5,994.1223,974.5,998.1223,978.5,994.1223" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="561.5" x2="980.5" y1="994.1223" y2="994.1223"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="573.5" y="988.3133">User authentication.</text><polygon fill="#181818" points="997.5,1021.8283,987.5,1025.8283,997.5,1029.8283,993.5,1025.8283" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1169.5,1021.8283,1179.5,1025.8283,1169.5,1029.8283,1173.5,1025.8283" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="991.5" x2="1175.5" y1="1025.8283" y2="1025.8283"/><polygon fill="#181818" points="567.5,1021.8283,557.5,1025.8283,567.5,1029.8283,563.5,1025.8283" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="974.5,1021.8283,984.5,1025.8283,974.5,1029.8283,978.5,1025.8283" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="561.5" x2="980.5" y1="1025.8283" y2="1025.8283"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="406" x="573.5" y="1020.0193">"Do you want to authorize … Verification code XOXO-123456-ABCDE"</text><polygon fill="#FEFFDD" points="473,1038.8283,640,1038.8283,650,1050.8283,640,1063.8283,473,1063.8283,463,1050.8283,473,1038.8283" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="475" y="1056.7253">Compare binding_message</text><polygon fill="#181818" points="974.5,1089.2403,984.5,1093.2403,974.5,1097.2403,978.5,1093.2403" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="556.5" x2="980.5" y1="1093.2403" y2="1093.2403"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="563.5" y="1087.4313">Consent</text><polygon fill="#181818" points="1169.5,1089.2403,1179.5,1093.2403,1169.5,1097.2403,1173.5,1093.2403" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="986.5" x2="1175.5" y1="1093.2403" y2="1093.2403"/><path d="M159.5,1123.2403 L226.5,1123.2403 L226.5,1132.9464 L216.5,1142.9464 L159.5,1142.9464 L159.5,1123.2403 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="521.1022" style="stroke:#000000;stroke-width:1.5;" width="1226.5" x="159.5" y="1123.2403"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="22" x="174.5" y="1138.1373">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="229" x="241.5" y="1136.9992">[backchannel_token_delivery_mode=poll]</text><path d="M178.5,1156.9464 L251.5,1156.9464 L251.5,1166.6524 L241.5,1176.6524 L178.5,1176.6524 L178.5,1156.9464 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="473.3962" style="stroke:#000000;stroke-width:1.5;" width="1182.5" x="178.5" y="1156.9464"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28" x="193.5" y="1171.8434">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="176" x="266.5" y="1170.7053">[Auhthorization not completed]</text><polygon fill="#181818" points="1169.5,1277.1824,1179.5,1281.1824,1169.5,1285.1824,1173.5,1281.1824" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="213.5" x2="1175.5" y1="1281.1824" y2="1281.1824"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="136" x="220.5" y="1204.5494">CIBA Polling Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="346" x="220.5" y="1222.2554">HTTP POST http://op/token (token_endpoint), urlencoded</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="220.5" y="1239.9614">(client authentication)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="373" x="220.5" y="1257.6674">grant_type=urn%3Aopenid%3Aparams%3Agrant-type%3Aciba</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="328" x="220.5" y="1275.3734">&amp;auth_req_id=1c266114-a1be-4252-8ad1-04986c5b9ac1</text><path d="M1023,1294.1824 L1023,1339.1824 L1340,1339.1824 L1340,1304.1824 L1330,1294.1824 L1023,1294.1824 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1330,1294.1824 L1330,1304.1824 L1340,1304.1824 L1330,1294.1824 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="296" x="1029" y="1313.0795">The OpenID Provider may implement long polling</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="1029" y="1330.7855">(up to 30s per request).</text><path d="M197.5,1348.5945 L260.5,1348.5945 L260.5,1358.3005 L250.5,1368.3005 L197.5,1368.3005 L197.5,1348.5945 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="267.7481" style="stroke:#000000;stroke-width:1.5;" width="1000" x="197.5" y="1348.5945"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="212.5" y="1363.4915">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="132" x="275.5" y="1362.3534">[Authorization pending]</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="197.5" x2="1197.5" y1="1456.4185" y2="1456.4185"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="147" x="202.5" y="1470.1775">[Authorization completed]</text><polygon fill="#181818" points="224.5,1433.4185,214.5,1437.4185,224.5,1441.4185,220.5,1437.4185" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="218.5" x2="1180.5" y1="1437.4185" y2="1437.4185"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="144" x="230.5" y="1396.1975">CIBA Polling Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="230.5" y="1413.9035">HTTPS 3xx, JSON</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193" x="230.5" y="1431.6095">"error": "authorization_pending"</text><polygon fill="#181818" points="224.5,1604.3426,214.5,1608.3426,224.5,1612.3426,220.5,1608.3426" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="218.5" x2="1180.5" y1="1608.3426" y2="1608.3426"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="144" x="230.5" y="1496.2974">CIBA Polling Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="230.5" y="1514.0035">HTTPS 200, JSON</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159" x="230.5" y="1531.7095">"access_token": "AT-XXXX",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136" x="230.5" y="1549.4155">"token_type": "Bearer",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="230" x="230.5" y="1567.1215">"refresh_token": "RT-XXX", (OPTIONAL)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="230.5" y="1584.8275">"expires_in": 120,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="230.5" y="1602.5335">"id_token": "eyJ…"</text><path d="M197.5,1676.3426 L260.5,1676.3426 L260.5,1686.0486 L250.5,1696.0486 L197.5,1696.0486 L197.5,1676.3426 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="746.2623" style="stroke:#000000;stroke-width:1.5;" width="1000" x="197.5" y="1676.3426"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="212.5" y="1691.2396">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="229" x="275.5" y="1690.1015">[backchannel_token_delivery_mode=poll]</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="197.5" x2="1197.5" y1="1717.0486" y2="1717.0486"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="233" x="202.5" y="1730.8075">[backchannel_token_delivery_mode=ping]</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="197.5" x2="1197.5" y1="2107.0327" y2="2107.0327"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="235" x="202.5" y="2120.7916">[backchannel_token_delivery_mode=push]</text><polygon fill="#181818" points="224.5,1811.8545,214.5,1815.8545,224.5,1819.8545,220.5,1815.8545" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="218.5" x2="1180.5" y1="1815.8545" y2="1815.8545"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="146" x="230.5" y="1756.9275">CIBA Ping Notification</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="476" x="230.5" y="1774.6335">HTTPS POST http://rp/bc-notif (backchannel_client_notification_endpoint), JSON</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="230.5" y="1792.3395">Authorization: Bearer CNT-XXXX</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="230.5" y="1810.0455">{"auth_req_id": "ARID-XXXX"}</text><polygon fill="#181818" points="1169.5,1843.5605,1179.5,1847.5605,1169.5,1851.5605,1173.5,1847.5605" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="213.5" x2="1175.5" y1="1847.5605" y2="1847.5605"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63" x="220.5" y="1841.7515">HTTPS 204</text><polygon fill="#181818" points="1169.5,1946.0906,1179.5,1950.0906,1169.5,1954.0906,1173.5,1950.0906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="213.5" x2="1175.5" y1="1950.0906" y2="1950.0906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="132" x="220.5" y="1873.4576">CIBA Token Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="346" x="220.5" y="1891.1636">HTTP POST http://op/token (token_endpoint), urlencoded</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="220.5" y="1908.8696">(client authentication)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="373" x="220.5" y="1926.5756">grant_type=urn%3Aopenid%3Aparams%3Agrant-type%3Aciba</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="328" x="220.5" y="1944.2816">&amp;auth_req_id=1c266114-a1be-4252-8ad1-04986c5b9ac1</text><polygon fill="#181818" points="224.5,2084.0327,214.5,2088.0327,224.5,2092.0327,220.5,2088.0327" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="218.5" x2="1180.5" y1="2088.0327" y2="2088.0327"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="140" x="230.5" y="1975.9876">CIBA Token Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="230.5" y="1993.6937">HTTPS 200, JSON</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159" x="230.5" y="2011.3997">"access_token": "AT-XXXX",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136" x="230.5" y="2029.1057">"token_type": "Bearer",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="230" x="230.5" y="2046.8117">"refresh_token": "RT-XXX", (OPTIONAL)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="230.5" y="2064.5177">"expires_in": 120,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="230.5" y="2082.2237">"id_token": "eyJ…"</text><polygon fill="#181818" points="224.5,2378.8989,214.5,2382.8989,224.5,2386.8989,220.5,2382.8989" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="218.5" x2="1180.5" y1="2382.8989" y2="2382.8989"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="149" x="230.5" y="2146.9116">CIBA Push Notification</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="476" x="230.5" y="2164.6177">HTTPS POST http://rp/bc-notif (backchannel_client_notification_endpoint), JSON</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="230.5" y="2182.3237">Authorization: Bearer CNT-XXXX</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170" x="230.5" y="2200.0297">{"auth_req_id": "ARID-XXXX",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159" x="230.5" y="2217.7357">"access_token": "AT-XXXX",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136" x="230.5" y="2235.4417">"token_type": "Bearer",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="230" x="230.5" y="2253.1477">"refresh_token": "RT-XXX", (OPTIONAL)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="230.5" y="2270.8538">"expires_in": 120,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="480" x="230.5" y="2288.5598">"id_token": "eyJ…" including the following claims which are only required on push</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="635" x="239.5" y="2306.2658">"at_hash": … (REQUIRED for backchannel_token_delivery_mode=push, half of the hash of the access_token)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="243" x="239.5" y="2323.9718">"urn:openid:params:jwt:claim:rt_hash": …</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="525" x="248.5" y="2341.6778">(REQUIRED for backchannel_token_delivery_mode=push and if a refresh_token is issued,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="248.5" y="2359.3838">half of the hash of the refresh_token)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="326" x="239.5" y="2377.0899">"urn:openid:params:jwt:claim:auth_req_id": "ARID-XXX"</text><polygon fill="#181818" points="1169.5,2410.6049,1179.5,2414.6049,1169.5,2418.6049,1173.5,2414.6049" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="213.5" x2="1175.5" y1="2414.6049" y2="2414.6049"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="220.5" y="2408.7959">HTTPS 2004</text><rect fill="none" height="44.0501" style="stroke:#000000;stroke-width:1.5;" width="104" x="161.5" y="2436.6049"/><path d="M161.5,2436.6049 L225.5,2436.6049 L225.5,2445.6049 L215.5,2455.6049 L161.5,2455.6049 L161.5,2436.6049 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="174.5" y="2452.5019">ref</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="93" x="167" y="2472.433">Process id_token</text><path d="M41,2489.655 L108,2489.655 L108,2499.361 L98,2509.361 L41,2509.361 L41,2489.655 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="118.5301" style="stroke:#000000;stroke-width:1.5;" width="345" x="41" y="2489.655"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="22" x="56" y="2504.552">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="235" x="123" y="2503.4139">[backchannel_token_delivery_mode=push]</text><polygon fill="#FEFFDD" points="72,2524.361,355,2524.361,365,2563.361,355,2602.361,72,2602.361,62,2563.361,72,2524.361" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="74" y="2542.258">Check token binding,</text><ellipse cx="79.5" cy="2556.2731" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47" x="86" y="2559.9641">at_hash</text><ellipse cx="79.5" cy="2573.9791" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="243" x="86" y="2577.6701">urn:openid:params:jwt:claim:auth_req_id</text><ellipse cx="79.5" cy="2591.6851" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="267" x="86" y="2595.3761">urn:openid:params:jwt:claim:rt_hash (if used)</text><!--MD5=[1392de86cdf68525aec1a699e6dd093f]
@startuml

!pragma teoz true

participant "Relying Party\n(OAuth Client)\nhttps://rp" as rp
participant "Consumption Device" as cd
actor "User\n(OAuth Resource Owner)" as ro
participant "Authentication Device\n(eg. user smartphone)" as ad
participant "OpenID Provider\n(OAuth Authorization Server)\nhttps://op" as op

note over op:Relevant OP Metadata\n"backchannel_token_delivery_modes_supported": ["poll", "ping", "push"],\n"backchannel_authentication_endpoint": "https://op/bc-auth",\n"backchannel_authentication_request_signing_alg_values_supported": …\n"backchannel_user_code_parameter_supported": true | false,

& note over rp: Relevant RP Registration\n"backchannel_token_delivery_mode": "poll" / …,\n"backchannel_client_notification_endpoint": "https://rp/bc-notif",\n"backchannel_authentication_request_signing_alg": …\n"backchannel_user_code_parameter": true | false,\n"token_endpoint_auth_methods_supported": …

opt
    ro -> cd: Login hint (login_hint)
    & cd -> rp
end

opt backchannel_user_code_parameter=true
    ro -> cd: User code (user_code) "WXYZ"
    & cd -> rp
end

alt Unsigned authentication request

rp -> op: **CIBA Request**\nHTTPS POST https://as/bc-auth (backchannel_authentication_endpoint), urlencoded\n(client auth. to token_endpoint_auth_methods_supported)\nscope=openid …\n&client_notification_token=CNT-XXXX (if backchannel_token_delivery_mode = ping or push)\n&acr_values=… (OPTIONAL)\n&login_hint=… (OPTIONAL) (or id_token_hint or login_hint_token)\n&binding_message=XOXO-123456-ABCDE (OPTIONAL)\n&user_code=WXYZ (OPTIONAL, if backchannel_user_code_parameter=true)\n&requested_expiry=120 (OPTIONAL)

else Signed authentication request (if backchannel_authentication_request_signing_alg_values_supported non-empty)

rp -> op: **CIBA Request**\nHTTPS POST https://as/bc-auth (backchannel_authentication_endpoint), urlencoded\n(client auth. according to token_endpoint_auth_methods_supported)\nrequest=eyJ… (JWT authenticated using method in backchannel_authentication_request_signing_alg_values_supported, NOT encrypted)

end

hnote over op: Check user code

par

op - -> rp: **Authentication Request Acknowledgement**\nHTTPS 200, JSON\n"auth_req_id": "ARID-XXXX",\n"expires_in": 120,\n"interval": 2 (if backchannel_token_delivery_mode=poll)

rp -> cd
& cd -> ro: 

op -> ad
& ad -> ro: "Application XXX has requested to authenticate you."

op <-> ad
& ad <-> ro: User authentication.

op <-> ad
& ad <-> ro: "Do you want to authorize … Verification code XOXO-123456-ABCDE"

hnote over ro: Compare binding_message

ro -> ad: Consent
& ad -> op

else

opt backchannel_token_delivery_mode=poll

loop Auhthorization not completed

rp -> op: **CIBA Polling Request**\nHTTP POST http://op/token (token_endpoint), urlencoded\n(client authentication)\ngrant_type=urn%3Aopenid%3Aparams%3Agrant-type%3Aciba\n&auth_req_id=1c266114-a1be-4252-8ad1-04986c5b9ac1

note over op: The OpenID Provider may implement long polling\n(up to 30s per request).

alt Authorization pending

op - -> rp: **CIBA Polling Response**\nHTTPS 3xx, JSON\n"error": "authorization_pending"

else Authorization completed

op - -> rp: **CIBA Polling Response**\nHTTPS 200, JSON\n"access_token": "AT-XXXX",\n"token_type": "Bearer",\n"refresh_token": "RT-XXX", (OPTIONAL)\n"expires_in": 120,\n"id_token": "eyJ…"

end

end

end

end

alt backchannel_token_delivery_mode=poll

else backchannel_token_delivery_mode=ping

op -> rp: **CIBA Ping Notification**\nHTTPS POST http://rp/bc-notif (backchannel_client_notification_endpoint), JSON\nAuthorization: Bearer CNT-XXXX\n{"auth_req_id": "ARID-XXXX"}

rp - -> op: HTTPS 204

rp -> op: **CIBA Token Request**\nHTTP POST http://op/token (token_endpoint), urlencoded\n(client authentication)\ngrant_type=urn%3Aopenid%3Aparams%3Agrant-type%3Aciba\n&auth_req_id=1c266114-a1be-4252-8ad1-04986c5b9ac1

op - -> rp: **CIBA Token Response**\nHTTPS 200, JSON\n"access_token": "AT-XXXX",\n"token_type": "Bearer",\n"refresh_token": "RT-XXX", (OPTIONAL)\n"expires_in": 120,\n"id_token": "eyJ…"

else backchannel_token_delivery_mode=push

op -> rp: **CIBA Push Notification**\nHTTPS POST http://rp/bc-notif (backchannel_client_notification_endpoint), JSON\nAuthorization: Bearer CNT-XXXX\n{"auth_req_id": "ARID-XXXX",\n"access_token": "AT-XXXX",\n"token_type": "Bearer",\n"refresh_token": "RT-XXX", (OPTIONAL)\n"expires_in": 120,\n"id_token": "eyJ…" including the following claims which are only required on push\n   "at_hash": … (REQUIRED for backchannel_token_delivery_mode=push, half of the hash of the access_token)\n   "urn:openid:params:jwt:claim:rt_hash": …\n      (REQUIRED for backchannel_token_delivery_mode=push and if a refresh_token is issued,\n      half of the hash of the refresh_token)\n   "urn:openid:params:jwt:claim:auth_req_id": "ARID-XXX"

rp - -> op: HTTPS 2004

end

ref over rp: Process id_token

opt backchannel_token_delivery_mode=push

hnote over rp: Check token binding,\n* at_hash\n* urn:openid:params:jwt:claim:auth_req_id\n* urn:openid:params:jwt:claim:rt_hash (if used)

end

@enduml

PlantUML version 1.2022.13(Sat Nov 19 14:22:17 CET 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: fr
Country: FR
--></g></svg>