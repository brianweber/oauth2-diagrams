<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="758px" preserveAspectRatio="none" style="width:707px;height:758px;background:#FFFFFF;" version="1.1" viewBox="0 0 707 758" width="707px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="356.5721" style="stroke:#000000;stroke-width:1.5;" width="521" x="52" y="247.4398"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="161" x2="161" y1="77.2038" y2="681.424"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="557" x2="557" y1="77.2038" y2="681.424"/><rect fill="#E2E2F0" height="71.2038" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108" x="107" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="117" y="26.9659">Relying Party</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="114" y="46.0339">(OAuth Client)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="129" y="65.1018">https://rp</text><rect fill="#E2E2F0" height="71.2038" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="207" x="453.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="501" y="26.9659">OpenID Provider</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="193" x="460.5" y="46.0339">(OAuth Authorization Server)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="524" y="65.1018">https://op</text><rect fill="#E2E2F0" height="71.2038" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108" x="107" y="681.424"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="117" y="703.39">Relying Party</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="114" y="722.4579">(OAuth Client)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="129" y="741.5258">https://rp</text><rect fill="#E2E2F0" height="71.2038" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="207" x="453.5" y="681.424"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="501" y="703.39">OpenID Provider</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="193" x="460.5" y="722.4579">(OAuth Authorization Server)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="524" y="741.5258">https://op</text><polygon fill="#181818" points="545,140.3218,555,144.3218,545,148.3218,549,144.3218" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="161" x2="551" y1="144.3218" y2="144.3218"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="114" x="168" y="103.1008">UserInfo Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187" x="285" y="103.1008">(OAuth Authenticated Request)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="242" x="168" y="120.8068">HTTPS GET (or POST) https://op/userinfo</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="372" x="168" y="138.5128">Authorization: Bearer AT-XXXX (or another Beare Token suage)</text><path d="M413.5,157.3218 L413.5,202.3218 L700.5,202.3218 L700.5,167.3218 L690.5,157.3218 L413.5,157.3218 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M690.5,157.3218 L690.5,167.3218 L700.5,167.3218 L690.5,157.3218 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="242" x="419.5" y="176.2188">The UserInfo endpoint SHOULD support</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="266" x="419.5" y="193.9248">requests by a RP web frontend (using CORS).</text><polygon fill="#FEFFDD" points="496,212.7338,618,212.7338,628,224.7338,618,237.7338,496,237.7338,486,224.7338,496,212.7338" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="498" y="230.6308">Check access_token</text><path d="M52,247.4398 L115,247.4398 L115,257.1459 L105,267.1459 L52,267.1459 L52,247.4398 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="356.5721" style="stroke:#000000;stroke-width:1.5;" width="521" x="52" y="247.4398"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="67" y="262.3369">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="238" x="130" y="261.1988">[userinfo_signed_response_alg not defined]</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="52" x2="573" y1="479.206" y2="479.206"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="216" x="57" y="492.9649">[userinfo_signed_response_alg defined]</text><polygon fill="#181818" points="172,456.206,162,460.206,172,464.206,168,460.206" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="166" x2="556" y1="460.206" y2="460.206"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="122" x="178" y="295.0429">UserInfo Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="178" y="312.7489">HTTPS 200, JSON</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="178" y="330.4549">"sub": "SUB-XXXX",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="178" y="348.1609">"aud": "CID-XXXX",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="178" y="365.8669">"name": "Jane Doe",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="178" y="383.573">"given_name": "Jane",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="178" y="401.279">"family_name": "Doe",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="178" y="418.985">"preferred_username": "j.doe",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="178" y="436.691">"email": "janedoe@example.com",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10" x="178" y="454.397">…</text><polygon fill="#181818" points="172,556.306,162,560.306,172,564.306,168,560.306" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="166" x2="556" y1="560.306" y2="560.306"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="122" x="178" y="519.0849">UserInfo Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227" x="178" y="536.7909">HTTPS 200, JWT (JWS or JWS-then-JWE)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10" x="178" y="554.497">…</text><polygon fill="#FEFFDD" points="83,573.306,239,573.306,249,585.306,239,598.306,83,598.306,73,585.306,83,573.306" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="85" y="591.203">Decrypt JWE, validate JWS</text><polygon fill="#FEFFDD" points="20,623.012,302,623.012,312,644.012,302,666.012,20,666.012,10,644.012,20,623.012" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="269" x="22" y="640.909">⚠️ Check "sub" claim consistent with id_token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="278" x="22" y="658.615">(protection against token substitution attacks)</text><!--MD5=[f80e04ffb4feb74ce70ec2d0fccc36ca]
@startuml

!pragma teoz true

participant "Relying Party\n(OAuth Client)\nhttps://rp" as client
participant "OpenID Provider\n(OAuth Authorization Server)\nhttps://op" as as


client -> as:  **UserInfo Request** (OAuth Authenticated Request)\nHTTPS GET (or POST) https://op/userinfo\nAuthorization: Bearer AT-XXXX (or another Beare Token suage)

note over as: The UserInfo endpoint SHOULD support\nrequests by a RP web frontend (using CORS).

hnote over as: Check access_token

alt userinfo_signed_response_alg not defined

as - -> client: **UserInfo Response**\nHTTPS 200, JSON\n"sub": "SUB-XXXX",\n"aud": "CID-XXXX",\n"name": "Jane Doe",\n"given_name": "Jane",\n"family_name": "Doe",\n"preferred_username": "j.doe",\n"email": "janedoe@example.com",\n…

else userinfo_signed_response_alg defined

as - -> client: **UserInfo Response**\nHTTPS 200, JWT (JWS or JWS-then-JWE)\n…

hnote over client: Decrypt JWE, validate JWS

end

hnote over client: ⚠️ Check "sub" claim consistent with id_token\n(protection against token substitution attacks)

@enduml

PlantUML version 1.2022.13(Sat Nov 19 14:22:17 CET 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: fr
Country: FR
--></g></svg>