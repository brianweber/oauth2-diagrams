<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1151px" preserveAspectRatio="none" style="width:1399px;height:1151px;background:#FFFFFF;" version="1.1" viewBox="0 0 1399 1151" width="1399px" zoomAndPan="magnify"><defs/><g><rect fill="#DDDDDD" height="1139.8063" style="stroke:#181818;stroke-width:0.5;" width="864.5" x="227.5" y="6"/><rect fill="none" height="120.5301" style="stroke:#000000;stroke-width:1.5;" width="912" x="288" y="529.8441"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="141" x2="141" y1="108.1358" y2="1041.6705"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="313" x2="313" y1="108.1358" y2="1041.6705"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="558" x2="558" y1="108.1358" y2="1041.6705"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="995" x2="995" y1="108.1358" y2="1041.6705"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1184" x2="1184" y1="108.1358" y2="1041.6705"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1331.5" x2="1331.5" y1="108.1358" y2="1041.6705"/><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="100" x="91" y="55"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="121.5" y="76.9659">Client</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="98" y="96.0339">https://client</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="163" x="231.5" y="55"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="149" x="238.5" y="76.9659">User Agent / Frontend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="282" y="96.0339">for Client</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="499.5" y="84.9659">Resource Owner</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="535.5" y="104.0339">(User)</text><ellipse cx="558" cy="18.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M558,26.5 L558,53.5 M545,34.5 L571,34.5 M558,53.5 L545,68.5 M558,53.5 L571,68.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="186" x="902" y="55"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="172" x="909" y="76.9659">User Agent / Frontend for</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="926" y="96.0339">Authorization Server</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="152" x="1108" y="55"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="1115" y="76.9659">Authorization Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="1152" y="96.0339">https://as</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="123" x="1270" y="55"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109" x="1277" y="76.9659">Resource Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="1300.5" y="96.0339">https://rs</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="100" x="91" y="1041.6705"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="121.5" y="1063.6364">Client</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="98" y="1082.7043">https://client</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="163" x="231.5" y="1041.6705"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="149" x="238.5" y="1063.6364">User Agent / Frontend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="282" y="1082.7043">for Client</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="499.5" y="1116.6364">Resource Owner</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="535.5" y="1135.7043">(User)</text><ellipse cx="558" cy="1050.1705" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M558,1058.1705 L558,1085.1705 M545,1066.1705 L571,1066.1705 M558,1085.1705 L545,1100.1705 M558,1085.1705 L571,1100.1705 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="186" x="902" y="1041.6705"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="172" x="909" y="1063.6364">User Agent / Frontend for</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="926" y="1082.7043">Authorization Server</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="152" x="1108" y="1041.6705"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="1115" y="1063.6364">Authorization Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="1152" y="1082.7043">https://as</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="123" x="1270" y="1041.6705"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109" x="1277" y="1063.6364">Resource Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="1300.5" y="1082.7043">https://rs</text><path d="M27,121.1358 L27,219.1358 L255,219.1358 L255,131.1358 L245,121.1358 L27,121.1358 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M245,121.1358 L245,131.1358 L255,131.1358 L245,121.1358 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207" x="33" y="140.0328">Authorization Server configuration</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="33" y="157.7389">(endpoints, etc.)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="33" y="175.4449">and client credentials</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164" x="33" y="193.1509">(client_id, client_secret, etc.)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="33" y="210.8569">already provisionned</text><path d="M1110.5,138.8419 L1110.5,201.8419 L1257.5,201.8419 L1257.5,148.8419 L1247.5,138.8419 L1110.5,138.8419 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1247.5,138.8419 L1247.5,148.8419 L1257.5,148.8419 L1247.5,138.8419 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="1116.5" y="157.7389">Client configuration</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="1116.5" y="175.4449">already provisionned</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="1116.5" y="193.1509">(redirect_uris, etc.)</text><polygon fill="#181818" points="324,244.3719,314,248.3719,324,252.3719,320,248.3719" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="318" x2="557" y1="248.3719" y2="248.3719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221" x="330" y="242.5629">Request to authorize resource access</text><polygon fill="#181818" points="152,244.3719,142,248.3719,152,252.3719,148,248.3719" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="146" x2="312" y1="248.3719" y2="248.3719"/><polygon fill="#181818" points="301,478.1381,311,482.1381,301,486.1381,305,482.1381" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="141" x2="307" y1="482.1381" y2="482.1381"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="148" y="476.3291">(HTTPS 302)</text><polygon fill="#181818" points="983,478.1381,993,482.1381,983,486.1381,987,482.1381" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="313" x2="989" y1="482.1381" y2="482.1381"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="149" x="320" y="299.2689">Authorization Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="357" x="320" y="316.975">Redirection to GET https://as/auth (authorization_endpoint)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210" x="326" y="334.681">?response_type=token (REQUIRED)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249" x="326" y="352.387">&amp;client_id=CID-XXXX (REQUIRED, opaque)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="652" x="326" y="370.093">&amp;redirect_uri=https%3A%2F%2Fclient%2Ecallback (REQUIRED unless exactly one URI registered for this client)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="260" x="326" y="387.799">&amp;state=AS-XXXX (RECOMMENDED, opaque)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="6" x="320" y="405.505">  </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218" x="326" y="423.2111">&amp;scope=scope1+scope2 (OPTIONAL)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="294" x="326" y="440.9171">&amp;resource=http://rs/api (extension, API base URI)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="468" x="326" y="458.6231">&amp;authorization_details=[{"type": "…", …}, …] (extension, see draft-ietf-oauth-rar)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="320" y="476.3291">\</text><path d="M1000,286.3719 L1000,313.3719 L1290,313.3719 L1290,296.3719 L1280,286.3719 L1000,286.3719 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1280,286.3719 L1280,296.3719 L1290,296.3719 L1280,286.3719 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="269" x="1006" y="305.2689">POST (urlencoded) may be supported as well.</text><path d="M51,286.3719 L51,366.3719 L308,366.3719 L308,296.3719 L298,286.3719 L51,286.3719 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M298,286.3719 L298,296.3719 L308,296.3719 L298,286.3719 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236" x="57" y="305.2689">For native apps, the redirect_uri may be</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="57" y="322.975">a claimed https:// URI,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="57" y="340.681">a com.example.foo: (private) URI,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="57" y="358.387">or a http://localhost:XXX URI</text><polygon fill="#181818" points="1172,478.1381,1182,482.1381,1172,486.1381,1176,482.1381" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="995" x2="1178" y1="482.1381" y2="482.1381"/><polygon fill="#FEFFDD" points="1068,495.1381,1300,495.1381,1310,507.1381,1300,520.1381,1068,520.1381,1058,507.1381,1068,495.1381" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="228" x="1070" y="513.0351">Check redirect_uri allowed for client_id</text><path d="M288,529.8441 L355,529.8441 L355,539.5501 L345,549.5501 L288,549.5501 L288,529.8441 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="120.5301" style="stroke:#000000;stroke-width:1.5;" width="912" x="288" y="529.8441"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="22" x="303" y="544.7411">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="211" x="370" y="543.603">[User does not already have a session]</text><polygon fill="#181818" points="569,600.9622,559,604.9622,569,608.9622,565,604.9622" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="983,600.9622,993,604.9622,983,608.9622,987,604.9622" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="563" x2="989" y1="604.9622" y2="604.9622"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="575" y="599.1532">User authentication</text><polygon fill="#181818" points="1006,600.9622,996,604.9622,1006,608.9622,1002,604.9622" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1172,600.9622,1182,604.9622,1172,608.9622,1176,604.9622" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1000" x2="1178" y1="604.9622" y2="604.9622"/><path d="M309,564.5501 L309,644.5501 L553,644.5501 L553,574.5501 L543,564.5501 L309,564.5501 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M543,564.5501 L543,574.5501 L553,574.5501 L543,564.5501 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="315" y="583.4472">Authorization Server</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223" x="315" y="601.1532">may use any authentication methods</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="315" y="618.8592">(mTLS, WebAuthn, etc.)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="315" y="636.5652">for authenticating the user</text><polygon fill="#181818" points="569,684.0802,559,688.0802,569,692.0802,565,688.0802" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="983,684.0802,993,688.0802,983,692.0802,987,688.0802" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="563" x2="989" y1="688.0802" y2="688.0802"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="575" y="682.2712">Consent</text><path d="M375,669.3742 L375,714.3742 L553,714.3742 L553,679.3742 L543,669.3742 L375,669.3742 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M543,669.3742 L543,679.3742 L553,679.3742 L543,669.3742 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="381" y="688.2712">"Do you want to authorize</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="381" y="705.9772">ClientFoo to …?"</text><polygon fill="#181818" points="1006,684.0802,996,688.0802,1006,692.0802,1002,688.0802" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1172,684.0802,1182,688.0802,1172,692.0802,1176,688.0802" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1000" x2="1178" y1="688.0802" y2="688.0802"/><polygon fill="#181818" points="1006,863.4344,996,867.4344,1006,871.4344,1002,867.4344" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1000" x2="1183" y1="867.4344" y2="867.4344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="1012" y="861.6254">(HTTPS 302)</text><polygon fill="#181818" points="324,863.4344,314,867.4344,324,871.4344,320,867.4344" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="318" x2="994" y1="867.4344" y2="867.4344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="157" x="330" y="737.6833">Authorization Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="321" x="330" y="755.3893">Redirection to GET https://client/callback (redirect_uri)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="279" x="336" y="773.0953">?access_token=AT-XXXX (⚠️ NO refresh_token!)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218" x="336" y="790.8013">&amp;token_type=bearer" (or "mac", etc.)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="336" y="808.5073">&amp;expires_in":3600</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="336" y="826.2133">&amp;scope=scope1+scope2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="336" y="843.9194">&amp;state=AS-XXXX (if given)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="336" y="861.6254">&amp;iss=https://as (extension)</text><polygon fill="#181818" points="152,863.4344,142,867.4344,152,871.4344,148,867.4344" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="146" x2="312" y1="867.4344" y2="867.4344"/><polygon fill="#FEFFDD" points="20,880.4344,262,880.4344,272,910.4344,262,941.4344,20,941.4344,10,910.4344,20,880.4344" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="22" y="898.3314">Check validity of state</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="238" x="22" y="916.0374">and its association with the user session</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="22" y="933.7434">(protection against CSRF)</text><polygon fill="#FEFFDD" points="40.5,951.5524,241.5,951.5524,251.5,972.5524,241.5,994.5524,40.5,994.5524,30.5,972.5524,40.5,951.5524" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="42.5" y="969.4494">Check "iss" field (if given),</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="42.5" y="987.1555">protection against mixup attacks</text><polygon fill="#181818" points="301,1019.6705,311,1023.6705,301,1027.6705,305,1023.6705" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="141" x2="307" y1="1023.6705" y2="1023.6705"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="148" y="1017.8615">Restore application state</text><polygon fill="#181818" points="546,1019.6705,556,1023.6705,546,1027.6705,550,1023.6705" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="313" x2="552" y1="1023.6705" y2="1023.6705"/><!--MD5=[1328d46d23c1879a7a0450c616eef1af]
@startuml

!pragma teoz true

participant "Client\nhttps://client" as client
box
    participant "User Agent / Frontend\nfor Client" as uac
    actor "Resource Owner\n(User)" as user
    participant "User Agent / Frontend for\nAuthorization Server" as uaas
end box
participant "Authorization Server\nhttps://as" as as
participant "Resource Server\nhttps://rs" as rs

note over client: Authorization Server configuration\n(endpoints, etc.)\nand client credentials\n(client_id, client_secret, etc.)\nalready provisionned

& note over as: Client configuration\nalready provisionned\n(redirect_uris, etc.)

user -> uac: Request to authorize resource access
& uac -> client

|||

client -> uac : (HTTPS 302)
& uac -> uaas: **Authorization Request**\nRedirection to GET https://as/auth (authorization_endpoint)\n  ?response_type=token (REQUIRED)\n  &client_id=CID-XXXX (REQUIRED, opaque)\n  &redirect_uri=https%3A%2F%2Fclient%2Ecallback (REQUIRED unless exactly one URI registered for this client)\n  &state=AS-XXXX (RECOMMENDED, opaque)\n  \n  &scope=scope1+scope2 (OPTIONAL)\n  &resource=http://rs/api (extension, API base URI)\n  &authorization_details=[{"type": "…", …}, …] (extension, see draft-ietf-oauth-rar)\n\  
note right: POST (urlencoded) may be supported as well.
note left: For native apps, the redirect_uri may be\na claimed https:// URI,\na com.example.foo: (private) URI,\nor a http://localhost:XXX URI
& uaas -> as


hnote over as: Check redirect_uri allowed for client_id

opt User does not already have a session
  user <-> uaas : User authentication
  & uaas <-> as
  & note left of user: Authorization Server\nmay use any authentication methods\n(mTLS, WebAuthn, etc.)\nfor authenticating the user
end

user <-> uaas : Consent
rnote left: "Do you want to authorize\nClientFoo to …?"
& uaas <-> as

as - -> uaas: (HTTPS 302)
& uaas - -> uac: **Authorization Response**\nRedirection to GET https://client/callback (redirect_uri)\n  ?access_token=AT-XXXX (⚠️ NO refresh_token!)\n  &token_type=bearer" (or "mac", etc.)\n  &expires_in":3600\n  &scope=scope1+scope2\n  &state=AS-XXXX (if given)\n  &iss=https://as (extension)
& uac - -> client

hnote over client: Check validity of state\nand its association with the user session\n(protection against CSRF)
hnote over client: Check "iss" field (if given),\nprotection against mixup attacks

client -> uac: Restore application state
& uac -> user

@enduml

PlantUML version 1.2022.13(Sat Nov 19 14:22:17 CET 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: fr
Country: FR
--></g></svg>