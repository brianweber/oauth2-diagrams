<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1953px" preserveAspectRatio="none" style="width:1402px;height:1953px;background:#FFFFFF;" version="1.1" viewBox="0 0 1402 1953" width="1402px" zoomAndPan="magnify"><defs/><g><rect fill="#DDDDDD" height="1941.9868" style="stroke:#181818;stroke-width:0.5;" width="680.5" x="245.5" y="6"/><rect fill="none" height="100.8241" style="stroke:#000000;stroke-width:1.5;" width="302" x="8" y="285.3719"/><rect fill="none" height="120.5301" style="stroke:#000000;stroke-width:1.5;" width="728" x="306" y="719.4923"/><rect fill="none" height="186.5301" style="stroke:#000000;stroke-width:1.5;" width="388" x="836.5" y="1392.5547"/><rect fill="none" height="67.412" style="stroke:#000000;stroke-width:1.5;" width="325" x="855.5" y="1497.6728"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="159" x2="159" y1="108.1358" y2="1843.851"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="331" x2="331" y1="108.1358" y2="1843.851"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="576" x2="576" y1="108.1358" y2="1843.851"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="829" x2="829" y1="108.1358" y2="1843.851"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1018" x2="1018" y1="108.1358" y2="1843.851"/><rect fill="#FFFFFF" height="502.7083" style="stroke:#181818;stroke-width:1.0;" width="10" x="1013" y="1291.4367"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1165.5" x2="1165.5" y1="108.1358" y2="1843.851"/><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="100" x="109" y="55"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="139.5" y="76.9659">Client</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="116" y="96.0339">https://client</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="163" x="249.5" y="55"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="149" x="256.5" y="76.9659">User Agent / Frontend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="300" y="96.0339">for Client</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="517.5" y="84.9659">Resource Owner</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="553.5" y="104.0339">(User)</text><ellipse cx="576" cy="18.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M576,26.5 L576,53.5 M563,34.5 L589,34.5 M576,53.5 L563,68.5 M576,53.5 L589,68.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="186" x="736" y="55"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="172" x="743" y="76.9659">User Agent / Frontend for</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="760" y="96.0339">Authorization Server</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="152" x="942" y="55"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="949" y="76.9659">Authorization Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="986" y="96.0339">https://as</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="123" x="1104" y="55"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109" x="1111" y="76.9659">Resource Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="1134.5" y="96.0339">https://rs</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="100" x="109" y="1843.851"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="139.5" y="1865.8169">Client</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="116" y="1884.8848">https://client</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="163" x="249.5" y="1843.851"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="149" x="256.5" y="1865.8169">User Agent / Frontend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="300" y="1884.8848">for Client</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="517.5" y="1918.8169">Resource Owner</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="553.5" y="1937.8848">(User)</text><ellipse cx="576" cy="1852.351" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M576,1860.351 L576,1887.351 M563,1868.351 L589,1868.351 M576,1887.351 L563,1902.351 M576,1887.351 L589,1902.351 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="186" x="736" y="1843.851"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="172" x="743" y="1865.8169">User Agent / Frontend for</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="760" y="1884.8848">Authorization Server</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="152" x="942" y="1843.851"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="949" y="1865.8169">Authorization Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="986" y="1884.8848">https://as</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="123" x="1104" y="1843.851"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109" x="1111" y="1865.8169">Resource Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="1134.5" y="1884.8848">https://rs</text><path d="M45,121.1358 L45,219.1358 L273,219.1358 L273,131.1358 L263,121.1358 L45,121.1358 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M263,121.1358 L263,131.1358 L273,131.1358 L263,121.1358 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207" x="51" y="140.0328">Authorization Server configuration</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="51" y="157.7389">(endpoints, etc.)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="51" y="175.4449">and client credentials</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164" x="51" y="193.1509">(client_id, client_secret, etc.)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="51" y="210.8569">already provisionned</text><path d="M944.5,138.8419 L944.5,201.8419 L1091.5,201.8419 L1091.5,148.8419 L1081.5,138.8419 L944.5,138.8419 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1081.5,138.8419 L1081.5,148.8419 L1091.5,148.8419 L1081.5,138.8419 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="950.5" y="157.7389">Client configuration</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="950.5" y="175.4449">already provisionned</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="950.5" y="193.1509">(redirect_uris, etc.)</text><polygon fill="#181818" points="342,244.3719,332,248.3719,342,252.3719,338,248.3719" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="336" x2="575" y1="248.3719" y2="248.3719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221" x="348" y="242.5629">Request to authorize resource access</text><polygon fill="#181818" points="170,244.3719,160,248.3719,170,252.3719,166,248.3719" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="164" x2="330" y1="248.3719" y2="248.3719"/><path d="M8,285.3719 L75,285.3719 L75,295.0779 L65,305.0779 L8,305.0779 L8,285.3719 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="100.8241" style="stroke:#000000;stroke-width:1.5;" width="302" x="8" y="285.3719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="22" x="23" y="300.2689">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="64" x="90" y="299.1308">[PKCE used]</text><polygon fill="#FEFFDD" points="39,320.0779,279,320.0779,289,350.0779,279,381.0779,39,381.0779,29,350.0779,39,320.0779" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="41" y="337.975">Generate random code_verifier</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="41" y="355.681">and derive code_challenge=</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="230" x="47" y="373.387">code_challenge_method(code_verifier)</text><polygon fill="#181818" points="319,667.7862,329,671.7862,319,675.7862,323,671.7862" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="159" x2="325" y1="671.7862" y2="671.7862"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="166" y="665.9772">(HTTPS 302)</text><polygon fill="#181818" points="817,667.7862,827,671.7862,817,675.7862,821,671.7862" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="331" x2="823" y1="671.7862" y2="671.7862"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="149" x="338" y="418.093">Authorization Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="357" x="338" y="435.799">Redirection to GET https://as/auth (authorization_endpoint)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="204" x="344" y="453.505">?response_type=code (REQUIRED)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249" x="344" y="471.2111">&amp;client_id=CID-XXXX (REQUIRED, opaque)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="297" x="344" y="488.9171">&amp;redirect_uri=https%3A%2F%2Fclient%2Ecallback</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="351" x="350" y="506.6231">(REQUIRED unless exactly one URI registered for this client,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183" x="350" y="524.3291">REQUIRED in OpenID Connect)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="260" x="344" y="542.0351">&amp;state=AS-XXXX (RECOMMENDED, opaque)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="6" x="338" y="559.7411">  </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218" x="344" y="577.4472">&amp;scope=scope1+scope2 (OPTIONAL)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="294" x="344" y="595.1532">&amp;resource=http://rs/api (extension, API base URI)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="468" x="344" y="612.8592">&amp;authorization_details=[{"type": "…", …}, …] (extension, see draft-ietf-oauth-rar)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="6" x="338" y="630.5652">  </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="275" x="344" y="648.2712">&amp;code_challenge_method=S256 (if PKCE used)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="241" x="344" y="665.9772">&amp;code_challenge=CCCCCC (if PKCE used)</text><path d="M69,405.196 L69,485.196 L326,485.196 L326,415.196 L316,405.196 L69,405.196 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M316,405.196 L316,415.196 L326,415.196 L316,405.196 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236" x="75" y="424.093">For native apps, the redirect_uri may be</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="75" y="441.799">a claimed https:// URI,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="75" y="459.505">a com.example.foo: (private) URI,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="75" y="477.2111">or a http://localhost:XXX URI</text><path d="M834,405.196 L834,432.196 L1124,432.196 L1124,415.196 L1114,405.196 L834,405.196 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1114,405.196 L1114,415.196 L1124,415.196 L1114,405.196 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="269" x="840" y="424.093">POST (urlencoded) may be supported as well.</text><polygon fill="#181818" points="1006,667.7862,1016,671.7862,1006,675.7862,1010,671.7862" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="829" x2="1012" y1="671.7862" y2="671.7862"/><polygon fill="#FEFFDD" points="902,684.7862,1134,684.7862,1144,696.7862,1134,709.7862,902,709.7862,892,696.7862,902,684.7862" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="228" x="904" y="702.6833">Check redirect_uri allowed for client_id</text><path d="M306,719.4923 L373,719.4923 L373,729.1983 L363,739.1983 L306,739.1983 L306,719.4923 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="120.5301" style="stroke:#000000;stroke-width:1.5;" width="728" x="306" y="719.4923"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="22" x="321" y="734.3893">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="211" x="388" y="733.2512">[User does not already have a session]</text><polygon fill="#181818" points="587,790.6103,577,794.6103,587,798.6103,583,794.6103" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="817,790.6103,827,794.6103,817,798.6103,821,794.6103" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="581" x2="823" y1="794.6103" y2="794.6103"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="593" y="788.8013">User authentication</text><polygon fill="#181818" points="840,790.6103,830,794.6103,840,798.6103,836,794.6103" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1006,790.6103,1016,794.6103,1006,798.6103,1010,794.6103" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="834" x2="1012" y1="794.6103" y2="794.6103"/><path d="M327,754.1983 L327,834.1983 L571,834.1983 L571,764.1983 L561,754.1983 L327,754.1983 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M561,754.1983 L561,764.1983 L571,764.1983 L561,754.1983 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="333" y="773.0953">Authorization Server</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223" x="333" y="790.8013">may use any authentication methods</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="333" y="808.5073">(mTLS, WebAuthn, etc.)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="333" y="826.2133">for authenticating user</text><polygon fill="#181818" points="587,873.7284,577,877.7284,587,881.7284,583,877.7284" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="817,873.7284,827,877.7284,817,881.7284,821,877.7284" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="581" x2="823" y1="877.7284" y2="877.7284"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="593" y="871.9194">Consent</text><path d="M393,859.0223 L393,904.0223 L571,904.0223 L571,869.0223 L561,859.0223 L393,859.0223 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M561,859.0223 L561,869.0223 L571,869.0223 L561,859.0223 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="399" y="877.9194">"Do you want to authorize</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="399" y="895.6254">ClientFoo to …?"</text><polygon fill="#181818" points="840,873.7284,830,877.7284,840,881.7284,836,877.7284" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1006,873.7284,1016,877.7284,1006,881.7284,1010,877.7284" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="834" x2="1012" y1="877.7284" y2="877.7284"/><polygon fill="#181818" points="840,999.9645,830,1003.9645,840,1007.9645,836,1003.9645" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="834" x2="1017" y1="1003.9645" y2="1003.9645"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="846" y="998.1555">(HTTPS 302)</text><polygon fill="#181818" points="342,999.9645,332,1003.9645,342,1007.9645,338,1003.9645" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="336" x2="828" y1="1003.9645" y2="1003.9645"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="157" x="348" y="927.3314">Authorization Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="321" x="348" y="945.0374">Redirection to GET https://client/callback (redirect_uri)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217" x="354" y="962.7434">?code=AC-XXXX (opaque, single-use)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="354" y="980.4494">&amp;state=AS-XXXX (if given)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="354" y="998.1555">&amp;iss=https://as (extension)</text><polygon fill="#181818" points="170,999.9645,160,1003.9645,170,1007.9645,166,1003.9645" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="164" x2="330" y1="1003.9645" y2="1003.9645"/><polygon fill="#FEFFDD" points="38,1016.9645,280,1016.9645,290,1046.9645,280,1077.9645,38,1077.9645,28,1046.9645,38,1016.9645" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="40" y="1034.8615">Check validity of state</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="238" x="40" y="1052.5675">and its association with the user session</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="40" y="1070.2735">(protection against CSRF)</text><polygon fill="#FEFFDD" points="54.5,1088.0825,263.5,1088.0825,273.5,1109.0825,263.5,1131.0825,54.5,1131.0825,44.5,1109.0825,54.5,1088.0825" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="56.5" y="1105.9795">Check "iss" field if given</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205" x="56.5" y="1123.6855">(protection against mixup attacks)</text><polygon fill="#181818" points="1001,1287.4367,1011,1291.4367,1001,1295.4367,1005,1291.4367" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="159" x2="1007" y1="1291.4367" y2="1291.4367"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="144" x="166" y="1179.3916">Access Token Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="356" x="166" y="1197.0976">HTTPS POST https://as/token (token_endpoint), urlencoded</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="693" x="166" y="1214.8036">Authorization: Basic … (client_id + client_secret) (or other authentication method, see token_endpoint_auth_method)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189" x="166" y="1232.5096">grant_type=authorization_code</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="172" y="1250.2156">&amp;code=AC-XXXX</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="419" x="172" y="1267.9216">&amp;redirect_uri=https%3A%2F%2Fclient%2Fcallback (same as in request)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="442" x="172" y="1285.6277">&amp;code_verifier=CV-XXXXV (if and only if code_challenge was used i.e. PKCE)</text><path d="M1028,1166.4945 L1028,1211.4945 L1395,1211.4945 L1395,1176.4945 L1385,1166.4945 L1028,1166.4945 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1385,1166.4945 L1385,1176.4945 L1395,1176.4945 L1385,1166.4945 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="326" x="1034" y="1185.3916">If support for browser-based / single-page applications</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="346" x="1034" y="1203.0976">is needed the token endpoint need a suitable CORS policy.</text><polygon fill="#FEFFDD" points="931.5,1304.4367,1104.5,1304.4367,1114.5,1325.4367,1104.5,1347.4367,931.5,1347.4367,921.5,1325.4367,931.5,1304.4367" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169" x="933.5" y="1322.3337">Check (client authentication,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="933.5" y="1340.0397">redirect_uri, code, etc)</text><polygon fill="#FEFFDD" points="927.5,1357.8487,1108.5,1357.8487,1118.5,1369.8487,1108.5,1382.8487,927.5,1382.8487,917.5,1369.8487,927.5,1357.8487" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="929.5" y="1375.7457">Check code issued to client_id</text><path d="M836.5,1392.5547 L903.5,1392.5547 L903.5,1402.2607 L893.5,1412.2607 L836.5,1412.2607 L836.5,1392.5547 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="186.5301" style="stroke:#000000;stroke-width:1.5;" width="388" x="836.5" y="1392.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="22" x="851.5" y="1407.4517">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="290" x="918.5" y="1406.3136">[code_challenge was sent in authentication request]</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="836.5" x2="1224.5" y1="1486.6728" y2="1486.6728"/><polygon fill="#FEFFDD" points="893,1427.2607,1143,1427.2607,1153,1448.2607,1143,1470.2607,893,1470.2607,883,1448.2607,893,1427.2607" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="895" y="1445.1577">Check code_verifier=</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="246" x="895" y="1462.8638">code_challenge_method(code_challenge)</text><path d="M855.5,1497.6728 L938.5,1497.6728 L938.5,1507.3788 L928.5,1517.3788 L855.5,1517.3788 L855.5,1497.6728 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="67.412" style="stroke:#000000;stroke-width:1.5;" width="325" x="855.5" y="1497.6728"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="38" x="870.5" y="1512.5698">break</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="153" x="953.5" y="1511.4317">[code_verifier was supplied]</text><path d="M876.5,1532.3788 L876.5,1559.3788 L1159.5,1559.3788 L1159.5,1542.3788 L1149.5,1532.3788 L876.5,1532.3788 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1149.5,1532.3788 L1149.5,1542.3788 L1159.5,1542.3788 L1149.5,1532.3788 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="262" x="882.5" y="1551.2758">Protection against PKCE downgrade attacks</text><polygon fill="#FEFFDD" points="943,1598.0848,1093,1598.0848,1103,1610.0848,1093,1623.0848,943,1623.0848,933,1610.0848,943,1598.0848" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="945" y="1615.9818">Revoke code (single use)</text><polygon fill="#181818" points="170,1790.145,160,1794.145,170,1798.145,166,1794.145" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="164" x2="1012" y1="1794.145" y2="1794.145"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="152" x="176" y="1646.6878">Access Token Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="176" y="1664.3938">HTTPS 200, JSON</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="176" y="1682.0999">"access_token":"AT-XXXX", (opaque)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="176" y="1699.8059">"token_type":"bearer",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="176" y="1717.5119">"expires_in":3600,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="287" x="176" y="1735.2179">"refresh_token":"RT-XXXX", (OPTIONAL, opaque)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="176" y="1752.9239">"scope":"scope1 scope2",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="467" x="176" y="1770.6299">"authorization_details": [{"type": "…", …}, …] (extension, see draft-ietf-oauth-rar)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="3" x="176" y="1788.336"> </text><path d="M1028,1633.7908 L1028,1696.7908 L1337,1696.7908 L1337,1643.7908 L1327,1633.7908 L1028,1633.7908 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1327,1633.7908 L1327,1643.7908 L1337,1643.7908 L1327,1633.7908 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="243" x="1034" y="1652.6878">The access_token is opaque for the client</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194" x="1034" y="1670.3938">and its content is not mandated.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="288" x="1034" y="1688.0999">It may be a JWT with the application/at+jwt type.</text><polygon fill="#181818" points="319,1821.851,329,1825.851,319,1829.851,323,1825.851" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="159" x2="325" y1="1825.851" y2="1825.851"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="166" y="1820.042">Restore application state</text><polygon fill="#181818" points="564,1821.851,574,1825.851,564,1829.851,568,1825.851" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="331" x2="570" y1="1825.851" y2="1825.851"/><!--MD5=[7526201d253960cb1afdc2d13e7a2a01]
@startuml

!pragma teoz true

participant "Client\nhttps://client" as client
box
    participant "User Agent / Frontend\nfor Client" as uac
    actor "Resource Owner\n(User)" as user
    participant "User Agent / Frontend for\nAuthorization Server" as uaas
end box
participant "Authorization Server\nhttps://as" as as
participant "Resource Server\nhttps://rs" as rs

note over client: Authorization Server configuration\n(endpoints, etc.)\nand client credentials\n(client_id, client_secret, etc.)\nalready provisionned

& note over as: Client configuration\nalready provisionned\n(redirect_uris, etc.)

user -> uac: Request to authorize resource access
& uac -> client

|||

opt PKCE used

hnote over client: Generate random code_verifier\nand derive code_challenge=\n  code_challenge_method(code_verifier)

end

client -> uac : (HTTPS 302)
& uac -> uaas: **Authorization Request**\nRedirection to GET https://as/auth (authorization_endpoint)\n  ?response_type=code (REQUIRED)\n  &client_id=CID-XXXX (REQUIRED, opaque)\n  &redirect_uri=https%3A%2F%2Fclient%2Ecallback\n    (REQUIRED unless exactly one URI registered for this client,\n    REQUIRED in OpenID Connect)\n  &state=AS-XXXX (RECOMMENDED, opaque)\n  \n  &scope=scope1+scope2 (OPTIONAL)\n  &resource=http://rs/api (extension, API base URI)\n  &authorization_details=[{"type": "…", …}, …] (extension, see draft-ietf-oauth-rar)\n  \n  &code_challenge_method=S256 (if PKCE used)\n  &code_challenge=CCCCCC (if PKCE used)

note left: For native apps, the redirect_uri may be\na claimed https:// URI,\na com.example.foo: (private) URI,\nor a http://localhost:XXX URI
note right: POST (urlencoded) may be supported as well.

& uaas -> as



hnote over as: Check redirect_uri allowed for client_id


opt User does not already have a session
  user <-> uaas : User authentication
  & uaas <-> as
  & note left of user: Authorization Server\nmay use any authentication methods\n(mTLS, WebAuthn, etc.)\nfor authenticating user
end

user <-> uaas : Consent
rnote left: "Do you want to authorize\nClientFoo to …?"
& uaas <-> as

as - -> uaas: (HTTPS 302)
& uaas - -> uac: **Authorization Response**\nRedirection to GET https://client/callback (redirect_uri)\n  ?code=AC-XXXX (opaque, single-use)\n  &state=AS-XXXX (if given)\n  &iss=https://as (extension)
& uac - -> client

hnote over client: Check validity of state\nand its association with the user session\n(protection against CSRF)
hnote over client: Check "iss" field if given\n(protection against mixup attacks)

|||

client -> as ++ : **Access Token Request**\nHTTPS POST https://as/token (token_endpoint), urlencoded\nAuthorization: Basic … (client_id + client_secret) (or other authentication method, see token_endpoint_auth_method)\ngrant_type=authorization_code\n  &code=AC-XXXX\n  &redirect_uri=https%3A%2F%2Fclient%2Fcallback (same as in request)\n  &code_verifier=CV-XXXXV (if and only if code_challenge was used i.e. PKCE)

note right: If support for browser-based / single-page applications\nis needed the token endpoint need a suitable CORS policy.

hnote over as: Check (client authentication,\nredirect_uri, code, etc)
hnote over as: Check code issued to client_id
opt code_challenge was sent in authentication request
  hnote over as: Check code_verifier=\ncode_challenge_method(code_challenge)
else
  break code_verifier was supplied
    note over as: Protection against PKCE downgrade attacks
  end
end
hnote over as: Revoke code (single use)

client <- - as - - : **Access Token Response**\nHTTPS 200, JSON\n"access_token":"AT-XXXX", (opaque)\n"token_type":"bearer",\n"expires_in":3600,\n"refresh_token":"RT-XXXX", (OPTIONAL, opaque)\n"scope":"scope1 scope2",\n"authorization_details": [{"type": "…", …}, …] (extension, see draft-ietf-oauth-rar)\n
note right: The access_token is opaque for the client\nand its content is not mandated.\nIt may be a JWT with the application/at+jwt type.

client -> uac: Restore application state
& uac -> user

@enduml

PlantUML version 1.2022.13(Sat Nov 19 14:22:17 CET 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: fr
Country: FR
--></g></svg>