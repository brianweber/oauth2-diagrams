<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1122px" preserveAspectRatio="none" style="width:1174px;height:1122px;background:#FFFFFF;" version="1.1" viewBox="0 0 1174 1122" width="1174px" zoomAndPan="magnify"><defs/><g><rect fill="#DDDDDD" height="1110.3661" style="stroke:#181818;stroke-width:0.5;" width="702.5" x="176" y="6"/><rect fill="none" height="555.9163" style="stroke:#000000;stroke-width:1.5;" width="1159.5" x="8" y="432.314"/><rect fill="none" height="375.0922" style="stroke:#000000;stroke-width:1.5;" width="1115.5" x="27" y="466.0201"/><rect fill="none" height="224.5621" style="stroke:#000000;stroke-width:1.5;" width="1071.5" x="46" y="602.5501"/><rect fill="none" height="97.118" style="stroke:#000000;stroke-width:1.5;" width="494" x="520" y="877.1122"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="116" x2="116" y1="108.1358" y2="1012.2303"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="261.5" x2="261.5" y1="108.1358" y2="1012.2303"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="439" x2="439" y1="108.1358" y2="1012.2303"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="615.5" x2="615.5" y1="108.1358" y2="1012.2303"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="781.5" x2="781.5" y1="108.1358" y2="1012.2303"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="998" x2="998" y1="108.1358" y2="1012.2303"/><rect fill="#E2E2F0" height="71.2038" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108" x="62" y="35.9321"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="72" y="57.898">Relying Party</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="69" y="76.9659">(OAuth Client)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="84" y="96.0339">https://rp</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="163" x="180" y="55"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="149" x="187" y="76.9659">User Agent / Frontend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="206" y="96.0339">for Relying Party</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="420.5" y="84.9659">User</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="166" x="353" y="104.0339">(OAuth Resource Owner)</text><ellipse cx="439" cy="18.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M439,26.5 L439,53.5 M426,34.5 L452,34.5 M439,53.5 L426,68.5 M439,53.5 L452,68.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="126" x="552.5" y="55"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="585" y="76.9659">iframe of</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="559.5" y="96.0339">OpenID Provider</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="186" x="688.5" y="55"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="172" x="695.5" y="76.9659">User Agent / Frontend for</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="725.5" y="96.0339">OpenID Provider</text><rect fill="#E2E2F0" height="71.2038" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="207" x="894.5" y="35.9321"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="942" y="57.898">OpenID Provider</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="193" x="901.5" y="76.9659">(OAuth Authorization Server)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="965" y="96.0339">https://op</text><rect fill="#E2E2F0" height="71.2038" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108" x="62" y="1012.2303"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="72" y="1034.1962">Relying Party</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="69" y="1053.2642">(OAuth Client)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="84" y="1072.3321">https://rp</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="163" x="180" y="1012.2303"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="149" x="187" y="1034.1962">User Agent / Frontend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="206" y="1053.2642">for Relying Party</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="420.5" y="1087.1962">User</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="166" x="353" y="1106.2642">(OAuth Resource Owner)</text><ellipse cx="439" cy="1020.7303" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M439,1028.7303 L439,1055.7303 M426,1036.7303 L452,1036.7303 M439,1055.7303 L426,1070.7303 M439,1055.7303 L452,1070.7303 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="126" x="552.5" y="1012.2303"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="585" y="1034.1962">iframe of</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="559.5" y="1053.2642">OpenID Provider</text><rect fill="#E2E2F0" height="52.1358" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="186" x="688.5" y="1012.2303"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="172" x="695.5" y="1034.1962">User Agent / Frontend for</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="725.5" y="1053.2642">OpenID Provider</text><rect fill="#E2E2F0" height="71.2038" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="207" x="894.5" y="1012.2303"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="942" y="1034.1962">OpenID Provider</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="193" x="901.5" y="1053.2642">(OAuth Authorization Server)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="965" y="1072.3321">https://op</text><path d="M688.25,121.1358 L688.25,166.1358 L1091.25,166.1358 L1091.25,131.1358 L1081.25,121.1358 L688.25,121.1358 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1081.25,121.1358 L1081.25,131.1358 L1091.25,131.1358 L1081.25,121.1358 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="711.25" y="140.0328">Relevant RP Registration</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="348" x="711.25" y="157.7389">"check_session_iframe": "https://op/check_session_iframe"</text><polygon fill="#181818" points="792.5,279.784,782.5,283.784,792.5,287.784,788.5,283.784" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="786.5" x2="997" y1="283.784" y2="283.784"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="798.5" y="277.975">(HTTPS 302)</text><polygon fill="#181818" points="272.5,279.784,262.5,283.784,272.5,287.784,268.5,283.784" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="266.5" x2="780.5" y1="283.784" y2="283.784"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="167" x="278.5" y="189.4449">Authentication Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193" x="448.5" y="189.4449">(OAuth Authorization Response)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="302" x="278.5" y="207.1509">Redirection to GET https://rp/callback (redirect_uri)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217" x="284.5" y="224.8569">?code=AC-XXXX (opaque, single-use)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="284.5" y="242.5629">&amp;state=AS-XXXX (if given)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="284.5" y="260.2689">&amp;iss=https://op (extension)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="284.5" y="277.975">&amp;session_state=SS-XXXX</text><path d="M688.25,296.784 L688.25,359.784 L1091.25,359.784 L1091.25,306.784 L1081.25,296.784 L688.25,296.784 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1081.25,296.784 L1081.25,306.784 L1091.25,306.784 L1081.25,296.784 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="292" x="739.25" y="315.681">session_state is some salted hash of the client_id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="262" x="739.25" y="333.387">origin URI of the client and the session state</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="238" x="739.25" y="351.093">(i.e. which used are logged in) on the AS.</text><polygon fill="#181818" points="603.5,384.608,613.5,388.608,603.5,392.608,607.5,388.608" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="261.5" x2="609.5" y1="388.608" y2="388.608"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="330" x="268.5" y="382.799">Include a &lt;iframe src=https://op/check_session_iframe&gt;</text><polygon fill="#181818" points="626.5,416.314,616.5,420.314,626.5,424.314,622.5,420.314" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="986,416.314,996,420.314,986,424.314,990,420.314" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="620.5" x2="992" y1="420.314" y2="420.314"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="632.5" y="414.505">Initialization of the iframe</text><path d="M8,432.314 L75,432.314 L75,442.0201 L65,452.0201 L8,452.0201 L8,432.314 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="555.9163" style="stroke:#000000;stroke-width:1.5;" width="1159.5" x="8" y="432.314"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="22" x="23" y="447.2111">par</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="8" x2="1167.5" y1="866.1122" y2="866.1122"/><path d="M27,466.0201 L100,466.0201 L100,475.7261 L90,485.7261 L27,485.7261 L27,466.0201 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="375.0922" style="stroke:#000000;stroke-width:1.5;" width="1115.5" x="27" y="466.0201"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28" x="42" y="480.9171">loop</text><polygon fill="#181818" points="603.5,515.4321,613.5,519.4321,603.5,523.4321,607.5,519.4321" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="261.5" x2="609.5" y1="519.4321" y2="519.4321"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="285" x="268.5" y="513.6231">postMessage("CID-XXXX SS-XXXX", "https://op")</text><polygon fill="#FEFFDD" points="514,532.4321,717,532.4321,727,562.4321,717,593.4321,514,593.4321,504,562.4321,514,532.4321" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="516" y="550.3291">Recompute session_state and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="199" x="516" y="568.0351">compare it with the provided one</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="516" y="585.7411">(SS-XXXX)</text><path d="M46,602.5501 L109,602.5501 L109,612.2562 L99,622.2562 L46,622.2562 L46,602.5501 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="224.5621" style="stroke:#000000;stroke-width:1.5;" width="1071.5" x="46" y="602.5501"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="61" y="617.4472">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="157" x="124" y="616.3091">[session_state is unchanged]</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="46" x2="1117.5" y1="674.9622" y2="674.9622"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="154" x="51" y="688.7211">[session_state has changed]</text><polygon fill="#181818" points="272.5,651.9622,262.5,655.9622,272.5,659.9622,268.5,655.9622" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="266.5" x2="614.5" y1="655.9622" y2="655.9622"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="259" x="278.5" y="650.1532">postMessage("unchanged", "https://client")</text><polygon fill="#181818" points="127,651.9622,117,655.9622,127,659.9622,123,655.9622" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="121" x2="260.5" y1="655.9622" y2="655.9622"/><polygon fill="#181818" points="272.5,716.6501,262.5,720.6501,272.5,724.6501,268.5,720.6501" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="266.5" x2="614.5" y1="720.6501" y2="720.6501"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="243" x="278.5" y="714.8411">postMessage("changed", "https://client")</text><polygon fill="#181818" points="127,716.6501,117,720.6501,127,724.6501,123,720.6501" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="121" x2="260.5" y1="720.6501" y2="720.6501"/><polygon fill="#181818" points="249.5,766.0621,259.5,770.0621,249.5,774.0621,253.5,770.0621" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="116" x2="255.5" y1="770.0621" y2="770.0621"/><polygon fill="#181818" points="769.5,766.0621,779.5,770.0621,769.5,774.0621,773.5,770.0621" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="261.5" x2="775.5" y1="770.0621" y2="770.0621"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="159" x="268.5" y="746.5471">Authentication Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184" x="430.5" y="746.5471">(OAuth Authorization Request)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="268.5" y="764.2531">…&amp;prompt=none</text><rect fill="none" height="44.0501" style="stroke:#000000;stroke-width:1.5;" width="1035.5" x="64" y="778.0621"/><path d="M64,778.0621 L128,778.0621 L128,787.0621 L118,797.0621 L64,797.0621 L64,778.0621 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="77" y="793.9591">ref</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="177" x="493.25" y="813.8902">End of the OpenID Connect flow</text><path d="M520,877.1122 L593,877.1122 L593,886.8183 L583,896.8183 L520,896.8183 L520,877.1122 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="97.118" style="stroke:#000000;stroke-width:1.5;" width="494" x="520" y="877.1122"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28" x="535" y="892.0093">loop</text><polygon fill="#181818" points="626.5,926.5243,616.5,930.5243,626.5,934.5243,622.5,930.5243" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="620.5" x2="997" y1="930.5243" y2="930.5243"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="632.5" y="924.7153">Session state changed</text><polygon fill="#FEFFDD" points="551,943.5243,680,943.5243,690,955.5243,680,968.5243,551,968.5243,541,955.5243,551,943.5243" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="553" y="961.4213">Update session state</text><!--MD5=[3f4096be99036e16efca5b3f6d7bf238]
@startuml

!pragma teoz true

participant "Relying Party\n(OAuth Client)\nhttps://rp" as client
box
    participant "User Agent / Frontend\nfor Relying Party" as uac
    actor "User\n(OAuth Resource Owner)" as user  
    participant "iframe of\nOpenID Provider" as iframe
    participant "User Agent / Frontend for\nOpenID Provider" as uaas
end box
participant "OpenID Provider\n(OAuth Authorization Server)\nhttps://op" as as

note over uaas, as:Relevant RP Registration\n"check_session_iframe": "https://op/check_session_iframe"

as -> uaas : (HTTPS 302)
& uaas -> uac: **Authentication Response** (OAuth Authorization Response)\nRedirection to GET https://rp/callback (redirect_uri)\n  ?code=AC-XXXX (opaque, single-use)\n  &state=AS-XXXX (if given)\n  &iss=https://op (extension)\n  &session_state=SS-XXXX

note over uaas, as: session_state is some salted hash of the client_id,\norigin URI of the client and the session state\n(i.e. which used are logged in) on the AS.

uac -> iframe: Include a <iframe src=https://op/check_session_iframe>
iframe <-> as: Initialization of the iframe

par

loop

uac -> iframe: postMessage("CID-XXXX SS-XXXX", "https://op")
hnote over iframe: Recompute session_state and\ncompare it with the provided one\n(SS-XXXX)

alt session_state is unchanged

iframe - -> uac: postMessage("unchanged", "https://client")
&uac -> client

else session_state has changed

iframe - -> uac: postMessage("changed", "https://client")
&uac -> client

client -> uac
& uac -> uaas:  **Authentication Request** (OAuth Authorization Request)\n…&prompt=none

ref over client, as: End of the OpenID Connect flow

end

end

else

loop

as -> iframe: Session state changed

hnote over iframe: Update session state

end

end

@enduml

PlantUML version 1.2022.13(Sat Nov 19 14:22:17 CET 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: fr
Country: FR
--></g></svg>