<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1281px" preserveAspectRatio="none" style="width:1091px;height:1281px;background:#FFFFFF;" version="1.1" viewBox="0 0 1091 1281" width="1091px" zoomAndPan="magnify"><defs/><g><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="152" x2="152" y1="77.2038" y2="1204.3286"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="869" x2="869" y1="77.2038" y2="1204.3286"/><rect fill="#E2E2F0" height="71.2038" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108" x="98" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="108" y="26.9659">Relying Party</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="105" y="46.0339">(OAuth Client)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="120" y="65.1018">https://rp</text><rect fill="#E2E2F0" height="71.2038" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="207" x="765.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="813" y="26.9659">OpenID Provider</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="193" x="772.5" y="46.0339">(OAuth Authorization Server)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="836" y="65.1018">https://op</text><rect fill="#E2E2F0" height="71.2038" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108" x="98" y="1204.3286"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="108" y="1226.2946">Relying Party</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="105" y="1245.3625">(OAuth Client)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="120" y="1264.4304">https://rp</text><rect fill="#E2E2F0" height="71.2038" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="207" x="765.5" y="1204.3286"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="813" y="1226.2946">OpenID Provider</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="193" x="772.5" y="1245.3625">(OAuth Authorization Server)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="836" y="1264.4304">https://op</text><polygon fill="#181818" points="857,441.3241,867,445.3241,857,449.3241,861,445.3241" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="152" x2="863" y1="445.3241" y2="445.3241"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="159" x="159" y="103.1008">Authentication Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184" x="321" y="103.1008">(OAuth Authorization Request)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="356" x="159" y="120.8068">Front channel GET https://rp/auth (authorization_endpoint)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="204" x="165" y="138.5128">?response_type=code (REQUIRED)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249" x="165" y="156.2188">&amp;client_id=CID-XXXX (REQUIRED, opaque)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="530" x="165" y="173.9248">&amp;redirect_uri=https%3A%2F%2Fclient%2Ecallback (always REQUIRED in OpenID Connect)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="260" x="165" y="191.6308">&amp;state=AS-XXXX (RECOMMENDED, opaque)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="451" x="165" y="209.3369">&amp;nonce=AN-XXXX (OPTIONAL using this flow but REQUIRED for other flows,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="306" x="171" y="227.0429">included in ID token, protect against replay attacks)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="299" x="165" y="244.7489">&amp;scope=openid+profile+email+phone (OPTIONAL)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="6" x="159" y="262.4549">  </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="275" x="165" y="280.1609">&amp;code_challenge_method=S256 (if PKCE used)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="241" x="165" y="297.8669">&amp;code_challenge=CCCCCC (if PKCE used)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="6" x="159" y="315.573">  </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="326" x="165" y="333.279">&amp;response_mode=query (or fragment, form_post, etc.)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="297" x="165" y="350.985">&amp;display=page / popup / touch / wap (OPTIONAL)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="395" x="165" y="368.691">&amp;prompt=login (OPTIONAL, and/or none/consent/select_account)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="318" x="165" y="386.397">&amp;max_age=320 (OPTIONAL, max. authentication age)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="314" x="165" y="404.103">&amp;id_token_hint=eyJ… (OPTIONAL, previous ID token)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="292" x="165" y="421.8091">&amp;login_hint=janedoe@example.com (OPTIONAL)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164" x="165" y="439.5151">&amp;acr_values=… (OPTIONAL)</text><polygon fill="#FEFFDD" points="673.5,458.3241,1064.5,458.3241,1074.5,479.3241,1064.5,501.3241,673.5,501.3241,663.5,479.3241,673.5,458.3241" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196" x="675.5" y="476.2211">User authentication and consent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="375" x="687.5" y="493.9271">"Do you want to login on ClientFoo? Information requested: …"</text><polygon fill="#181818" points="163,597.2662,153,601.2662,163,605.2662,159,601.2662" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="157" x2="868" y1="601.2662" y2="601.2662"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="167" x="169" y="524.6331">Authentication Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193" x="339" y="524.6331">(OAuth Authorization Response)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="301" x="169" y="542.3391">Front channel GET https://rp/callback (redirect_uri)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217" x="175" y="560.0452">?code=AC-XXXX (opaque, single-use)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="175" y="577.7512">&amp;state=AS-XXXX (if given)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="175" y="595.4572">&amp;iss=https://op (extension)</text><polygon fill="#181818" points="857,760.2083,867,764.2083,857,768.2083,861,764.2083" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="152" x2="863" y1="764.2083" y2="764.2083"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="159" y="652.1632">Token Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="260" y="652.1632">(OAuth Access Token Request)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="359" x="159" y="669.8692">HTTPS POST https://op/token (token_endpoint), urlencoded</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="693" x="159" y="687.5752">Authorization: Basic … (client_id + client_secret) (or other authentication method, see token_endpoint_auth_method)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189" x="159" y="705.2813">grant_type=authorization_code</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="165" y="722.9873">&amp;code=AC-XXXX</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="488" x="165" y="740.6933">&amp;redirect_uri=https%3A%2F%2Fclient%2Fcallback (REQUIRED, same as in request)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="442" x="165" y="758.3993">&amp;code_verifier=CV-XXXXV (if and only if code_challenge was used i.e. PKCE)</text><polygon fill="#181818" points="163,1075.2106,153,1079.2106,163,1083.2106,159,1079.2106" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="157" x2="868" y1="1079.2106" y2="1079.2106"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="106" x="169" y="790.1053">Token Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190" x="278" y="790.1053">(OAuth Access Token Response)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="169" y="807.8113">HTTPS 200, JSON</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="169" y="825.5174">"access_token":"AT-XXXX", (opaque)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="169" y="843.2234">"token_type":"bearer",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="169" y="860.9294">"expires_in":3600,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="287" x="169" y="878.6354">"refresh_token":"RT-XXXX", (OPTIONAL, opaque)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="169" y="896.3414">"scope":"scope1 scope2",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="169" y="914.0474">"id_token": JWT with claims,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="181" y="931.7535">"iss": "https://op",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="405" x="181" y="949.4595">"sub": "SUB-XXXX", (private for the client_id if subject_type=pairwise)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="181" y="967.1655">"aud": "CID-XXXX",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="181" y="984.8715">"exp": …, "iat": … "auth_time": …,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="411" x="181" y="1002.5775">"nonce": "AN-XXXX", (from request, protection against replay attacks)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="309" x="181" y="1020.2835">"acr": "…", (OPTIONAL, authentication context class),</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="388" x="181" y="1037.9896">"amr": ["…"], (OPTIONAL, list of user authentication methods use),</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="644" x="181" y="1055.6956">"azp": "CID-XXXX",n    "sid": "SID-XXX", (OPTIONAL, different for different RPs, for Front/Back-Channel Logout)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="3" x="169" y="1073.4016"> </text><polygon fill="#FEFFDD" points="20,1092.2106,284,1092.2106,294,1104.2106,284,1117.2106,20,1117.2106,10,1104.2106,20,1092.2106" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="260" x="22" y="1110.1076">Optionaly decrypt (JWE) and check id_token</text><polygon fill="#FEFFDD" points="79,1127.9166,225,1127.9166,235,1139.9166,225,1152.9166,79,1152.9166,69,1139.9166,79,1127.9166" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="81" y="1145.8136">Create user session, etc.</text><polygon fill="#FEFFDD" points="76,1163.6226,228,1163.6226,238,1175.6226,228,1188.6226,76,1188.6226,66,1175.6226,76,1163.6226" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="78" y="1181.5196">Restore application state</text><!--MD5=[3df5d18765b002a23e97cadec4e20d0e]
@startuml

!pragma teoz true

participant "Relying Party\n(OAuth Client)\nhttps://rp" as rp
participant "OpenID Provider\n(OAuth Authorization Server)\nhttps://op" as op

rp -> op: **Authentication Request** (OAuth Authorization Request)\nFront channel GET https://rp/auth (authorization_endpoint)\n  ?response_type=code (REQUIRED)\n  &client_id=CID-XXXX (REQUIRED, opaque)\n  &redirect_uri=https%3A%2F%2Fclient%2Ecallback (always REQUIRED in OpenID Connect)\n  &state=AS-XXXX (RECOMMENDED, opaque)\n  &nonce=AN-XXXX (OPTIONAL using this flow but REQUIRED for other flows,\n    included in ID token, protect against replay attacks)\n  &scope=openid+profile+email+phone (OPTIONAL)\n  \n  &code_challenge_method=S256 (if PKCE used)\n  &code_challenge=CCCCCC (if PKCE used)\n  \n  &response_mode=query (or fragment, form_post, etc.)\n  &display=page / popup / touch / wap (OPTIONAL)\n  &prompt=login (OPTIONAL, and/or none/consent/select_account)\n  &max_age=320 (OPTIONAL, max. authentication age)\n  &id_token_hint=eyJ… (OPTIONAL, previous ID token)\n  &login_hint=janedoe@example.com (OPTIONAL)\n  &acr_values=… (OPTIONAL)

hnote over op: User authentication and consent\n    "Do you want to login on ClientFoo? Information requested: …"

op - -> rp: **Authentication Response** (OAuth Authorization Response)\nFront channel GET https://rp/callback (redirect_uri)\n  ?code=AC-XXXX (opaque, single-use)\n  &state=AS-XXXX (if given)\n  &iss=https://op (extension)

|||

rp -> op: **Token Request** (OAuth Access Token Request)\nHTTPS POST https://op/token (token_endpoint), urlencoded\nAuthorization: Basic … (client_id + client_secret) (or other authentication method, see token_endpoint_auth_method)\ngrant_type=authorization_code\n  &code=AC-XXXX\n  &redirect_uri=https%3A%2F%2Fclient%2Fcallback (REQUIRED, same as in request)\n  &code_verifier=CV-XXXXV (if and only if code_challenge was used i.e. PKCE)

op - -> rp: **Token Response** (OAuth Access Token Response)\nHTTPS 200, JSON\n"access_token":"AT-XXXX", (opaque)\n"token_type":"bearer",\n"expires_in":3600,\n"refresh_token":"RT-XXXX", (OPTIONAL, opaque)\n"scope":"scope1 scope2",\n"id_token": JWT with claims,\n    "iss": "https://op",\n    "sub": "SUB-XXXX", (private for the client_id if subject_type=pairwise)\n    "aud": "CID-XXXX",\n    "exp": …, "iat": … "auth_time": …,\n    "nonce": "AN-XXXX", (from request, protection against replay attacks)\n    "acr": "…", (OPTIONAL, authentication context class),\n    "amr": ["…"], (OPTIONAL, list of user authentication methods use),\n    "azp": "CID-XXXX",n    "sid": "SID-XXX", (OPTIONAL, different for different RPs, for Front/Back-Channel Logout)\n
hnote over rp: Optionaly decrypt (JWE) and check id_token
hnote over rp: Create user session, etc.
hnote over rp: Restore application state

@enduml

PlantUML version 1.2022.13(Sat Nov 19 14:22:17 CET 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: fr
Country: FR
--></g></svg>